<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Missiles dans ton cul!</title>
	<meta name="viewport" content="width=device-width, user-scalable=no">
    <style>
     * { padding: 0; margin: 0; }
     canvas { background: #eef; display: block; margin: 0 auto; }
    </style>
</head>
<body>

<canvas id="myCanvas" width=1200 height=800></canvas>

<script>
	//Laser
	//modifier declenchement spécial
	//Explosion missiles
	//Bestiaires des ennemis
	
	//calibrer et mettre un temps pour le niveau 1
	//Affichage des titres et des niveaux
	//Gestion des niveau
	//Choix des armes
	// autres paysages
	// autres types missile
	
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");

canvas.height=window.innerHeight-5;
canvas.width=window.innerWidth-10;
var hauteur_rect=canvas.height*11/12;
var facteur_taille=canvas.width*0.2/350;
var largeur_socle=facteur_taille*200;
var clic_en_cours = 0;

var nb_ronds = 0;
var xrond=[];
var yrond=[];

var indice=0;

var tab_x =[];
var tab_y =[];
var temps_point_passage = [];


var nb_pixels_parcourus = 0;

var vit_pix_par_sec = 200;

var tir_mis = 0;

var date_tir=0;
var tps_depuis_tir=0;

var pos_or_mis=[0,0,0];

var etat=0; //0=intro 1=tuto + cheat si necessaire  2=niveau 3=info_niveau 4=jeux 5=score + cheat code 6=game over

var intro_duree=2;//titre
//etat 1 : mini tuto pas de durée sortie au clic
//var etat_2_duree=1;//affiche niveau
//etat 3 : info niveau pas de durée sortie au clic
var etat_4_duree=60;//jeu
var etat_5_duree=2;



var first_draw=1;
var state_start_time=0;

var last_miss_date=0;

var min_delay_between_2_miss=0.7;
var max_delay_between_2_miss=1;
var delay_before_next_miss=0;

var vit_x_miss =[];
var vit_y_miss =[];
var pos_x_miss =[];
var pos_y_miss =[];
var type_miss =[];
var angle_miss=[];
var etat_propu=[];

var deltat=0;
var maintenant=0;

var ligne_depart_miss=0.5; //unitée hauteur_rect au dessus de l'ecran
var ligne_arrivee_miss=1.1;
var date_derniere_boucle=0;

var vit_min_traverse_ecran=[0.4,0.4,0.2]; //en ecran par seconde
var vit_max_traverse_ecran=[0.6,0.6,0.4];//en ecran par seconde
var coef_tete_miss_par_type=[25*2/3,25/2,25*4/3];
var taille_tete_miss_par_type=[0,0,0];
var coef_larg_miss=[50,25*3/2,100];
var coef_long_miss=[140,70*3/2,150];
var largeur_corps_miss=[0,0,0];
var longueur_corps_miss=[0,0,0];

var pos_bat_a_jour=0;

var nb_immeubles=5;
var largeur_immeubles=[];
var hauteur_immeubles=[];
var posi_immeubles=[];
var etat_facade_droite=[];
var etat_facade_gauche=[];

var max_level=3;
var selected_level=1;

var fin_de_partie=0;

//pour explosion immeuble
var x_bat_explose=[];
var y_bat_explose=[];
var x_miss_explose=[];
var y_miss_explose=[];
var date_impact=[];
var vit_x_miss_exlpose=[];
var vit_y_miss_explose=[];
var ind_immeuble_explosion=[];
var duree_explose_immeuble=0.4;

temps_point_passage.push(0);
//alert(temps_point_passage[0]);

var angle_canon=0;


var dernier_tir_boulet=0;
var temps_entre_2_boulets=0.5;
var vit_boulets=1.5;
var vit_x_boulet=[];
var vit_y_boulet=[];
var pos_x_boulet=[];
var pos_y_boulet=[];
var taille_boulet=facteur_taille*20;

var dernier_tir_TC=0;
var portee_AD=1/5;
var angle_vue_AD=45; //°
var temps_entre_2_miss_TC=0.11;
var vit_miss_TC=0.7;
var accel_miss_TC=0.7;
var vit_rot_max_TC=145; //°/s
var vit_x_miss_TC=[];
var vit_y_miss_TC=[];
var pos_x_miss_TC=[];
var pos_y_miss_TC=[];
var taille_miss_TC=facteur_taille*20;

var x_case_niveau=[0,0,0,0,0,0,0,0,0,0,0,0];
var y_case_niveau=[0,0,0,0,0,0,0,0,0,0,0,0];
var largeur_case_niveau=0;
var hauteur_case_niveau=0;
var x_3_boutons=[0,0,0];
var y_3_boutons=0;
var hauteur_3_boutons=0;

var laser_ON=0;
var dernier_tir_laser=0;
var haut_laser=0;
var bas_laser=0;
var t_OFF_laser=0;
var temps_entre_2_laser=3;
var duree_laser=0.51;
var vitesse_lumiere=6;
var coef_largeur_laser=30;
var largeur_laser=facteur_taille*coef_largeur_laser;

var selection_arme=0;//0:canon    1:missile_ad    2:laser    3:briques
var niv_max_arme=2;

var nb_enemy_max=3;

// paysages
var num_paysage=0;

var etat_pause=0;
var deltat_pause=0;
var temps_en_pause=0;

var proportion_type_missile=[1,0,0,0];

document.addEventListener("mousemove",move_mouse, false);
document.addEventListener("mousedown",down_mouse, false);
document.addEventListener("mouseup",up_mouse, false);

document.addEventListener("touchmove",move_touch, false);
document.addEventListener("touchstart",down_touch, false);
document.addEventListener("touchend",up_touch, false);


function draw() {
	if(etat_pause==1)
	{
		maintenant=Date.now()/1000-temps_en_pause;
	    deltat=maintenant-date_derniere_boucle;
		temps_en_pause=temps_en_pause+deltat;
		maintenant=Date.now()/1000-temps_en_pause;
		deltat=0;
		date_derniere_boucle=maintenant;
		/*deltat_pause=Date.now()/1000-date_derniere_boucle;
		date_derniere_boucle=Date.now()/1000;
		temps_en_pause=temps_en_pause+deltat_pause
		deltat=0;
		maintenant=Date.now()/1000-temps_en_pause;*/
	}
	else
	{
		maintenant=Date.now()/1000-temps_en_pause;
	    deltat=maintenant-date_derniere_boucle;
		date_derniere_boucle=maintenant;
    }
	canvas.height=window.innerHeight-5;
	hauteur_rect=canvas.height*11/12;
	canvas.width=window.innerWidth-10;
	facteur_taille=canvas.width*0.2/350;
	largeur_socle=facteur_taille*200;
	taille_boulet=facteur_taille*20;
	taille_miss_TC=facteur_taille*20;
	largeur_laser=facteur_taille*coef_largeur_laser;
	for(indice=0;indice<coef_tete_miss_par_type.length;indice++)
	{
	    taille_tete_miss_par_type[indice]=coef_tete_miss_par_type[indice]*facteur_taille;
		largeur_corps_miss[indice]=coef_larg_miss[indice]*facteur_taille;
		longueur_corps_miss[indice]=coef_long_miss[indice]*facteur_taille;
	}
	ctx.strokeStyle = 'black';
	if(etat==0)
	{
		if(first_draw==1)
	    {
		     state_start_time=maintenant;
             first_draw=0;
             deltat=0;
	    }
		if((maintenant-state_start_time)>intro_duree)
		{
			  first_draw=1;
              etat=1;
		}
		else
        {
     	   affiche_titre();
        }
     }
     else if(etat==1)
	{
	    if(first_draw==1)
	    {
		     state_start_time=maintenant;
             first_draw=0;
	    }
		ctx.fillText("tuto",canvas.width/10,canvas.height/3);
   }
	else if(etat==2)
	{
	    if(first_draw==1)
	    {
		     state_start_time=maintenant;
             first_draw=0;
             RAZ_niveau();
             level_config();
	    }
	//paysage(num_paysage);
		affiche_choix_niveau();
		//ctx.fillText("choix niveau "+max_level,canvas.width/10,canvas.height/3);
   }
   else if(etat==3)
	{
	    if(first_draw==1)
	    {
		     state_start_time=maintenant;
             first_draw=0;
	    }
		ctx.fillText("upgrades",canvas.width/10,canvas.height/3);
   }
   else if(etat==5)
	{
	    if(first_draw==1)
	    {
		     state_start_time=maintenant;
             first_draw=0;
	    }
	//paysage(num_paysage);
		if((maintenant-state_start_time)>etat_5_duree)
		{
			  first_draw=1;
              etat=2;
		}
		ctx.fillText("score",canvas.width/10,canvas.height/3);
   }
   else if(etat==4)
   {
   	  if(first_draw==1)
	    {
		     state_start_time=maintenant;
             first_draw=0;
	    }
		if((maintenant-state_start_time)>etat_4_duree)
		{
			  first_draw=1;
              etat=5;
		}
	    else
		{
			paysage(num_paysage);
	        if (pos_bat_a_jour==0)
		    {
	          mise_a_j_pos_bat(nb_immeubles);
	          pos_bat_a_jour=1;
	        }
	        
	        //trace_chargeur();
	        mise_a_jour_missiles();
	        mise_a_jour_boulets();
	        mise_a_jour_miss_TC();
	        mise_a_jour_laser();
	        mise_a_jour_impact_avec_immeuble();
			traceimmeubles(nb_immeubles);
	        //trace_explosions();
	        trace_laser();
	        trace_missiles();
	        traces_boulets();
	        traces_miss_TC();
	        mise_a_jour_impact_miss_laser();
	        mise_a_jour_impact_miss_boulet();
	        mise_a_jour_impact_miss_miss();
	        trace_arme();
	        ctx.strokeStyle = 'black';
			if(etat_pause==0)
			{
				ctx.fillStyle = 'white';
			}
			else
			{
				ctx.fillStyle = 'orange';
			}
			//bouton pause
			tracequadrilataire_plein(canvas.width*11/12,canvas.height/20,canvas.width*11/12,canvas.height/20-80*facteur_taille,canvas.width*11/12+40*facteur_taille,canvas.height/20-80*facteur_taille,canvas.width*11/12+40*facteur_taille,canvas.height/20);
			tracequadrilataire_plein(canvas.width*11/12+60*facteur_taille,canvas.height/20,canvas.width*11/12+60*facteur_taille,canvas.height/20-80*facteur_taille,canvas.width*11/12+60*facteur_taille+40*facteur_taille,canvas.height/20-80*facteur_taille,canvas.width*11/12+60*facteur_taille+40*facteur_taille,canvas.height/20);
			tracequadrilataire(canvas.width*11/12,canvas.height/20,canvas.width*11/12,canvas.height/20-80*facteur_taille,canvas.width*11/12+40*facteur_taille,canvas.height/20-80*facteur_taille,canvas.width*11/12+40*facteur_taille,canvas.height/20);
			tracequadrilataire(canvas.width*11/12+60*facteur_taille,canvas.height/20,canvas.width*11/12+60*facteur_taille,canvas.height/20-80*facteur_taille,canvas.width*11/12+60*facteur_taille+40*facteur_taille,canvas.height/20-80*facteur_taille,canvas.width*11/12+60*facteur_taille+40*facteur_taille,canvas.height/20);
			ctx.fillStyle = 'white';
			tracequadrilataire_plein(0,canvas.height,0,hauteur_rect,canvas.width,hauteur_rect,canvas.width,canvas.height);
			tracequadrilataire(0,canvas.height,0,hauteur_rect,canvas.width,hauteur_rect,canvas.width,canvas.height);
			trace_choix_armes();
			check_game_over();
			affiche_game_over();
		}
	//maintenant-dernier_tir_boulet)>temps_entre_2_boulets
    }
	//tracequadrilataire(0,0,canvas.width,0,canvas.width,hauteur_rect,0,hauteur_rect);
}
setInterval(draw, 20);

function affiche_game_over()
{
	if(fin_de_partie==1)
	{
		ctx.fillStyle = 'white';
		ctx.globalAlpha=0.5;
		tracequadrilataire_plein(0,canvas.height,0,0,canvas.width,0,canvas.width,canvas.height);
		ctx.globalAlpha=1;
	}
}

function check_game_over()
{
	
	var i=0;
	var somme=0;
	for(i=0;i<nb_immeubles;i++)
	{
		somme=somme+etat_facade_droite[i]+etat_facade_gauche[i];
	}
	if(somme==nb_immeubles*2*2)
	{
		fin_de_partie=1;
	}
}

function affiche_choix_niveau()
{
	var lindice=0;
	largeur_case_niveau=canvas.width/5;
	hauteur_case_niveau=canvas.height/7;
	var largeur_zone=canvas.width*3/4;
	var hauteur_zone=canvas.height*2/3;
	var largeur_int=(largeur_zone-3*largeur_case_niveau)/2;
	var hauteur_int=(hauteur_zone-4*hauteur_case_niveau)/3;
	hauteur_3_boutons=canvas.height/15;
	y_3_boutons=canvas.height-(canvas.height-hauteur_zone)/4-hauteur_3_boutons/2;
	
	ctx.fillStyle = '#244';
	tracequadrilataire_plein(0,0,0,canvas.height,canvas.width,canvas.height,canvas.width,0);
	//alert(x_case_niveau.length);
	ctx.strokeStyle = 'white';
	for(lindice=0;lindice<x_case_niveau.length;lindice++)
	{
		x_case_niveau[lindice]=(largeur_case_niveau+largeur_int)*(lindice%3)+(canvas.width-largeur_zone)/2;
		y_case_niveau[lindice]=(hauteur_case_niveau+hauteur_int)*(Math.floor(lindice/3))+(canvas.height-hauteur_zone)/2-canvas.height/20;
		if((lindice+1)>max_level)
		{
			ctx.fillStyle = '#224';
		}
		else if(selected_level==(lindice+1))
		{
			ctx.fillStyle = '#424';
		}
		else
		{
			ctx.fillStyle = '#442';
		}
		//alert(max_level);
		tracequadrilataire_plein(x_case_niveau[lindice],y_case_niveau[lindice],x_case_niveau[lindice]+largeur_case_niveau,y_case_niveau[lindice],x_case_niveau[lindice]+largeur_case_niveau,y_case_niveau[lindice]+hauteur_case_niveau,x_case_niveau[lindice],y_case_niveau[lindice]+hauteur_case_niveau);
		//alert("x "+lindice+" : "+x_case_niveau[lindice]);
		tracequadrilataire(x_case_niveau[lindice],y_case_niveau[lindice],x_case_niveau[lindice]+largeur_case_niveau,y_case_niveau[lindice],x_case_niveau[lindice]+largeur_case_niveau,y_case_niveau[lindice]+hauteur_case_niveau,x_case_niveau[lindice],y_case_niveau[lindice]+hauteur_case_niveau);
	}
	for(lindice=0;lindice<3;lindice++)
	{
		x_3_boutons[lindice]=(largeur_case_niveau+largeur_int)*(lindice%3)+(canvas.width-largeur_zone)/2;
		tracequadrilataire(x_3_boutons[lindice],y_3_boutons,x_3_boutons[lindice]+largeur_case_niveau,y_3_boutons,x_3_boutons[lindice]+largeur_case_niveau,y_3_boutons+hauteur_3_boutons,x_3_boutons[lindice],y_3_boutons+hauteur_3_boutons);
	}
	

}

function RAZ_niveau()
{
	fin_de_partie=0;
    vit_x_boulet=[];
	vit_y_boulet=[];
	pos_x_boulet=[];
	pos_y_boulet=[];
	
     vit_x_miss_TC=[];
      vit_y_miss_TC=[];
     pos_x_miss_TC=[];
     pos_y_miss_TC=[];
	
     laser_ON=0;
     dernier_tir_laser=0;
     haut_laser=0;
     bas_laser=0;
     t_OFF_laser=0;

     x_bat_explose=[];
     y_bat_explose=[];
     x_miss_explose=[];
     y_miss_explose=[];
     date_impact=[];
     vit_x_miss_exlpose=[];
     vit_y_miss_explose=[];
     ind_immeuble_explosion=[];

     vit_x_miss =[];
     vit_y_miss =[];
     pos_x_miss =[];
     pos_y_miss =[];
     type_miss =[];
     angle_miss=[];
     etat_propu=[];

     largeur_immeubles=[];
     hauteur_immeubles=[];
     posi_immeubles=[];
     etat_facade_droite=[];
     etat_facade_gauche=[];

    pos_bat_a_jour=0;
    
    angle_canon=0;
    selection_arme=0;//0:canon    1:missile_ad    2:laser    3:briques
}

function level_config()
{
	num_paysage=selected_level;
	
	if (selected_level==1)
	{
		proportion_type_missile=[1,0,0,0];
	}
	else if (selected_level==2)
	{
		proportion_type_missile=[1,4,1,0];
	}
	else if (selected_level==3)
	{
		proportion_type_missile=[0,1,3,0];
	}
	
	
	//niv_max_arme++;
	//type missiles attaque
	//upgrade defenses
		// temps_entre_2_laser=3;
		// duree_laser=0.51;
		// vitesse_lumiere=6;
		// coef_largeur_laser=30;
	// nb bâtiments. nb_immeubles--;
}

function affiche_titre()
{
	var temps_restant_titre=intro_duree-(maintenant-state_start_time);
	ctx.fillText(temps_restant_titre,200,80);
	ctx.fillText("Missiles DTC",canvas.width/10,canvas.height/3);
}

function trace_choix_armes()
{
	var hauteur_barre=hauteur_rect+2/3*(canvas.height-hauteur_rect);
	var hauteur_barre_2=hauteur_rect+8/9*(canvas.height-hauteur_rect);
	var largeur_barre=canvas.width/5;
	var debut_barre_1=(canvas.width/4-largeur_barre)/2;
	var debut_barre_2=canvas.width/4+(canvas.width/4-largeur_barre)/2;
	var debut_barre_3=2*canvas.width/4+(canvas.width/4-largeur_barre)/2;
	var part_de_barre_boulet=Math.min(1,(maintenant-dernier_tir_boulet)/temps_entre_2_boulets);
	var part_de_barre_TC=Math.min(1,(maintenant-dernier_tir_TC)/temps_entre_2_miss_TC);
	var part_de_barre_laser=Math.min(1,(maintenant-dernier_tir_laser)/temps_entre_2_laser);
	var dice=0;
	for(dice=0;dice<4;dice++)
	{
		if(dice==selection_arme)
		{
			ctx.fillStyle = 'white';
		}
		else
		{
			ctx.fillStyle = '#ddd';
		}
		tracequadrilataire_plein(dice*canvas.width/4,canvas.height,dice*canvas.width/4,hauteur_rect,(dice+1)*canvas.width/4,hauteur_rect,(dice+1)*canvas.width/4,canvas.height);
		tracequadrilataire(dice*canvas.width/4,canvas.height,dice*canvas.width/4,hauteur_rect,(dice+1)*canvas.width/4,hauteur_rect,(dice+1)*canvas.width/4,canvas.height);
	}
	if(part_de_barre_boulet==1)
	{
		ctx.fillStyle = 'green';
	}
	else
	{
		ctx.fillStyle = 'orange';
	}
	tracequadrilataire(debut_barre_1,hauteur_barre_2,debut_barre_1,hauteur_barre,debut_barre_1+largeur_barre,hauteur_barre,debut_barre_1+largeur_barre,hauteur_barre_2);
	tracequadrilataire_plein(debut_barre_1,hauteur_barre_2,debut_barre_1,hauteur_barre,debut_barre_1+largeur_barre*part_de_barre_boulet,hauteur_barre,debut_barre_1+largeur_barre*part_de_barre_boulet,hauteur_barre_2);
	if(part_de_barre_TC==1)
	{
		ctx.fillStyle = 'green';
	}
	else
	{
		ctx.fillStyle = 'orange';
	}
	tracequadrilataire(debut_barre_2,hauteur_barre_2,debut_barre_2,hauteur_barre,debut_barre_2+largeur_barre,hauteur_barre,debut_barre_2+largeur_barre,hauteur_barre_2);
	tracequadrilataire_plein(debut_barre_2,hauteur_barre_2,debut_barre_2,hauteur_barre,debut_barre_2+largeur_barre*part_de_barre_TC,hauteur_barre,debut_barre_2+largeur_barre*part_de_barre_TC,hauteur_barre_2);
	if(part_de_barre_laser==1)
	{
		ctx.fillStyle = 'green';
	}
	else
	{
		ctx.fillStyle = 'orange';
	}
	tracequadrilataire(debut_barre_3,hauteur_barre_2,debut_barre_3,hauteur_barre,debut_barre_3+largeur_barre,hauteur_barre,debut_barre_3+largeur_barre,hauteur_barre_2);
	tracequadrilataire_plein(debut_barre_3,hauteur_barre_2,debut_barre_3,hauteur_barre,debut_barre_3+largeur_barre*part_de_barre_laser,hauteur_barre,debut_barre_3+largeur_barre*part_de_barre_laser,hauteur_barre_2);
	
	for(dice=0;dice<4;dice++)
	{
	/*selection_arme=0;//0:canon    1:missile_ad    2:laser    3:briques
var niv_max_arme=1;*/
		if(dice>niv_max_arme)
		{
			ctx.fillStyle = 'grey';
			tracequadrilataire_plein(dice*canvas.width/4,canvas.height,dice*canvas.width/4,hauteur_rect,(dice+1)*canvas.width/4,hauteur_rect,(dice+1)*canvas.width/4,canvas.height);
		}
		ctx.strokeStyle = 'black';
	}
	//max_max_level=1;
	//
}

function trace_laser()
{
	//largeur_laser;
	//haut_laser;
	//bas_laser;
	var largeur_laser_loc=largeur_laser*(0.9+Math.random()*0.2);
	ctx.translate(canvas.width/2,hauteur_rect-largeur_socle/4-largeur_socle/3);
	ctx.rotate(angle_canon);
	//tracequadrilataire(-1,-1,-1,1,1,1,1,-1);
	ctx.fillStyle = 'blue';
	ctx.globalAlpha=0.2;
	tracequadrilataire_plein(largeur_laser_loc,-bas_laser,-largeur_laser_loc,-bas_laser,-largeur_laser_loc,-haut_laser,largeur_laser_loc,-haut_laser);
	ctx.globalAlpha=1;
	tracequadrilataire_plein(largeur_laser_loc/2,-bas_laser,-largeur_laser_loc/2,-bas_laser,-largeur_laser_loc/2,-haut_laser,largeur_laser_loc/2,-haut_laser);
	ctx.fillStyle = 'white';
	tracequadrilataire_plein(largeur_laser/2.5,-bas_laser,-largeur_laser/2.5,-bas_laser,-largeur_laser/2.5,-haut_laser,largeur_laser/2.5,-haut_laser);
	ctx.rotate(-angle_canon);
	ctx.translate(-canvas.width/2,-hauteur_rect+largeur_socle/4+largeur_socle/3);
}

function mise_a_jour_laser()
{
	if((clic_en_cours==1)&&(selection_arme==2))
	{
		if((maintenant-dernier_tir_laser)>temps_entre_2_laser)
		{
			//alert(maintenant-dernier_tir_laser);
			dernier_tir_laser=maintenant;
			laser_ON=1;
			//alert(0);
		}
	}
	if(((maintenant-dernier_tir_laser)>duree_laser)&&(laser_ON==1))
	{
		t_OFF_laser=maintenant;
		laser_ON=0;
	}
	haut_laser=Math.min((maintenant-dernier_tir_laser)*vitesse_lumiere*hauteur_rect,2*hauteur_rect);
	if(laser_ON==1)
	{
		bas_laser=0;
	}
	else
	{
		bas_laser=Math.min((maintenant-(dernier_tir_laser+duree_laser))*vitesse_lumiere*hauteur_rect,2*hauteur_rect);
	}
	
}


function mise_a_jour_miss_TC()
{
	var nb_miss_TC=0;
	var undiz=0;
	var nb_menaces=0;
	var long_min=99999;
	var distance=0;
	var angle_max=angle_vue_AD*Math.PI/180;
	var angle_miss_miss=0;
	var ind_long_min=0;
	var trois_dice=0;
	var dist_miss_miss_X=0;
	var dist_miss_miss_Y=0;
	var vit_miss_TC_loc=0;
	var test_ang_miss=0;
	var facteur_vit_avant_apres_loc=0;
	var rot_max=vit_rot_max_TC*deltat*Math.PI/180;
	var delta_rotation=0;
	var angle_miss_TC_loc=0;
	if((clic_en_cours==1)&&(selection_arme==1))
	{
		if((maintenant-dernier_tir_TC)>temps_entre_2_miss_TC)
		{
			creation_miss_TC();
			dernier_tir_TC=maintenant;
		}
	}
	nb_miss_TC=vit_x_miss_TC.length;
	for(trois_dice=0;trois_dice<nb_miss_TC;trois_dice++)
	{
		long_min=99999;
		angle_miss_TC_loc=calcul_angle_miss(vit_x_miss_TC[trois_dice],vit_y_miss_TC[trois_dice]);
		delta_rotation=0;
		vit_miss_TC_loc=(vit_x_miss_TC[trois_dice]**2+vit_y_miss_TC[trois_dice]**2)**(1/2)*(1+accel_miss_TC*deltat);
		nb_menaces=pos_x_miss.length;
		for(undiz=0;undiz<nb_menaces;undiz++)
		{
			dist_miss_miss_X=pos_x_miss[undiz]-pos_x_miss_TC[trois_dice];
			dist_miss_miss_Y=pos_y_miss[undiz]-pos_y_miss_TC[trois_dice];
			distance=(dist_miss_miss_X**2+dist_miss_miss_Y**2)**(1/2);
			angle_miss_miss=calcul_angle_miss(dist_miss_miss_X,dist_miss_miss_Y)-angle_miss_TC_loc;
			if (angle_miss_miss>Math.PI)
			{
				angle_miss_miss=angle_miss_miss-2*Math.PI;
			}
			else if (angle_miss_miss<-Math.PI)
			{
				angle_miss_miss=angle_miss_miss+2*Math.PI;
			}
			if((distance<long_min)&&(Math.abs(angle_miss_miss)<=angle_max)&&(distance<=portee_AD*hauteur_rect))
			{
				long_min=distance;
				ind_long_min=undiz;
				delta_rotation=Math.max(Math.min(angle_miss_miss,rot_max),-rot_max);
				//alert(delta_rotation);
				//test_ang_miss=angle_miss_miss*180/Math.PI;
			}
		}
		vit_x_miss_TC[trois_dice]=vit_miss_TC_loc*Math.sin(delta_rotation+angle_miss_TC_loc);
		vit_y_miss_TC[trois_dice]=-vit_miss_TC_loc*Math.cos(delta_rotation+angle_miss_TC_loc);
		//alert(vit_x_miss_TC[trois_dice]);
		//alert(vit_y_miss_TC[trois_dice]);
		delta_piX=hauteur_rect*vit_x_miss_TC[trois_dice]*deltat;
		delta_piY=hauteur_rect*vit_y_miss_TC[trois_dice]*deltat;
		pos_x_miss_TC[trois_dice]=pos_x_miss_TC[trois_dice]+delta_piX;
		pos_y_miss_TC[trois_dice]=pos_y_miss_TC[trois_dice]+delta_piY;
		if((pos_y_miss_TC[trois_dice]<(-hauteur_rect/10))||(pos_x_miss_TC[trois_dice]>11*canvas.width/10)||(pos_x_miss_TC[trois_dice]<-canvas.width/10))
		{
			suppression_miss_TC(trois_dice);
			//alert(0);
			trois_dice--;
			nb_miss_TC--;
		}
	}
}

function mise_a_jour_boulets()
{
	var nb_boulets=0;
	var trois_dice=0;
	var delta_piX=0;
	var delta_piY=0;
	if((clic_en_cours==1)&&(selection_arme==0))
	{
		if((maintenant-dernier_tir_boulet)>temps_entre_2_boulets)
		{
			creation_boulet();
			dernier_tir_boulet=maintenant;
		}
	}
	nb_boulets=vit_x_boulet.length;
	for(trois_dice=0;trois_dice<nb_boulets;trois_dice++)
	{
		delta_piX=hauteur_rect*vit_x_boulet[trois_dice]*deltat;
		delta_piY=hauteur_rect*vit_y_boulet[trois_dice]*deltat;
		pos_x_boulet[trois_dice]=pos_x_boulet[trois_dice]+delta_piX;
		pos_y_boulet[trois_dice]=pos_y_boulet[trois_dice]+delta_piY;
		if((pos_y_boulet[trois_dice]<(-hauteur_rect/10))||(pos_x_boulet[trois_dice]>11*canvas.width/10)||(pos_x_boulet[trois_dice]<-canvas.width/10))
		{
			suppression_boulet(trois_dice);
			trois_dice--;
			nb_boulets--;
		}
	}
}

function creation_boulet(){
	vit_x_boulet.push(vit_boulets*Math.sin(angle_canon));
	vit_y_boulet.push(-vit_boulets*Math.cos(angle_canon));
	pos_x_boulet.push(canvas.width/2);
	pos_y_boulet.push(hauteur_rect-largeur_socle/4-largeur_socle/3);
}

function creation_miss_TC(){
	vit_x_miss_TC.push(vit_miss_TC*Math.sin(angle_canon));
	vit_y_miss_TC.push(-vit_miss_TC*Math.cos(angle_canon));
	pos_x_miss_TC.push(canvas.width/2);
	pos_y_miss_TC.push(hauteur_rect-largeur_socle/4-largeur_socle/3);
}

function mise_a_j_pos_bat(nb_imm){
     var ind=0;
     var somme_large = 0;
     for(ind=0;ind<nb_imm;ind++)
     {
        largeur_immeubles.push(25+Math.floor(Math.random()*45));
         hauteur_immeubles.push(25+Math.floor(Math.random()*45));
		posi_immeubles.push(Math.floor(Math.random()*(canvas.width-largeur_immeubles[ind])));
		etat_facade_droite.push(0);
		etat_facade_gauche.push(0);
     }
}

function mise_a_jour_missiles() {
	var trois_dice=0;
	var deux_dice=0;
	var undiz=0;
	var nb_miss=0;
	var delta_pixel_y=0;
	var delta_pixel_x=0;
	var min_vit_x=0;
	var max_vit_x=0;
	var dist_miss_bat_X=0;
	var dist_miss_bat_Y=0;
	var distance=0;
	var angle_miss_bat=0;
	var angle_miss_TC_loc=0;
	var long_min=999999;
	var ind_long_min=0;
	var delta_rotation=0;
	var rot_max=vit_rot_max_TC*deltat*Math.PI/180*2/3;
	var module_delta=0;
	var test_x=0;
	var test_y=0;
	if(last_miss_date==0)
	{
	    delay_before_next_miss=min_delay_between_2_miss+Math.random()*(max_delay_between_2_miss-min_delay_between_2_miss);
	    last_miss_date=maintenant;
	}
	if((maintenant-last_miss_date)>=delay_before_next_miss)
	{
	     delay_before_next_miss=min_delay_between_2_miss+Math.random()*(max_delay_between_2_miss-min_delay_between_2_miss);
	     last_miss_date=maintenant;   
		creation_missile();
	}
	nb_miss=pos_x_miss.length;
	for(trois_dice=0;trois_dice<nb_miss;trois_dice++)
	{
		//alert(pos_y_miss[trois_dice]);
		if((type_miss[trois_dice]==1)&&(pos_y_miss[trois_dice]>hauteur_rect/2))
		{
			angle_miss_TC_loc=calcul_angle_miss(vit_x_miss[trois_dice]*canvas.width,vit_y_miss[trois_dice]*hauteur_rect);
			long_min=999999;
			//alert(angle_miss_TC_loc*180/Math.PI);
			for(undiz=0;undiz<nb_immeubles;undiz++)
			{
				for(deux_dice=0;deux_dice<2;deux_dice++)
				{
					if(deux_dice==0)
					{
						if(etat_facade_gauche[undiz]==0)
						{
							test_x=posi_immeubles[undiz]+largeur_immeubles[undiz]/4;
							test_y=hauteur_rect-hauteur_immeubles[undiz]*3/4;
						}
						else if(etat_facade_gauche[undiz]==1)
						{
							test_x=posi_immeubles[undiz]+largeur_immeubles[undiz]/4;
							test_y=hauteur_rect-hauteur_immeubles[undiz]/4;
						}
						else
						{
							test_x=1000;
							test_y=1000;
						}
					}
					else
					{
						if(etat_facade_droite[undiz]==0)
						{
							test_x=posi_immeubles[undiz]+largeur_immeubles[undiz]*3/4;
							test_y=hauteur_rect-hauteur_immeubles[undiz]*3/4;
						}
						else if(etat_facade_droite[undiz]==1)
						{
							test_x=posi_immeubles[undiz]+largeur_immeubles[undiz]*3/4;
							test_y=hauteur_rect-hauteur_immeubles[undiz]/4;
						}
						else
						{
							test_x=1000;
							test_y=1000;
						}
					}
					dist_miss_bat_X=-pos_x_miss[trois_dice]+test_x;
					dist_miss_bat_Y=-pos_y_miss[trois_dice]+test_y;
					//alert(dist_miss_bat_X/canvas.width);
					distance=(dist_miss_bat_X**2+dist_miss_bat_Y**2)**(1/2);
					angle_miss_bat=calcul_angle_miss(dist_miss_bat_X,dist_miss_bat_Y)-angle_miss_TC_loc;
					//alert(angle_miss_bat*180/Math.PI/deltat);
					if (angle_miss_bat>Math.PI)
					{
						angle_miss_bat=angle_miss_bat-2*Math.PI;
					}
					else if (angle_miss_bat<-Math.PI)
					{
						angle_miss_bat=angle_miss_bat+2*Math.PI;
					}
					//alert(angle_miss_bat*180/Math.PI);
					if(distance<long_min)
					{
						long_min=distance;
						ind_long_min=undiz;
						
						delta_rotation=Math.max(Math.min(angle_miss_bat,rot_max),-rot_max);
						//alert(delta_rotation);
						//test_ang_miss=angle_miss_miss*180/Math.PI;
					}
				}
			}
			
			//alert(delta_rotation*180/Math.PI);
			//alert(ind_long_min);
			/*
			vit_x_miss_TC[trois_dice]=vit_miss_TC_loc*Math.sin(delta_rotation+angle_miss_TC_loc);
			vit_y_miss_TC[trois_dice]=-vit_miss_TC_loc*Math.cos(delta_rotation+angle_miss_TC_loc);
			//alert(vit_x_miss_TC[trois_dice]);
			//alert(vit_y_miss_TC[trois_dice]);
			delta_piX=hauteur_rect*vit_x_miss_TC[trois_dice]*deltat;
			delta_piY=hauteur_rect*vit_y_miss_TC[trois_dice]*deltat;
			*/
			delta_pixel_x=canvas.width*vit_x_miss[trois_dice]*deltat;
			delta_pixel_y=hauteur_rect*vit_y_miss[trois_dice]*deltat;
			module_delta=(delta_pixel_x**2+delta_pixel_y**2)**(1/2);
			delta_pixel_x=module_delta*Math.sin(delta_rotation+angle_miss_TC_loc);
			delta_pixel_y=-module_delta*Math.cos(delta_rotation+angle_miss_TC_loc);
			vit_x_miss[trois_dice]=delta_pixel_x/deltat/canvas.width;
			vit_y_miss[trois_dice]=delta_pixel_y/deltat/hauteur_rect;
			angle_miss[trois_dice]=calcul_angle_miss(delta_pixel_x,delta_pixel_y);
		}
		else
		{
			delta_pixel_x=canvas.width*vit_x_miss[trois_dice]*deltat;
			delta_pixel_y=hauteur_rect*vit_y_miss[trois_dice]*deltat;
		}
		pos_x_miss[trois_dice]=pos_x_miss[trois_dice]+delta_pixel_x;
		pos_y_miss[trois_dice]=pos_y_miss[trois_dice]+delta_pixel_y;
		etat_propu[trois_dice]=(etat_propu[trois_dice]+1)%3;
		if(pos_y_miss[trois_dice]>ligne_arrivee_miss*hauteur_rect)
		{
			suppression_missile(trois_dice)
			trois_dice--;
			nb_miss--;
		}
	}
}

function trace_arme()
{
	ctx.strokeStyle = 'black';
	ctx.fillStyle = 'pink';
	ctx.beginPath();
	ctx.lineTo(canvas.width/2-largeur_socle/2,hauteur_rect);
	ctx.lineTo(canvas.width/2-largeur_socle/2,hauteur_rect-largeur_socle/6);
	ctx.lineTo(canvas.width/2,hauteur_rect-largeur_socle/6-largeur_socle/3);
	ctx.lineTo(canvas.width/2-largeur_socle/6,hauteur_rect-largeur_socle/6);
	ctx.lineTo(canvas.width/2+largeur_socle/6,hauteur_rect-largeur_socle/6);
	ctx.lineTo(canvas.width/2,hauteur_rect-largeur_socle/6-largeur_socle/3);
	ctx.lineTo(canvas.width/2+largeur_socle/2,hauteur_rect-largeur_socle/6);
	ctx.lineTo(canvas.width/2+largeur_socle/2,hauteur_rect-largeur_socle/6);
	ctx.lineTo(canvas.width/2+largeur_socle/2,hauteur_rect);
		//ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		//ctx.lineTo(larg_mis_sur_2/4, long_p_cent+2.8*long_par);
		//ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		//ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(canvas.width/2-largeur_socle/2,hauteur_rect);
		ctx.closePath();
		ctx.fill();
		ctx.stroke();
		
	ctx.translate(canvas.width/2,hauteur_rect-largeur_socle/4-largeur_socle/3);
	ctx.rotate(angle_canon);
	ctx.beginPath();
	ctx.arc(0, 0, largeur_socle/5, -Math.PI/2+Math.PI/6, 3*Math.PI/2-Math.PI/6,false);
	ctx.lineTo(-largeur_socle/10,-largeur_socle/3);
	ctx.lineTo(largeur_socle/10,-largeur_socle/3);
	//ctx.lineTo(0,0);
    ctx.closePath();
	ctx.fill();
	ctx.stroke();
	ctx.rotate(-angle_canon);
	ctx.translate(-canvas.width/2,-hauteur_rect+largeur_socle/4+largeur_socle/3);
}

function creation_missile()
{
	//proportion_type_missile
	var type_de_missile=5;
	var somme_prop=0;
	var prop_cumul=[];
	var i=0;
	var randome=0;
	for(i=0;i<proportion_type_missile.length;i++)
	{
		somme_prop=somme_prop+proportion_type_missile[i];
		prop_cumul.push(somme_prop);
		//alert("prop cum "+i+" : "+prop_cumul[i]);
	}
	randome=somme_prop*Math.random();
	for(i=proportion_type_missile.length-1;i>=0;i--)
	{
		if(prop_cumul[i]>randome)
		{
			type_de_missile=i;
		}
	}
	//type_de_missile=Math.floor(Math.random()*nb_enemy_max);
     vit_y_miss.push(vit_min_traverse_ecran[type_de_missile]+Math.random()*(vit_max_traverse_ecran[type_de_missile]-vit_min_traverse_ecran[type_de_missile]));
     pos_x_miss.push(-ligne_depart_miss*canvas.width+Math.random()*canvas.width*(1+2*ligne_depart_miss));
	 if(pos_x_miss[pos_x_miss.length-1]<=0)
	{
		min_vit_x=vit_y_miss[vit_y_miss.length-1]*((-pos_x_miss[pos_x_miss.length-1])/canvas.width)/ligne_depart_miss;
		max_vit_x=vit_y_miss[vit_y_miss.length-1]*(1-pos_x_miss[pos_x_miss.length-1]/canvas.width)/(1+ligne_depart_miss);
	}
     else if(pos_x_miss[pos_x_miss.length-1]>=canvas.width)
	{
		min_vit_x=vit_y_miss[vit_y_miss.length-1]*((-pos_x_miss[pos_x_miss.length-1])/canvas.width)/(1+ligne_depart_miss);
		max_vit_x=vit_y_miss[vit_y_miss.length-1]*(1-pos_x_miss[pos_x_miss.length-1]/canvas.width)/(ligne_depart_miss);
	}
	else
	{
		min_vit_x=vit_y_miss[vit_y_miss.length-1]*((-pos_x_miss[pos_x_miss.length-1])/canvas.width)/(1+ligne_depart_miss);
		max_vit_x=vit_y_miss[vit_y_miss.length-1]*(1-pos_x_miss[pos_x_miss.length-1]/canvas.width)/(1+ligne_depart_miss);
	}
	vit_x_miss.push(min_vit_x+Math.random()*(max_vit_x-min_vit_x));
     //alert(vit_x_miss[vit_x_miss.length-1]);
      pos_y_miss.push(-hauteur_rect*ligne_depart_miss);
     type_miss.push(type_de_missile);
	 etat_propu.push(0);
	angle_miss.push(calcul_angle_miss(canvas.width*vit_x_miss[vit_x_miss.length-1],hauteur_rect*vit_y_miss[vit_y_miss.length-1]));
}

function creat_double_miss(x_miss_decede,y_miss_decede)
{
	var index=0;
     for(index=0;index<2;index++)
     {
		vit_y_miss.push(vit_min_traverse_ecran[2]+Math.random()*(vit_max_traverse_ecran[2]-vit_min_traverse_ecran[2]));
	     pos_x_miss.push(x_miss_decede);
	     pos_y_miss.push(y_miss_decede);
		 if(pos_x_miss[pos_x_miss.length-1]<=0)
		{
			min_vit_x=vit_y_miss[vit_y_miss.length-1]*((-pos_x_miss[pos_x_miss.length-1])/canvas.width)/(-y_miss_decede/hauteur_rect);
			max_vit_x=vit_y_miss[vit_y_miss.length-1]*(1-pos_x_miss[pos_x_miss.length-1]/canvas.width)/(1+(-y_miss_decede/hauteur_rect));
		}
	     else if(pos_x_miss[pos_x_miss.length-1]>=canvas.width)
		{
			min_vit_x=vit_y_miss[vit_y_miss.length-1]*((-pos_x_miss[pos_x_miss.length-1])/canvas.width)/(1+(-y_miss_decede/hauteur_rect));
			max_vit_x=vit_y_miss[vit_y_miss.length-1]*(1-pos_x_miss[pos_x_miss.length-1]/canvas.width)/((-y_miss_decede/hauteur_rect));
		}
		else
		{
			min_vit_x=vit_y_miss[vit_y_miss.length-1]*((-pos_x_miss[pos_x_miss.length-1])/canvas.width)/(1+(-y_miss_decede/hauteur_rect));
			max_vit_x=vit_y_miss[vit_y_miss.length-1]*(1-pos_x_miss[pos_x_miss.length-1]/canvas.width)/(1+(-y_miss_decede/hauteur_rect));
		}
		vit_x_miss.push(min_vit_x+Math.random()*(max_vit_x-min_vit_x));
	     //alert(vit_x_miss[vit_x_miss.length-1]);
	     type_miss.push(0);
		 etat_propu.push(0);
		angle_miss.push(calcul_angle_miss(canvas.width*vit_x_miss[vit_x_miss.length-1],hauteur_rect*vit_y_miss[vit_y_miss.length-1]));
	}
}

function calcul_angle_miss(vit_x,vit_y)
{
	var angle;
	if (vit_x>0)
	{
		angle=Math.atan(vit_y/vit_x)+Math.PI/2;
	}
	else if (vit_x<0)
	{
	     angle=Math.atan(vit_y/vit_x)+Math.PI*3/2;
	}
	else if (vit_y>0)
	{
		angle=Math.PI;
	}
	else
	{
		angle=0;
	}
	return angle;
}

/*
var dernier_tir_TC=0;
var portee_AD=1/5;
var temps_entre_2_miss_TC=0.11;
var vit_miss_TC=0.7;
var accel_miss_TC=0.7;
var facteur_vit_avant_apres=1;//0.5;
var vit_x_miss_TC=[];
var vit_y_miss_TC=[];
var pos_x_miss_TC=[];
var pos_y_miss_TC=[];
var taille_miss_TC=facteur_taille*20;
*/

function mise_a_jour_impact_miss_laser()
{
	var undice=0;
	var resultat_collision=0;
	var nb_missiles_a_tester=pos_x_miss.length;
	var x_p_1=0;
	var x_p_2=0;
	var x_p_3=0;
	var x_p_4=0;
	var y_p_1=0;
	var y_p_2=0;
	var y_p_3=0;
	var y_p_4=0;
	for(undice=0;undice<nb_missiles_a_tester;undice++)
	{
			//pos_x_point_1=(largeur_corps_miss[type_miss[undice]]/2)*Math.cos(angle_miss[undice])+0*Math.sin(angle_miss[undice]);
	//pos_y_point_1=-(largeur_corps_miss[type_miss[undice]]/2)*Math.sin(angle_miss[undice])+0*Math.cos(angle_miss[undice]);
			x_p_1=pos_x_miss[undice]+(largeur_corps_miss[type_miss[undice]]/2)*Math.cos(angle_miss[undice])-0*Math.sin(angle_miss[undice]);
			y_p_1=pos_y_miss[undice]+((largeur_corps_miss[type_miss[undice]]/2)*Math.sin(angle_miss[undice])+0*Math.cos(angle_miss[undice]));
			x_p_2=pos_x_miss[undice]+(-largeur_corps_miss[type_miss[undice]]/2)*Math.cos(angle_miss[undice])-0*Math.sin(angle_miss[undice]);
			y_p_2=pos_y_miss[undice]+((-largeur_corps_miss[type_miss[undice]]/2)*Math.sin(angle_miss[undice])+0*Math.cos(angle_miss[undice]));
			x_p_3=pos_x_miss[undice]+(-largeur_corps_miss[type_miss[undice]]/2)*Math.cos(angle_miss[undice])-longueur_corps_miss[type_miss[undice]]*Math.sin(angle_miss[undice]);
			y_p_3=pos_y_miss[undice]+((-largeur_corps_miss[type_miss[undice]]/2)*Math.sin(angle_miss[undice])+longueur_corps_miss[type_miss[undice]]*Math.cos(angle_miss[undice]));
			x_p_4=pos_x_miss[undice]+(largeur_corps_miss[type_miss[undice]]/2)*Math.cos(angle_miss[undice])-longueur_corps_miss[type_miss[undice]]*Math.sin(angle_miss[undice]);
			y_p_4=pos_y_miss[undice]+((largeur_corps_miss[type_miss[undice]]/2)*Math.sin(angle_miss[undice])+longueur_corps_miss[type_miss[undice]]*Math.cos(angle_miss[undice]));
			
			
			/*ctx.strokeStyle = 'red';
			tracequadrilataire(x_p_1,y_p_1,x_p_2,y_p_2,x_p_3,y_p_3,x_p_4,y_p_4);*/
			resultat_collision=test_collision_segment_vs_laser(x_p_1,y_p_1,x_p_2,y_p_2,angle_canon,largeur_laser,bas_laser,haut_laser);
			resultat_collision=test_collision_segment_vs_laser(x_p_2,y_p_2,x_p_3,y_p_3,angle_canon,largeur_laser,bas_laser,haut_laser)+resultat_collision;
			resultat_collision=test_collision_segment_vs_laser(x_p_3,y_p_3,x_p_4,y_p_4,angle_canon,largeur_laser,bas_laser,haut_laser)+resultat_collision;
			resultat_collision=test_collision_segment_vs_laser(x_p_4,y_p_4,x_p_1,y_p_1,angle_canon,largeur_laser,bas_laser,haut_laser)+resultat_collision;
			if(resultat_collision>0)
			{
				if(type_miss[undice]!=2)
				{
					suppression_missile(undice);
					undice--;
					nb_missiles_a_tester--;
				}
				else
				{
					creat_double_miss(pos_x_miss[undice],pos_y_miss[undice]);
					suppression_missile(undice);
					undice--;
					nb_missiles_a_tester++;
				}
			}
	}
}

function mise_a_jour_impact_miss_miss()
{
	var undice=0;
	var deuxdice=0;
	var resultat_collision=0;
	var nb_missiles_a_tester=pos_x_miss.length;
	var nb_miss_TC_a_tester=vit_x_miss_TC.length;
	for(undice=0;undice<nb_missiles_a_tester;undice++)
	{
		for(deuxdice=0;deuxdice<nb_miss_TC_a_tester;deuxdice++)
		{
			resultat_collision=test_collision_boulet_vs_miss(pos_x_miss[undice],pos_y_miss[undice],type_miss[undice],angle_miss[undice],pos_x_miss_TC[deuxdice],pos_y_miss_TC[deuxdice],taille_miss_TC);
			//alert(resultat_collision);
			if(resultat_collision==1)
			{
				if(type_miss[undice]!=2)
				{
					suppression_missile(undice);
					undice--;
					nb_missiles_a_tester--;
				}
				else
				{
					creat_double_miss(pos_x_miss[undice],pos_y_miss[undice]);
					suppression_missile(undice);
					undice--;
					nb_missiles_a_tester++;
				}
				suppression_miss_TC(deuxdice);
				deuxdice--;
				nb_miss_TC_a_tester--;
			}
		}
	}
}

function mise_a_jour_impact_miss_boulet()
{
	var undice=0;
	var deuxdice=0;
	var resultat_collision=0;
	var nb_missiles_a_tester=pos_x_miss.length;
	var nb_boulets_a_tester=vit_x_boulet.length;
	for(undice=0;undice<nb_missiles_a_tester;undice++)
	{
		for(deuxdice=0;deuxdice<nb_boulets_a_tester;deuxdice++)
		{
			resultat_collision=test_collision_boulet_vs_miss(pos_x_miss[undice],pos_y_miss[undice],type_miss[undice],angle_miss[undice],pos_x_boulet[deuxdice],pos_y_boulet[deuxdice],taille_boulet);
			//alert(resultat_collision);
			if(resultat_collision==1)
			{
				if(type_miss[undice]!=2)
				{
					suppression_missile(undice);
					undice--;
					nb_missiles_a_tester--;
				}
				else
				{
					creat_double_miss(pos_x_miss[undice],pos_y_miss[undice]);
					suppression_missile(undice);
					undice--;
					nb_missiles_a_tester++;
				}
				suppression_boulet(deuxdice);
				deuxdice--;
				nb_boulets_a_tester--;
				//alert(resultat_collision);
			}
		}
	}
}

function test_collision_segment_vs_laser(pos_x_point_1,pos_y_point_1,pos_x_point_2,pos_y_point_2,angle_laser,larg_laser,laser_bas,laser_haut)
{
	var resultat=0;
	pos_x_point_1=pos_x_point_1-canvas.width/2;
	pos_y_point_1=pos_y_point_1-(hauteur_rect-largeur_socle/4-largeur_socle/3);
	pos_x_point_1=pos_x_point_1*Math.cos(angle_laser)+pos_y_point_1*Math.sin(angle_laser);
	pos_y_point_1=-pos_x_point_1*Math.sin(angle_laser)+pos_y_point_1*Math.cos(angle_laser);
	
	pos_x_point_2=pos_x_point_2-canvas.width/2;
	pos_y_point_2=pos_y_point_2-(hauteur_rect-largeur_socle/4-largeur_socle/3);
	pos_x_point_2=pos_x_point_2*Math.cos(angle_laser)+pos_y_point_2*Math.sin(angle_laser);
	pos_y_point_2=-pos_x_point_2*Math.sin(angle_laser)+pos_y_point_2*Math.cos(angle_laser);
	if((pos_x_point_1<=larg_laser/2)&&(pos_x_point_1>=(-larg_laser/2))&&(pos_y_point_1<=(-laser_bas))&&(pos_y_point_1>=(-laser_haut)))
	{
		resultat=1;
	}
	else if((pos_x_point_2<=larg_laser/2)&&(pos_x_point_2>=(-larg_laser/2))&&(pos_y_point_2<=(-laser_bas))&&(pos_y_point_2>=(-laser_haut)))
	{
		resultat=1;
	}
	else if((pos_x_point_2>=larg_laser/2)&&(pos_x_point_1<=(-larg_laser/2))&&(pos_y_point_1<=(-laser_bas))&&(pos_y_point_1>=(-laser_haut))&&(pos_y_point_2<=(-laser_bas))&&(pos_y_point_2>=(-laser_haut)))
	{
		resultat=1;
	}
	else if((pos_x_point_1>=larg_laser/2)&&(pos_x_point_2<=(-larg_laser/2))&&(pos_y_point_1<=(-laser_bas))&&(pos_y_point_1>=(-laser_haut))&&(pos_y_point_2<=(-laser_bas))&&(pos_y_point_2>=(-laser_haut)))
	{
		resultat=1;
	}
	return resultat;
}

function test_collision_boulet_vs_miss(missileX,missileY,missileType,missileAngle,BouletX,BouletY,BouletTaille)
{
	var resultat=0;
	BouletX=BouletX-missileX;
	BouletY=BouletY-missileY;
	BouletX=BouletX*Math.cos(missileAngle)+BouletY*Math.sin(missileAngle);
	BouletY=-BouletX*Math.sin(missileAngle)+BouletY*Math.cos(missileAngle);
	if((BouletX<=(largeur_corps_miss[missileType]/2+BouletTaille))&&(BouletX>=(-largeur_corps_miss[missileType]/2-BouletTaille))&&(BouletY<=(longueur_corps_miss[missileType]+BouletTaille))&&(BouletY>=-BouletTaille))
	{
		resultat=1;
	}
	return resultat;
}

function mise_a_jour_impact_avec_immeuble()
{
	var undice=0;
	var deuxdice=0;
	
    var taille_t_miss=0;
	var posXmiss=0;
	var posYmiss=0;
	
	var largimm=0;
	var hautimm=0;
	var posimm=0;
	var etat_d=0;
	var etat_g=0;
	
	for(undice=(pos_x_miss.length-1);undice>=0;undice--)
	{
		//alert(pos_x_miss.length);
		//ctx.fillStyle = 'red';
		//tracerond(pos_x_miss[undice],pos_y_miss[undice],taille_tete_miss_par_type[type_miss[undice]]);
		for(deuxdice=(posi_immeubles.length-1);deuxdice>=0;deuxdice--)
		{
			taille_t_miss=taille_tete_miss_par_type[type_miss[undice]];
			posXmiss=pos_x_miss[undice];
			posYmiss=pos_y_miss[undice];
	
			largimm=largeur_immeubles[deuxdice];
			hautimm=hauteur_immeubles[deuxdice];
			posimm=posi_immeubles[deuxdice];
			
			etat_d=etat_facade_droite[deuxdice];
			etat_g=etat_facade_gauche[deuxdice];
            
			if((posXmiss>(posimm-taille_t_miss))&&(posXmiss<(posimm+largimm/2))&&(posYmiss>(hauteur_rect-hautimm-taille_t_miss))&&(posYmiss<(hauteur_rect-taille_t_miss))&&(etat_g==0))
			{
				//alert("impact gauche");
				x_bat_explose.push(posimm+largimm/4);
				y_bat_explose.push(hauteur_rect-hautimm*3/4);
				x_miss_explose.push(posXmiss);
				y_miss_explose.push(posYmiss);
				date_impact.push(maintenant);
				vit_x_miss_exlpose.push(vit_x_miss[undice]);
				vit_y_miss_explose.push(vit_y_miss[undice]);
				 ind_immeuble_explosion.push(deuxdice);
				etat_facade_gauche[deuxdice]=1;
				suppression_missile(undice);
			}
			else if((posXmiss>(posimm+largimm/2))&&(posXmiss<(posimm+largimm+taille_t_miss))&&(posYmiss>(hauteur_rect-hautimm-taille_t_miss))&&(posYmiss<(hauteur_rect-taille_t_miss))&&(etat_d==0))
			{
				//alert("impact droite");
				x_bat_explose.push(posimm+largimm*3/4);
				y_bat_explose.push(hauteur_rect-hautimm*3/4);
				x_miss_explose.push(posXmiss);
				y_miss_explose.push(posYmiss);
				date_impact.push(maintenant);
				vit_x_miss_exlpose.push(vit_x_miss[undice]);
				vit_y_miss_explose.push(vit_y_miss[undice]);
				ind_immeuble_explosion.push(deuxdice);
				etat_facade_droite[deuxdice]=1;
				suppression_missile(undice);
			}
			else if((posXmiss>(posimm-taille_t_miss))&&(posXmiss<(posimm+largimm/2))&&(posYmiss>(hauteur_rect-hautimm/2-taille_t_miss))&&(posYmiss<(hauteur_rect-taille_t_miss))&&(etat_g==1))
			{
				//alert("impact gauche");
				x_bat_explose.push(posimm+largimm/4);
				y_bat_explose.push(hauteur_rect-hautimm/4);
				x_miss_explose.push(posXmiss);
				y_miss_explose.push(posYmiss);
				date_impact.push(maintenant);
				vit_x_miss_exlpose.push(vit_x_miss[undice]);
				vit_y_miss_explose.push(vit_y_miss[undice]);
				ind_immeuble_explosion.push(deuxdice);
				etat_facade_gauche[deuxdice]=2;
				suppression_missile(undice);
			}
			else if((posXmiss>(posimm+largimm/2))&&(posXmiss<(posimm+largimm+taille_t_miss))&&(posYmiss>(hauteur_rect-hautimm/2-taille_t_miss))&&(posYmiss<(hauteur_rect-taille_t_miss))&&(etat_d==1))
			{
				//alert("impact droite");
				x_bat_explose.push(posimm+largimm*3/4);
				y_bat_explose.push(hauteur_rect-hautimm/4);
				x_miss_explose.push(posXmiss);
				y_miss_explose.push(posYmiss);
				date_impact.push(maintenant);
				vit_x_miss_exlpose.push(vit_x_miss[undice]);
				vit_y_miss_explose.push(vit_y_miss[undice]);
				ind_immeuble_explosion.push(deuxdice);
				etat_facade_droite[deuxdice]=2;
				suppression_missile(undice);
			}
			
		}
	}
}

function suppression_boulet(ind_a_suppr)
{
	vit_x_boulet.splice(ind_a_suppr,1);
	vit_y_boulet.splice(ind_a_suppr,1);
	pos_x_boulet.splice(ind_a_suppr,1);
	pos_y_boulet.splice(ind_a_suppr,1);
}

function suppression_miss_TC(ind_a_suppr)
{
	
	vit_x_miss_TC.splice(ind_a_suppr,1);
	vit_y_miss_TC.splice(ind_a_suppr,1);
	pos_x_miss_TC.splice(ind_a_suppr,1);
	//alert(pos_y_miss_TC.length);
	pos_y_miss_TC.splice(ind_a_suppr,1);
	//alert(pos_y_miss_TC.length);
	//alert(1);
}

function suppression_missile(ind_a_suppr)
{
	vit_y_miss.splice(ind_a_suppr,1);
	vit_x_miss.splice(ind_a_suppr,1);
    pos_x_miss.splice(ind_a_suppr,1);
    pos_y_miss.splice(ind_a_suppr,1);
    type_miss.splice(ind_a_suppr,1);
	etat_propu.splice(ind_a_suppr,1);
	angle_miss.splice(ind_a_suppr,1);
}

function traces_miss_TC()
{
	var deux_dice=0;
	var nombre_puins = pos_x_miss_TC.length;
	if (nombre_puins>=1)
	{
		//alert(nombre_puins);
		for (deux_dice=0;deux_dice<nombre_puins;deux_dice++)
		{
			trace_1_miss_TC(pos_x_miss_TC[deux_dice],pos_y_miss_TC[deux_dice],calcul_angle_miss(vit_x_miss_TC[deux_dice],vit_y_miss_TC[deux_dice]),Math.random()*3);
		    //ctx.fillStyle = 'red';
			//tracerond(pos_x_miss_TC[deux_dice],pos_y_miss_TC[deux_dice],taille_miss_TC);
			//alert(taille_tete_miss_par_type[type_miss[deux_dice]]);
	    }
	}
}

function traces_boulets()
{
	var deux_dice=0;
	var nombre_puins = pos_x_boulet.length;
	if (nombre_puins>=1)
	{
		//alert(nombre_puins);
		for (deux_dice=0;deux_dice<nombre_puins;deux_dice++)
		{
		    ctx.fillStyle = 'black';
			tracerond(pos_x_boulet[deux_dice],pos_y_boulet[deux_dice],taille_boulet);
			//alert(taille_tete_miss_par_type[type_miss[deux_dice]]);
	    }
	}
}

function trace_missiles(){
	var deux_dice=0;
	var nombre_puins = pos_x_miss.length;
	if (nombre_puins>=1)
	{
		for (deux_dice=0;deux_dice<nombre_puins;deux_dice++)
		{
			if(type_miss[deux_dice]==0)
			{
			    trace_1_miss_type_0(pos_x_miss[deux_dice],pos_y_miss[deux_dice],angle_miss[deux_dice],etat_propu[deux_dice]);
			}
			else if(type_miss[deux_dice]==1)
			{
			    trace_1_miss_type_1(pos_x_miss[deux_dice],pos_y_miss[deux_dice],angle_miss[deux_dice],etat_propu[deux_dice]);
			}
			else if(type_miss[deux_dice]==2)
			{
			    trace_1_miss_type_2(pos_x_miss[deux_dice],pos_y_miss[deux_dice],angle_miss[deux_dice],etat_propu[deux_dice]);
			}
			
			
			//alert(taille_tete_miss_par_type[type_miss[deux_dice]]);
	    }
	}
}

function trace_1_miss_TC(pos_mX,pos_mY,Anguele,flamme)
{
	//alert(canvas.widt);
	var taille_mis=facteur_taille*2/3;
	var X_cent_cercle=20*taille_mis;
	var Y_cent_cercle=5*taille_mis;
	var diam_cercle=40*taille_mis;
	var long_p_cent=145*taille_mis;
	var long_par=50*taille_mis;
	var larg_mis_sur_2=Math.cos(Math.asin(Y_cent_cercle/diam_cercle))*diam_cercle-X_cent_cercle;
	var larg_wg=25*taille_mis;
	var long_wg=70*taille_mis;
	var ang_wg=40*Math.PI/180;
	
	ctx.translate(pos_mX,pos_mY);
	ctx.rotate(Anguele);
	//alert(flamme);
	if (Math.floor(flamme)==0)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(larg_mis_sur_2/4, long_p_cent+2.8*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
		//alert(0);
	}
	else if(Math.floor(flamme)==1)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+3.1*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
		//alert(1);
	}
	else if(Math.floor(flamme)==2)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2*1.3, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+2.3*long_par);
		ctx.lineTo(-larg_mis_sur_2*1.2, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+1.5*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
		//alert(2);
	}
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.fillStyle = 'white';
	ctx.fill();
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.fillStyle = 'blue';
	ctx.fill();
	
	ctx.beginPath();
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	ctx.closePath();
	ctx.fillStyle = 'red';
	ctx.fill();
	
	
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.strokeStyle = 'black';
	ctx.stroke();
	
	
	
	/*ctx.fillStyle = 'red';
	//alert(longueur_corps_miss);
	//longueur_corps_miss
	ctx.beginPath();
	ctx.lineTo(-largeur_corps_miss[0]/2,0);
	ctx.lineTo(largeur_corps_miss[0]/2,0);
	ctx.lineTo(largeur_corps_miss[0]/2,longueur_corps_miss[0]);
	ctx.lineTo(-largeur_corps_miss[0]/2,longueur_corps_miss[0]);
	ctx.closePath();
	//alert(0);
    ctx.fill();*/
	
	
	ctx.rotate(-Anguele);
	ctx.translate(-pos_mX,-pos_mY);
	
	
	
}

function trace_1_miss_type_0(pos_mX,pos_mY,Anguele,flamme)
{
	//alert(canvas.widt);
	var taille_mis=facteur_taille*2/3;
	var X_cent_cercle=20*taille_mis;
	var Y_cent_cercle=5*taille_mis;
	var diam_cercle=40*taille_mis;
	var long_p_cent=145*taille_mis;
	var long_par=50*taille_mis;
	var larg_mis_sur_2=Math.cos(Math.asin(Y_cent_cercle/diam_cercle))*diam_cercle-X_cent_cercle;
	var larg_wg=50*taille_mis;
	var long_wg=25*taille_mis;
	var ang_wg=0*Math.PI/180;
	
	ctx.translate(pos_mX,pos_mY);
	ctx.rotate(Anguele);
	//alert(flamme);
	if (Math.floor(flamme)==0)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(larg_mis_sur_2/4, long_p_cent+2.8*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	else if(Math.floor(flamme)==1)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+3.1*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	else if(Math.floor(flamme)==2)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2*1.3, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+2.3*long_par);
		ctx.lineTo(-larg_mis_sur_2*1.2, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+1.5*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.strokeStyle = 'black';
	ctx.fillStyle = 'grey';
	ctx.fill();
	ctx.stroke();
	
	
	
	/*ctx.strokeStyle = 'red';
	//alert(longueur_corps_miss);
	//longueur_corps_miss
	ctx.beginPath();
	ctx.lineTo(-largeur_corps_miss[0]/2,0);
	ctx.lineTo(largeur_corps_miss[0]/2,0);
	ctx.lineTo(largeur_corps_miss[0]/2,longueur_corps_miss[0]);
	ctx.lineTo(-largeur_corps_miss[0]/2,longueur_corps_miss[0]);
	ctx.closePath();
	//alert(0);
    ctx.stroke();*/
	
	
	ctx.rotate(-Anguele);
	ctx.translate(-pos_mX,-pos_mY);
	
	
	
}

function trace_1_miss_type_1(pos_mX,pos_mY,Anguele,flamme)
{
	//alert(canvas.widt);
	var taille_mis=facteur_taille*1/2;
	var X_cent_cercle=20*taille_mis;
	var Y_cent_cercle=5*taille_mis;
	var diam_cercle=40*taille_mis;
	var long_p_cent=145*taille_mis;
	var long_par=50*taille_mis;
	var larg_mis_sur_2=Math.cos(Math.asin(Y_cent_cercle/diam_cercle))*diam_cercle-X_cent_cercle;
	var larg_wg=50*taille_mis;
	var long_wg=25*taille_mis;
	var ang_wg=0*Math.PI/180;
	
	ctx.translate(pos_mX,pos_mY);
	ctx.rotate(Anguele);
	//alert(flamme);
	if (Math.floor(flamme)==0)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(larg_mis_sur_2/4, long_p_cent+2.8*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	else if(Math.floor(flamme)==1)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+3.1*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	else if(Math.floor(flamme)==2)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2*1.3, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+2.3*long_par);
		ctx.lineTo(-larg_mis_sur_2*1.2, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+1.5*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.strokeStyle = 'black';
	ctx.fillStyle = 'green';
	ctx.fill();
	ctx.stroke();
	
	
	
	/*ctx.strokeStyle = 'blue';
	//alert(longueur_corps_miss);
	//longueur_corps_miss
	ctx.beginPath();
	ctx.lineTo(-largeur_corps_miss[1]/2,0);
	ctx.lineTo(largeur_corps_miss[1]/2,0);
	ctx.lineTo(largeur_corps_miss[1]/2,longueur_corps_miss[1]);
	ctx.lineTo(-largeur_corps_miss[1]/2,longueur_corps_miss[1]);
	ctx.closePath();
	//alert(0);
    ctx.stroke();*/
	
	
	ctx.rotate(-Anguele);
	ctx.translate(-pos_mX,-pos_mY);
	
	
	
}


function trace_1_miss_type_2(pos_mX,pos_mY,Anguele,flamme)
{
	//alert(canvas.widt);
	var taille_mis=facteur_taille*2/3;
	var X_cent_cercle=20*taille_mis;
	var Y_cent_cercle=30*taille_mis;
	var diam_cercle=80*taille_mis;
	var long_p_cent=145*taille_mis;
	var long_par=50*taille_mis;
	var larg_mis_sur_2=Math.cos(Math.asin(Y_cent_cercle/diam_cercle))*diam_cercle-X_cent_cercle;
	var larg_wg=50*taille_mis;
	var long_wg=25*taille_mis;
	var ang_wg=0*Math.PI/180;
	
	ctx.translate(pos_mX,pos_mY);
	ctx.rotate(Anguele);
	//alert(flamme);
	if (Math.floor(flamme)==0)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(larg_mis_sur_2/4, long_p_cent+2.8*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	else if(Math.floor(flamme)==1)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+3.1*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	else if(Math.floor(flamme)==2)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2*1.3, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+2.3*long_par);
		ctx.lineTo(-larg_mis_sur_2*1.2, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+1.5*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.strokeStyle = 'black';
	ctx.fillStyle = 'red';
	ctx.fill();
	ctx.stroke();
	
	
	
	/*ctx.strokeStyle = 'green';
	//alert(longueur_corps_miss);
	//longueur_corps_miss
	ctx.beginPath();
	ctx.lineTo(-largeur_corps_miss[2]/2,0);
	ctx.lineTo(largeur_corps_miss[2]/2,0);
	ctx.lineTo(largeur_corps_miss[2]/2,longueur_corps_miss[2]);
	ctx.lineTo(-largeur_corps_miss[2]/2,longueur_corps_miss[2]);
	ctx.closePath();
	//alert(0);
    ctx.stroke();*/
	
	
	ctx.rotate(-Anguele);
	ctx.translate(-pos_mX,-pos_mY);
	
	
	
}

function down_mouse(e) {    
	var x_clic = e.offsetX;
	var y_clic = e.offsetY;
	var nb_poioints=tab_x.length;
	if(y_clic>=hauteur_rect)
	{
		tir_mis=1;
		date_tir=Date.now()/1000;
	}
	else if((tir_mis==0)&&((x_clic!=0)||(y_clic!=0)))
	{
		nb_ronds=1;
		xrond[0]=x_clic;
		yrond[0]=y_clic;
		clic_en_cours=1;
		tab_x.push(xrond[0]);
		tab_y.push(yrond[0]);
		if(nb_poioints>0)
		{
			temps_point_passage.push(temps_point_passage[nb_poioints-1]+Math.pow(Math.pow(tab_x[nb_poioints]-tab_x[nb_poioints-1],2)+Math.pow(tab_y[nb_poioints]-tab_y[nb_poioints-1],2),1/2)/vit_pix_par_sec);
		}
	}
}	

function move_mouse(e) {    
	var x_clic = e.offsetX;
	var y_clic = e.offsetY;
	var nb_poioints=tab_x.length;
	if(clic_en_cours==1&&(tir_mis==0)&&((x_clic!=0)||(y_clic!=0)))
	{
		nb_ronds=1;
		xrond[0]=x_clic;
		yrond[0]=y_clic;
		tab_x.push(xrond[0]);
		tab_y.push(yrond[0]);
		if(nb_poioints>0)
		{
			temps_point_passage.push(temps_point_passage[nb_poioints-1]+Math.pow(Math.pow(tab_x[nb_poioints]-tab_x[nb_poioints-1],2)+Math.pow(tab_y[nb_poioints]-tab_y[nb_poioints-1],2),1/2)/vit_pix_par_sec);
		}
	}
}	

function up_mouse(e) {    
	var x_clic = e.offsetX;
	var y_clic = e.offsetY;
	var nb_poioints=tab_x.length;
	if((tir_mis==0)&&((x_clic!=0)||(y_clic!=0)))
	{
		nb_ronds=1;
		xrond[0]=x_clic;
		yrond[0]=y_clic;
		tab_x.push(xrond[0]);
		tab_y.push(yrond[0]);
		if(nb_poioints>0)
		{
			temps_point_passage.push(temps_point_passage[nb_poioints-1]+Math.pow(Math.pow(tab_x[nb_poioints]-tab_x[nb_poioints-1],2)+Math.pow(tab_y[nb_poioints]-tab_y[nb_poioints-1],2),1/2)/vit_pix_par_sec);
		}
		clic_en_cours=0;
	}
}

function down_touch(e) {    
	e.preventDefault();
	var touches = e.changedTouches;
	var nb_poioints=tab_x.length;
	var i=0;
	var ligne=0;
	var colone=0;
	var bouton=0;
	xrond=[];
	yrond=[];
	nb_ronds=touches.length;
	if(etat==4)
	{
		if(fin_de_partie==0)
		{
			if((touches[0].pageY>=hauteur_rect)&&(etat_pause==0))
			{
				//mise a jour arme
				//date_tir=Date.now()/1000;
				if((touches[0].pageX>=0)&&(touches[0].pageX<=canvas.width/4)&&(niv_max_arme>=0))
				{
					selection_arme=0;
				}
				else if((touches[0].pageX>=canvas.width/4)&&(touches[0].pageX<=canvas.width/2)&&(niv_max_arme>=1))
				{
					selection_arme=1;
				}
				else if((touches[0].pageX>=canvas.width/2)&&(touches[0].pageX<=canvas.width*3/4)&&(niv_max_arme>=2))
				{
					selection_arme=2;
				}
				else if((touches[0].pageX>=canvas.width*3/4)&&(touches[0].pageX<=canvas.width)&&(niv_max_arme>=3))
				{
					selection_arme=3;
				}
				//alert(selection_arme);
			}
			else if((touches[0].pageX>canvas.width*11/12)&&(touches[0].pageY<canvas.height/20))
			{
				etat_pause=(etat_pause+1)%2;
			}
			else if(((touches[0].pageX!=0)||(touches[0].pageY!=0))&&(etat_pause==0))
			{
				for (i=0; i<nb_ronds; i++) {
					//ongoingTouches.push(touches[i]);
					xrond[i]=touches[i].pageX;
					yrond[i]=touches[i].pageY;
				}
				clic_en_cours=1;
		        angle_canon=calcul_angle_miss(xrond[0]-canvas.width/2,yrond[0]-(hauteur_rect-largeur_socle/4-largeur_socle/3));
		        tab_x.push(xrond[0]);
				tab_y.push(yrond[0]);
				if(nb_poioints>0)
				{
					temps_point_passage.push(temps_point_passage[nb_poioints-1]+Math.pow(Math.pow(tab_x[nb_poioints]-tab_x[nb_poioints-1],2)+Math.pow(tab_y[nb_poioints]-tab_y[nb_poioints-1],2),1/2)/vit_pix_par_sec);
				}
			}
		}
		else
		{
			etat=2;
			first_draw=1;
		}
	}
	else if(etat==5)
	{
		etat=3;
		first_draw=1;
	}
	else if((etat==1))
	{
		etat=2;
		first_draw=1;
	}
	else if(etat==3)
	{
		etat=2;
		first_draw=1;
	}
	else if(etat==2)
	{
		for(i=0;i<x_case_niveau.length;i++)
		{
			//alert(0);
			if((touches[0].pageX>x_case_niveau[i])&&(touches[0].pageX<(x_case_niveau[i]+largeur_case_niveau))&&(touches[0].pageY>y_case_niveau[i])&&(touches[0].pageY<(y_case_niveau[i]+hauteur_case_niveau)))
			{
				if(i+1<=max_level)
				{
					selected_level=i+1;
					level_config();
				}
			}
		}
		for(i=0;i<3;i++)
		{
			if((touches[0].pageX>x_3_boutons[i])&&(touches[0].pageX<x_3_boutons[i]+largeur_case_niveau)&&(touches[0].pageY>y_3_boutons)&&(touches[0].pageY<y_3_boutons+hauteur_3_boutons))
			{
				bouton=i+1;
			}
		}
		if(bouton==1)
		{
			alert("cheat code");
		}
		else if(bouton==2)
		{
			etat=3;
			first_draw=1;
		}
		else if(bouton==3)
		{
			etat=4;
			first_draw=1;
		}
	}
	/*
var x_case_niveau=[0,0,0,0,0,0,0,0,0,0,0,0];
var y_case_niveau=[0,0,0,0,0,0,0,0,0,0,0,0];
var largeur_case_niveau=0;
var hauteur_case_niveau=0;
var x_3_boutons=[0,0,0];
var y_3_boutons=0;
var hauteur_3_boutons=0;*/
}	

function move_touch(e) {    
	e.preventDefault();
	var touches = e.changedTouches;
	var i=0;
	var nb_poioints=tab_x.length;
	xrond=[];
	yrond=[];	
	if(clic_en_cours==1&&((touches[0].pageX!=0)||(touches[0].pageY!=0)))
	{
		nb_ronds=touches.length;
		for (i=0; i<nb_ronds; i++) {
			//ongoingTouches.push(touches[i]);
			xrond[i]=touches[i].pageX;
			yrond[i]=touches[i].pageY;

		}
		angle_canon=calcul_angle_miss(xrond[0]-canvas.width/2,yrond[0]-(hauteur_rect-largeur_socle/4-largeur_socle/3));
		tab_x.push(xrond[0]);
		tab_y.push(yrond[0]);
		if(nb_poioints>0)
		{
			temps_point_passage.push(temps_point_passage[nb_poioints-1]+Math.pow(Math.pow(tab_x[nb_poioints]-tab_x[nb_poioints-1],2)+Math.pow(tab_y[nb_poioints]-tab_y[nb_poioints-1],2),1/2)/vit_pix_par_sec);
		}
	}
}	

function up_touch(e) {    
	e.preventDefault();
	var touches = e.changedTouches;
	var i=0;
	var nb_poioints=tab_x.length;
	xrond=[];
	yrond=[];
	nb_ronds=touches.length;
	if((tir_mis==0)&&((touches[0].pageX!=0)||(touches[0].pageY!=0)))
	{
		for (i=0; i<nb_ronds; i++) {
			//ongoingTouches.push(touches[i]);
			xrond[i]=touches[i].pageX;
			yrond[i]=touches[i].pageY;
		}
		tab_x.push(xrond[0]);
		tab_y.push(yrond[0]);
		if(nb_poioints>0)
		{
			temps_point_passage.push(temps_point_passage[nb_poioints-1]+Math.pow(Math.pow(tab_x[nb_poioints]-tab_x[nb_poioints-1],2)+Math.pow(tab_y[nb_poioints]-tab_y[nb_poioints-1],2),1/2)/vit_pix_par_sec);
		}
	}
	clic_en_cours=0;
}	




function tracerond (xrond,yrond,tailleRond){
	ctx.beginPath();
	ctx.arc(xrond, yrond, tailleRond, 0, Math.PI*2, false);
	ctx.fill();
	ctx.closePath();
}

function traceimmeubles(){
	var disiz=0;
	var lapeste=0;
	var nb_boom=0;
	var boom_list=[];
	var idx;
	var nb_im=posi_immeubles.length;
	for(disiz=0;disiz<nb_im;disiz++)
	{
			ctx.fillStyle = 'grey';
           
          //  tracequadrilataire_plein(posi_immeubles[disiz],hauteur_rect,posi_immeubles[disiz],hauteur_rect-hauteur_immeubles[disiz],posi_immeubles[disiz]+largeur_immeubles[disiz],hauteur_rect-hauteur_immeubles[disiz],posi_immeubles[disiz]+largeur_immeubles[disiz],  hauteur_rect);
         //   tracequadrilataire(posi_immeubles[disiz],hauteur_rect,posi_immeubles[disiz],hauteur_rect-hauteur_immeubles[disiz],posi_immeubles[disiz]+largeur_immeubles[disiz],hauteur_rect-hauteur_immeubles[disiz],posi_immeubles[disiz]+largeur_immeubles[disiz],  hauteur_rect);
         //  ctx.fillStyle = 'pink';
 
          
          if(etat_facade_gauche[disiz]==0)
           {
				trace_gauche_0(posi_immeubles[disiz],hauteur_immeubles[disiz],largeur_immeubles[disiz]);
	       }
           else if(etat_facade_gauche[disiz]==1)
           {
           	trace_gauche_1(posi_immeubles[disiz],hauteur_immeubles[disiz],largeur_immeubles[disiz]);
           }
           else if(etat_facade_gauche[disiz]==2)
           {
           	trace_gauche_2(posi_immeubles[disiz],hauteur_immeubles[disiz],largeur_immeubles[disiz]);
           }
           
          // ctx.fillStyle = 'green';
           if(etat_facade_droite[disiz]==0)
           {
				trace_droite_0(posi_immeubles[disiz],hauteur_immeubles[disiz],largeur_immeubles[disiz]);
	       }
           else if(etat_facade_droite[disiz]==1)
           {
           	trace_droite_1(posi_immeubles[disiz],hauteur_immeubles[disiz],largeur_immeubles[disiz]);
           }
           else if(etat_facade_droite[disiz]==2)
           {
           	trace_droite_2(posi_immeubles[disiz],hauteur_immeubles[disiz],largeur_immeubles[disiz]);
           }
           
           
           
           boom_list=[];
          //  x_bat_explose.push(posimm+largimm/4);
				//y_bat_explose.push(hauteur_rect-hautimm*3/4);
				//x_miss_explose.push(posXmiss);
				//y_miss_explose.push(posYmiss);
				//date_impact.push(maintenant);
				//vit_x_miss_exlpose.push(vit_x_miss[undice]);
				//vit_y_miss_explose.push(vit_y_miss[undice]);
				// ind_immeuble_explosion.push(deuxdice);
				
				
			idx = ind_immeuble_explosion.indexOf(disiz);
			while (idx != -1) {
				boom_list.push(idx);
				idx = ind_immeuble_explosion.indexOf(disiz, idx + 1);
			}
				
			nb_boom=boom_list.length;
			//alert(nb_boom);
           if(nb_boom>0)
            {
            	for(lapeste=0;lapeste<nb_boom;lapeste++)
	            {
					if((maintenant-date_impact[boom_list[lapeste]])<duree_explose_immeuble/6)
					{
						ctx.fillStyle = 'yellow';
						//
						tracerond(x_bat_explose[boom_list[lapeste]],y_bat_explose[boom_list[lapeste]],(maintenant-date_impact[boom_list[lapeste]])/(duree_explose_immeuble/6)*40*facteur_taille);
						tracerond(x_miss_explose[boom_list[lapeste]],y_miss_explose[boom_list[lapeste]],(maintenant-date_impact[boom_list[lapeste]])/(duree_explose_immeuble/6)*40*facteur_taille);
					}
					else if((maintenant-date_impact[boom_list[lapeste]])<duree_explose_immeuble/3)
					{
						ctx.fillStyle = 'orange';
						tracerond(x_bat_explose[boom_list[lapeste]],y_bat_explose[boom_list[lapeste]],(maintenant-date_impact[boom_list[lapeste]])/(duree_explose_immeuble/3)*80*facteur_taille);
						tracerond(x_miss_explose[boom_list[lapeste]],y_miss_explose[boom_list[lapeste]],(maintenant-date_impact[boom_list[lapeste]])/(duree_explose_immeuble/3)*80*facteur_taille);
						ctx.fillStyle = 'yellow';
						tracerond(x_bat_explose[boom_list[lapeste]],y_bat_explose[boom_list[lapeste]],40*facteur_taille);
						tracerond(x_miss_explose[boom_list[lapeste]],y_miss_explose[boom_list[lapeste]],40*facteur_taille);
					}
					else if((maintenant-date_impact[boom_list[lapeste]])<duree_explose_immeuble*2/3)
					{
						ctx.fillStyle = 'orange';
						tracerond(x_bat_explose[boom_list[lapeste]],y_bat_explose[boom_list[lapeste]],80*facteur_taille);
						tracerond(x_miss_explose[boom_list[lapeste]],y_miss_explose[boom_list[lapeste]],80*facteur_taille);
						ctx.fillStyle = 'yellow';
						tracerond(x_bat_explose[boom_list[lapeste]],y_bat_explose[boom_list[lapeste]],40*facteur_taille);
						tracerond(x_miss_explose[boom_list[lapeste]],y_miss_explose[boom_list[lapeste]],40*facteur_taille);
					}
					else
					{
						//on supprime
					}
				}
			}
           

     }
}

function trace_gauche_0(posi_imm,hauteur_imm,largeur_imm)
{
	ctx.beginPath();
	ctx.moveTo(posi_imm+largeur_imm/2, hauteur_rect);
	ctx.lineTo(posi_imm, hauteur_rect);
	ctx.lineTo(posi_imm, hauteur_rect-hauteur_imm);
	ctx.lineTo(posi_imm+largeur_imm/2, hauteur_rect-hauteur_imm);	
	ctx.fill();
	//ctx.stroke();
}

function trace_droite_0(posi_imm,hauteur_imm,largeur_imm)
{
	ctx.beginPath();
	ctx.moveTo(posi_imm+largeur_imm/2, hauteur_rect);
	ctx.lineTo(posi_imm+largeur_imm, hauteur_rect);
	ctx.lineTo(posi_imm+largeur_imm, hauteur_rect-hauteur_imm);
	ctx.lineTo(posi_imm+largeur_imm/2, hauteur_rect-hauteur_imm);	
	ctx.fill();
	//ctx.stroke();
}


function trace_gauche_1(posi_imm,hauteur_imm,largeur_imm)
{
	ctx.beginPath();
	ctx.moveTo(posi_imm+largeur_imm/2, hauteur_rect-hauteur_imm/2);
	//ctx.lineTo(posi_imm+largeur_imm/10*4.8, hauteur_rect-hauteur_imm);
	ctx.lineTo(posi_imm+largeur_imm/10*3, hauteur_rect-5*hauteur_imm/9);
	ctx.lineTo(posi_imm, hauteur_rect-hauteur_imm/2);
	ctx.lineTo(posi_imm, hauteur_rect);
	ctx.lineTo(posi_imm+largeur_imm/2, hauteur_rect);	
	ctx.fill();
	//ctx.stroke();
}

function trace_droite_1(posi_imm,hauteur_imm,largeur_imm)
{
	ctx.beginPath();
	ctx.moveTo(posi_imm+largeur_imm/2, hauteur_rect-hauteur_imm/2);
	//ctx.lineTo(posi_imm+largeur_imm/10*5.3, hauteur_rect-hauteur_imm);
	ctx.lineTo(posi_imm+largeur_imm/9*6, hauteur_rect-5*hauteur_imm/9);
	ctx.lineTo(posi_imm+largeur_imm, hauteur_rect-hauteur_imm/2);
	ctx.lineTo(posi_imm+largeur_imm, hauteur_rect);
	ctx.lineTo(posi_imm+largeur_imm/2, hauteur_rect);	
	ctx.fill();
	//ctx.stroke();
}

function trace_gauche_2(posi_imm,hauteur_imm,largeur_imm)
{
	ctx.beginPath();
	ctx.moveTo(posi_imm+largeur_imm/2, hauteur_rect-hauteur_imm/9);
	//ctx.lineTo(posi_imm+largeur_imm/10*4.8, hauteur_rect-hauteur_imm);
	ctx.lineTo(posi_imm+largeur_imm/10*2.5, hauteur_rect-hauteur_imm/8);
	ctx.lineTo(posi_imm, hauteur_rect-hauteur_imm/8);
	ctx.lineTo(posi_imm, hauteur_rect);
	ctx.lineTo(posi_imm+largeur_imm/2, hauteur_rect);	
	ctx.fill();
	//ctx.stroke();
}

function trace_droite_2(posi_imm,hauteur_imm,largeur_imm)
{
	ctx.beginPath();
	ctx.moveTo(posi_imm+largeur_imm/2, hauteur_rect-hauteur_imm/9);
	//ctx.lineTo(posi_imm+largeur_imm/10*5.3, hauteur_rect-hauteur_imm);
	ctx.lineTo(posi_imm+largeur_imm/9*7, hauteur_rect-hauteur_imm/8);
	ctx.lineTo(posi_imm+largeur_imm, hauteur_rect-hauteur_imm/10);
	ctx.lineTo(posi_imm+largeur_imm, hauteur_rect);
	ctx.lineTo(posi_imm+largeur_imm/2, hauteur_rect);	
	ctx.fill();
	//ctx.stroke();
}


function tracequadrilataire(x1,y1,x2,y2,x3,y3,x4,y4)
{
		ctx.beginPath();
		ctx.moveTo(x1, y1);
		ctx.lineTo(x2, y2);
		ctx.lineTo(x3, y3);
		ctx.lineTo(x4, y4);
		ctx.lineTo(x1, y1);
		ctx.closePath();	
		ctx.stroke();
}

function tracequadrilataire_plein(x1,y1,x2,y2,x3,y3,x4,y4)
{
		ctx.beginPath();
		ctx.moveTo(x1, y1);
		ctx.lineTo(x2, y2);
		ctx.lineTo(x3, y3);
		ctx.lineTo(x4, y4);
		ctx.lineTo(x1, y1);
		ctx.closePath();	
		ctx.fill();
}

function affiche_titres()
{
	//Missiles dans ton cul
	//sur une idée de PoulainNico
}

function trace_traj(tabloX,tabloY)
{
	var n_puins = tabloX.length;
	var induice = 1;
	if (n_puins>1)
	{
		ctx.beginPath();
		ctx.moveTo(tabloX[0], tabloY[0]);
		for (induice=1;induice<n_puins;induice++)
		{
			ctx.lineTo(tabloX[induice], tabloY[induice]);
		}
		ctx.stroke();
	}	
}

function position_et_orientation_du_missile()
{
	var coord = [0,0,0];
	var filtre = [];
	var num_dernier_point_de_passage=0;
	
	filtre=temps_point_passage.filter(suffisammentPetit);
	num_dernier_point_de_passage=filtre.length-1;
	
	coord[0]=tab_x[num_dernier_point_de_passage]+(tab_x[num_dernier_point_de_passage+1]-tab_x[num_dernier_point_de_passage])*(tps_depuis_tir-temps_point_passage[num_dernier_point_de_passage])/(temps_point_passage[num_dernier_point_de_passage+1]-temps_point_passage[num_dernier_point_de_passage]);
	coord[1]=tab_y[num_dernier_point_de_passage]+(tab_y[num_dernier_point_de_passage+1]-tab_y[num_dernier_point_de_passage])*(tps_depuis_tir-temps_point_passage[num_dernier_point_de_passage])/(temps_point_passage[num_dernier_point_de_passage+1]-temps_point_passage[num_dernier_point_de_passage]);
	if ((tab_x[num_dernier_point_de_passage+1]-tab_x[num_dernier_point_de_passage])>0)
	{
		coord[2]=Math.atan((tab_y[num_dernier_point_de_passage+1]-tab_y[num_dernier_point_de_passage])/(tab_x[num_dernier_point_de_passage+1]-tab_x[num_dernier_point_de_passage]))+Math.PI/2;
	}
	else if ((tab_x[num_dernier_point_de_passage+1]-tab_x[num_dernier_point_de_passage])<0)
	{
		coord[2]=Math.atan((tab_y[num_dernier_point_de_passage+1]-tab_y[num_dernier_point_de_passage])/(tab_x[num_dernier_point_de_passage+1]-tab_x[num_dernier_point_de_passage]))+Math.PI*3/2;
	}
	else if ((tab_y[num_dernier_point_de_passage+1]-tab_y[num_dernier_point_de_passage])>0)
	{
		coord[2]=Math.PI;
	}
	else
	{
		coord[2]=0;
	}

	return coord;
}

function suffisammentPetit(element) 
{
  return element <= tps_depuis_tir;
}

function paysage(numero_de_paysage)
{
	var proportion_t_etat=(maintenant-state_start_time)/etat_4_duree;
	if(numero_de_paysage==1)
	{
		//ciel
		//ctx.strokeStyle = 'yellow';
		ctx.fillStyle = '#bdf';
		tracequadrilataire_plein(0,0,canvas.width,0,canvas.width,hauteur_rect,0,hauteur_rect);
		//nuage
		
		ctx.fillStyle = '#fff';
		ctx.beginPath();
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width/7,hauteur_rect*2/40);
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width/5,hauteur_rect*2/40);
		ctx.arc(proportion_t_etat*3*canvas.width/5+canvas.width/5, hauteur_rect*5/80, hauteur_rect/80, -Math.PI/2, Math.PI/2, false);
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width/3,hauteur_rect*3/40);
		ctx.arc(proportion_t_etat*3*canvas.width/5+canvas.width/3, hauteur_rect*8/80, hauteur_rect/40, -Math.PI/2, Math.PI/2, false);
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width/4,hauteur_rect*5/40);
		ctx.arc(proportion_t_etat*3*canvas.width/5+canvas.width/4, hauteur_rect*11/80, hauteur_rect/80, -Math.PI/2, Math.PI/2, false);
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width*1.3/20,hauteur_rect*6/40);
		ctx.arc(proportion_t_etat*3*canvas.width/5+canvas.width*1.3/20, hauteur_rect*10/80, hauteur_rect/40, Math.PI/2, Math.PI*3/2, false);
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width/15,hauteur_rect*4/40);
		ctx.arc(proportion_t_etat*3*canvas.width/5+canvas.width/15, hauteur_rect*7/80, hauteur_rect/80, Math.PI/2, Math.PI*3/2, false);
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width/7,hauteur_rect*3/40);
		ctx.arc(proportion_t_etat*3*canvas.width/5+canvas.width/7, hauteur_rect*5/80, hauteur_rect/80, Math.PI/2, Math.PI*3/2, false);
		
		
		
		ctx.closePath();
		ctx.fill();
		
		//montagnes
		ctx.fillStyle = '#fcb';
		ctx.beginPath();
		ctx.lineTo(0,hauteur_rect);
		ctx.lineTo(0,hauteur_rect/2);
		ctx.lineTo(canvas.width/6,hauteur_rect/3);
		ctx.lineTo(canvas.width,hauteur_rect*6/5);
		ctx.lineTo(canvas.width,hauteur_rect);
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = '#fff';
		ctx.beginPath();
		ctx.lineTo(canvas.width/20,hauteur_rect*(1/2-1/20));
		ctx.lineTo(canvas.width/6,hauteur_rect/3);
		ctx.lineTo(canvas.width*(2/6-1/20),hauteur_rect*(1/2-1/20));
		ctx.lineTo(canvas.width*(1/6*4/3),hauteur_rect*(1/2-1/15));
		ctx.lineTo(canvas.width*(1/6*2/3),hauteur_rect*(1/2-1/30));
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = '#eba';
		ctx.beginPath();
		ctx.lineTo(0,hauteur_rect);
		ctx.lineTo(0,3*hauteur_rect/4);
		ctx.lineTo(2*canvas.width/3,hauteur_rect/5);
		ctx.lineTo(canvas.width,hauteur_rect/2);
		ctx.lineTo(canvas.width,hauteur_rect);
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = '#fff';
		ctx.beginPath();
		ctx.lineTo(canvas.width*4/9.5,hauteur_rect/2.5);
		ctx.lineTo(2*canvas.width/3,hauteur_rect/5);
		ctx.lineTo(canvas.width*9/10.1,hauteur_rect/2.5);
		ctx.lineTo(canvas.width*8/11,hauteur_rect/2.3);
		ctx.lineTo(canvas.width*6.5/11,hauteur_rect/2.7);
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = '#cd9';
		tracerond(canvas.width,canvas.height*3,canvas.height*2.35);
		
		ctx.fillStyle = '#bc8';
		tracerond(canvas.width/4,canvas.height*3,canvas.height*2.3);
	}
	else if(numero_de_paysage==2)
	{
		//ciel
		ctx.fillStyle = '#da6';
		tracequadrilataire_plein(0,0,canvas.width,0,canvas.width,hauteur_rect,0,hauteur_rect);
		
		ctx.fillStyle = '#da6';
		tracequadrilataire_plein(0,hauteur_rect/6,canvas.width,hauteur_rect/6,canvas.width,hauteur_rect,0,hauteur_rect);
		//tracerond(canvas.width*2/3,hauteur_rect/3,canvas.width/2);
		
		ctx.fillStyle = '#e62';
		tracequadrilataire_plein(0,hauteur_rect/3-canvas.width/30,canvas.width,hauteur_rect/3-canvas.width/30,canvas.width,hauteur_rect,0,hauteur_rect);
		//tracerond(canvas.width*2/3,hauteur_rect/3,canvas.width/8);
		
		ctx.fillStyle = '#832';
		tracequadrilataire_plein(0,hauteur_rect/3-canvas.width/60,canvas.width,hauteur_rect/3-canvas.width/60,canvas.width,hauteur_rect,0,hauteur_rect);
		
		ctx.fillStyle = '#ff9';
		tracerond(canvas.width*2/3,hauteur_rect/3,canvas.width/20);
		
		ctx.fillStyle = '#7ab';
		tracequadrilataire_plein(0,hauteur_rect/3,canvas.width,hauteur_rect/3,canvas.width,hauteur_rect,0,hauteur_rect);
		
		
		//bateau
		
		ctx.fillStyle = '#eee';
		ctx.beginPath();
		ctx.lineTo(proportion_t_etat*3/4*canvas.width, hauteur_rect/2.6);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4, hauteur_rect/2.9);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4+hauteur_rect/60, hauteur_rect/2.6);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4+hauteur_rect/160, hauteur_rect/2.6);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4+hauteur_rect/160, hauteur_rect/2.58);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4+hauteur_rect/50, hauteur_rect/2.58);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4+hauteur_rect/65, hauteur_rect/2.55);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4-hauteur_rect/65, hauteur_rect/2.55);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4-hauteur_rect/50, hauteur_rect/2.58);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4, hauteur_rect/2.58);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4, hauteur_rect/2.6);
		
		ctx.lineTo(proportion_t_etat*3*canvas.width/4-hauteur_rect/65, hauteur_rect/2.6);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4, hauteur_rect/2.8);
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = '#fff';
		ctx.beginPath();
		ctx.lineTo(canvas.width, hauteur_rect);
		ctx.arc(canvas.width/2, -hauteur_rect, hauteur_rect*3/2, 0,Math.PI, false);
		ctx.lineTo(0, hauteur_rect);
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = 'yellow';
		ctx.beginPath();
		ctx.lineTo(canvas.width, hauteur_rect);
		ctx.arc(canvas.width/2, -hauteur_rect+canvas.width/60, hauteur_rect*3/2, 0,Math.PI, false);
		ctx.lineTo(0, hauteur_rect);
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = '#cd9';
		ctx.beginPath();
		ctx.lineTo(canvas.width, hauteur_rect);
		ctx.arc(canvas.width/2, -hauteur_rect+canvas.width/20, hauteur_rect*3/2, 0,Math.PI, false);
		ctx.lineTo(0, hauteur_rect);
		ctx.closePath();
		ctx.fill();
		
	
		//soleil
		//mer
		//bateau
		//plage
		//herbe
	}
	
}
		

function trace_spalc(pos_mX,pos_mY,Anguele)
{
	var taille_mis=0.2;
	var X_cent_cercle=20*taille_mis;
	var Y_cent_cercle=5*taille_mis;
	var diam_cercle=40*taille_mis;
	var long_p_cent=145*taille_mis;
	var long_par=50*taille_mis;
	var larg_mis_sur_2=Math.cos(Math.asin(Y_cent_cercle/diam_cercle))*diam_cercle-X_cent_cercle;
	var larg_wg=17*taille_mis;
	var long_wg=65*taille_mis;
	var ang_wg=10*Math.PI/180;
	
	ctx.translate(pos_mX,pos_mY);
	ctx.rotate(Anguele);
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.strokeStyle = 'black';
	ctx.fillStyle = 'grey';
	ctx.fill();
	ctx.stroke();
	ctx.rotate(-Anguele);
	ctx.translate(-pos_mX,-pos_mY);
	
	
}


</script>
</html>