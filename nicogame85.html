<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Missiles dans ton cul!</title>
	<meta name="viewport" content="width=device-width, user-scalable=no">
    <style>
     * { padding: 0; margin: 0; }
     canvas { background: #eef; display: block; margin: 0 auto; }
    </style>
</head>
<body>

<canvas id="myCanvas" width=1200 height=800></canvas>

<script>
	//bugs a regler : impact boulet missile ; augmentation des points apres grisé 
	//modifier declenchement spécial
	//Explosion missiles
	//Bestiaires des ennemis
	
	//calibrer et mettre un temps pour le niveau 1
	//Affichage des titres et des niveaux
	// autres paysages
	// autres types missile
	
var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");

canvas.height=window.innerHeight-5;
canvas.width=window.innerWidth-10;
var hauteur_rect=canvas.height*11/12;
var facteur_taille=canvas.width*0.2/350;
var largeur_socle=facteur_taille*200;
var clic_en_cours = 0;

var nb_ronds = 0;
var xrond=[];
var yrond=[];

var indice=0;

var tab_x =[];
var tab_y =[];
var temps_point_passage = [];


var nb_pixels_parcourus = 0;

var vit_pix_par_sec = 200;

var tir_mis = 0;

var date_tir=0;
var tps_depuis_tir=0;

var pos_or_mis=[0,0,0];

var etat=0; //0=intro 1=tuto + cheat si necessaire  2=niveau 3=info_niveau 4=jeux 5=score + cheat code 6=game over

var intro_duree=0.5 //titre
//etat 1 : mini tuto pas de durée sortie au clic
//var etat_2_duree=1;//affiche niveau
//etat 3 : info niveau pas de durée sortie au clic
var etat_4_duree=60;//jeu
var etat_5_duree=2;



var first_draw=1;
var state_start_time=0;

var last_miss_date=0;

var min_delay_between_2_miss=0.7;
var max_delay_between_2_miss=1;
var delay_before_next_miss=0;

var vit_x_miss =[];
var vit_y_miss =[];
var pos_x_miss =[];
var pos_y_miss =[];
var type_miss =[];
var angle_miss=[];
var etat_propu=[];

var deltat=0;
var maintenant=0;

var ligne_depart_miss=0.5; //unitée hauteur_rect au dessus de l'ecran
var ligne_arrivee_miss=1.1;
var date_derniere_boucle=0;

var vit_min_traverse_ecran=[0.4,0.4,0.2]; //en ecran par seconde
var vit_max_traverse_ecran=[0.6,0.6,0.4];//en ecran par seconde
var coef_tete_miss_par_type=[25*2/3,25/2,25*4/3,40];
var taille_tete_miss_par_type=[0,0,0,0];
var coef_larg_miss=[50,25*3/2,100,40];
var coef_long_miss=[140,70*3/2,150,120];
var largeur_corps_miss=[0,0,0,0];
var longueur_corps_miss=[0,0,0,0];

var pos_bat_a_jour=0;

var nb_immeubles=5;
var largeur_immeubles=[];
var hauteur_immeubles=[];
var posi_immeubles=[];
var etat_facade_droite=[];
var etat_facade_gauche=[];

//pour explosion immeuble
var x_bat_explose=[];
var y_bat_explose=[];
var x_miss_explose=[];
var y_miss_explose=[];
var date_impact=[];
var vit_x_miss_exlpose=[];
var vit_y_miss_explose=[];
var ind_immeuble_explosion=[];
var duree_explose_immeuble=0.4;

temps_point_passage.push(0);
//alert(temps_point_passage[0]);

var angle_canon=0;


var dernier_tir_boulet=0;
var vit_x_boulet=[];
var vit_y_boulet=[];
var pos_x_boulet=[];
var pos_y_boulet=[];
var taille_boulet=facteur_taille*20;

var dernier_tir_TC=0;
var vit_x_miss_TC=[];
var vit_y_miss_TC=[];
var pos_x_miss_TC=[];
var pos_y_miss_TC=[];
var taille_miss_TC=facteur_taille*20;

var dernier_mur=0;
var mur_fantome=0;
var  epaisseur_mur=0;
var rapport_coef_murs=100;
var type_mur=[];
var vies_mur=[];
var coef_longueur_mur=[];
var pos_x_mur=[];
var pos_y_mur=[];
var autodefense_mur=[];
var dernier_tir_miss_special=[];


var x_case_niveau=[0,0,0,0,0,0,0,0,0,0,0,0];
var y_case_niveau=[0,0,0,0,0,0,0,0,0,0,0,0];
var largeur_case_niveau=0;
var hauteur_case_niveau=0;
var x_3_boutons=[0,0,0];
var y_3_boutons=0;
var hauteur_3_boutons=0;

var laser_ON=0;
var dernier_tir_laser=0;
var haut_laser=0;
var bas_laser=0;
var t_OFF_laser=0;
var temps_entre_2_laser=3;
var duree_laser=0.51;
var vitesse_lumiere=6;
var coef_largeur_laser=30;
var largeur_laser=facteur_taille*coef_largeur_laser;

var selection_arme=0;//0:canon    1:missile_ad    2:laser    3:briques


var nb_enemy_max=3;

// paysages
var num_paysage=0;

// pause
var etat_pause=0;
var deltat_pause=0;
var temps_en_pause=0;

var proportion_type_missile=[1,0,0,0];

//niveaux
var max_level=4;
var selected_level=1;

//score
var fin_de_partie=0;
var debut_de_la_fin=0;
var temps_montee_score=5;

var score_tot=100000;
var score_partie=0;

var points_par_type=[5,5,10,20];
var nb_touche_par_type=[0,0,0,0];
var nb_touche_par_type_a_add=[0,0,0,0];

var point_par_bat_rest=[5,6,10,20];
var nb_bat_rest=[0,0,0,0];//0:encore un morceau  1:une aile debout  2: bat encore entier  3:tous debout

var point_par_partie_gagnee=100;
var partie_gagnee=0;

var level_up=0;

//menu upgrade

var hauteur_menus_arme=0;
var largeur_menus_arme=0;
var x_menus=0;
var y_menu_boulet=0;
var y_menu_missile=0;
var y_menu_laser=0;
var y_menu_4_eme_arme=0;
var y_bouton_back=0;
var x_bouton_back=0;
var niv_max_arme=0;
var prix_miss=1000;
var prix_laser=5000;
var prix_arme_4=20000;



var niv_boulet_freq=0;
var periode_boulet_tarifs=[0,10,20,40,80,160,300,600];
var periode_boulet_tab=[1.5,1,0.75,0.5,0.4,0.3,0.2,0.1];
var temps_entre_2_boulets=periode_boulet_tab[niv_boulet_freq];

var niv_boulet_vit=0;
var vit_boulet_tarifs=[0,10,20,40,80];
var vit_boulet_tab=[0.8,1,1.2,1.4,1.75];
var vit_boulets=vit_boulet_tab[niv_boulet_vit];

var niv_miss_periode=0;
var periode_miss_tarifs=[0, 100,400,1000,5000];
var periode_miss_tab=[1.5,1,0.75,0.6,0.4,0.3];
var temps_entre_2_miss_TC=periode_miss_tab[niv_miss_periode];

var niv_vit_miss_TC=0;
var vit_miss_tarifs=[0, 100,400,1000];
var vit_miss_tab=[0.3,0.5,0.7,0.9];
//var acc_miss_tab=[1.5,1,0.75,0.6,0.4,0.3];
var vit_miss_TC=vit_miss_tab[niv_vit_miss_TC];
var accel_miss_TC=vit_miss_tab[niv_vit_miss_TC];

var niv_AD_miss=0;
var AD_miss_tarifs=[0,100,400,1000];
var AD_portee_tab=[1/5,1/3,1/2,3/4];
var AD_angle_tab=[30,45,60,90];
var portee_AD=AD_portee_tab[niv_AD_miss];
var angle_vue_AD=AD_angle_tab[niv_AD_miss];

var niv_manoeuv_miss=0;
var manoeuv_miss_tarifs=[0,100,400,1000];
var manoeuv_miss_tab=[100,150,225,360];
var vit_rot_max_TC=manoeuv_miss_tab[niv_manoeuv_miss]; //°/s

var indices_miss_special=[];
//var dernier_tir_miss_special=[];
var periode_miss_special=[0,3,1.8,0.7];
var vitesse_miss_special=[0,0.3,0.6,1];
var AD_portee_miss_special=[1/5,1/5,1/3,1/2];
var AD_angle_miss_special=[30,10,20,45];
var manoeuv_miss_special=[100,100,150,200];

var niv_periode_laser=0;
var periode_laser_tarifs=[0,300,500,1000];
var periode_laser_tab=[5,3.5,2.3,1.1];
var temps_entre_2_laser=periode_laser_tab[niv_periode_laser];

var niv_duree_laser=0;
var duree_laser_tarifs=[0,300,500,1000];
var duree_laser_tab=[0.15,0.3,0.6,0.75];
var duree_laser=duree_laser_tab[niv_duree_laser];

var niv_largeur_laser=0;
var largeur_laser_tarifs=[0,300,500];
var largeur_laser_tab=[30,40,60];
var laser_couleur_tab=['green','blue','red'];
var coef_largeur_laser=largeur_laser_tab[niv_largeur_laser];
var laser_couleur=laser_couleur_tab[niv_largeur_laser];

var niv_periode_murs=0;
var periode_murs_tarifs=[0,300,500,1000];
var periode_murs_tab=[10,8,6,4];
var periode_murs=periode_murs_tab[niv_periode_murs];

var niv_coef_long_mur=0;
var coef_long_mur_tarifs=[0,300,500,1000];
var coef_long_mur_tab=[10,20,30,40];
var coef_long_mur=coef_long_mur_tab[niv_coef_long_mur];

var niv_type_de_mur=0;
var type_de_mur_tarifs=[0,300,500,1000];
var type_de_mur_tab=[0,1,2,3];
var type_de_mur=type_de_mur_tab[niv_type_de_mur];

var niv_autodef=0;
var autodef_tarifs=[0,300,500,1000];
var autodef_tab=[0,1,2,3];
var autodef=autodef_tab[niv_autodef];


var largeur_pti_bouton=0;
var hauteur_pti_bouton=0;
var posi_x_pti_bout_1=0;
var posi_x_pti_bout_2=0;
var posi_x_pti_bout_3=0;
var posi_x_pti_bout_4=0;
var posi_y_pti_bout_boulet=0;
var posi_y_pti_bout_missile=0;
var posi_y_pti_bout_laser=0;
var posi_y_pti_bout_4_eme_arme=0;

//soucoupe
var pos_x_soucoupe=[];
var pos_y_soucoupe=[];
var vit_soucoupe=[];
var points_vie_soucoupe=[];
var instant_dernier_impact_soucoupe=[];
var soucoupe_inv=[];
var x_objectif_soucoupe=[];
var instant_dernier_arret_soucoupe=[];
var a_fait_caca=[];
var duree_soucoupe_inv=1;
var duree_caca=1.5;
var taille_soucoupe=40;

var pos_x_caca=[];
var pos_y_caca=[];
var vit_caca=[];
var instant_caca_par_terre=[];
var acc_caca=1;
var taille_caca=0;
var duree_par_terre=2;

	//pos_x_soucoupe.push(canvas.width/2);
	//pos_y_soucoupe.push(canvas.height/8);

document.addEventListener("mousemove",move_mouse, false);
document.addEventListener("mousedown",down_mouse, false);
document.addEventListener("mouseup",up_mouse, false);

document.addEventListener("touchmove",move_touch, false);
document.addEventListener("touchstart",down_touch, false);
document.addEventListener("touchend",up_touch, false);


function draw() {
	if(etat_pause==1)
	{
		maintenant=Date.now()/1000-temps_en_pause;
	    deltat=maintenant-date_derniere_boucle;
		temps_en_pause=temps_en_pause+deltat;
		maintenant=Date.now()/1000-temps_en_pause;
		deltat=0;
		date_derniere_boucle=maintenant;
		/*deltat_pause=Date.now()/1000-date_derniere_boucle;
		date_derniere_boucle=Date.now()/1000;
		temps_en_pause=temps_en_pause+deltat_pause
		deltat=0;
		maintenant=Date.now()/1000-temps_en_pause;*/
	}
	else
	{
		maintenant=Date.now()/1000-temps_en_pause;
	    deltat=maintenant-date_derniere_boucle;
		date_derniere_boucle=maintenant;
    }
	canvas.height=window.innerHeight-5;
	hauteur_rect=canvas.height*11/12;
	canvas.width=window.innerWidth-10;
	facteur_taille=canvas.width*0.2/350;
	largeur_socle=facteur_taille*200;
	taille_boulet=facteur_taille*20;
	taille_miss_TC=facteur_taille*20;
	largeur_laser=facteur_taille*coef_largeur_laser;
	for(indice=0;indice<coef_tete_miss_par_type.length;indice++)
	{
	    taille_tete_miss_par_type[indice]=coef_tete_miss_par_type[indice]*facteur_taille;
		largeur_corps_miss[indice]=coef_larg_miss[indice]*facteur_taille;
		longueur_corps_miss[indice]=coef_long_miss[indice]*facteur_taille;
	}
	//largeur_corps_miss[3]=coef_larg_miss[3]*facteur_taille;
	
	taille_soucoupe=largeur_corps_miss[3]*11/2;
	//alert(taille_soucoupe);
	ctx.strokeStyle = 'black';
	if(etat==0)
	{
		if(first_draw==1)
	    {
		     state_start_time=maintenant;
             first_draw=0;
             deltat=0;
	    }
		if((maintenant-state_start_time)>intro_duree)
		{
			  first_draw=1;
              etat=1;
		}
		else
        {
     	   affiche_titre();
        }
     }
     else if(etat==1)
	{
	    if(first_draw==1)
	    {
		     state_start_time=maintenant;
             first_draw=0;
	    }
	affiche_choix_niveau();
	affiche_tuto();
		//ctx.fillText("tuto",canvas.width/10,canvas.height/3);
   }
	else if(etat==2)
	{
	    if(first_draw==1)
	    {
		     state_start_time=maintenant;
             first_draw=0;
             RAZ_niveau();
             level_config();
	    }
	//paysage(num_paysage);
		affiche_choix_niveau();
		//ctx.fillText("choix niveau "+max_level,canvas.width/10,canvas.height/3);
   }
   else if(etat==3)
	{
	    if(first_draw==1)
	    {
		     state_start_time=maintenant;
             first_draw=0;
	    }
		trace_upgrades();
   }
/*   else if(etat==5)
	{
	    if(first_draw==1)
	    {
		     state_start_time=maintenant;
             first_draw=0;
	    }
	//paysage(num_paysage);
		if((maintenant-state_start_time)>etat_5_duree)
		{
			  first_draw=1;
              etat=2;
		}
		ctx.fillText("score",canvas.width/10,canvas.height/3);
   }*/
   else if(etat==4)
   {
   	  if(first_draw==1)
	    {
		     state_start_time=maintenant;
             first_draw=0;
             dernier_mur=maintenant;
	    }
		 paysage(num_paysage);
        if (pos_bat_a_jour==0)
	    {
          mise_a_j_pos_bat(nb_immeubles);
          pos_bat_a_jour=1;
        }
        
        //trace_chargeur();
        mise_a_jour_missiles();
        mise_a_jour_boulets();
        mise_a_jour_miss_TC();
        mise_a_jour_laser();
        mise_a_jour_murs();
        mise_a_jour_impact_avec_immeuble();
        mise_a_jour_impact_crotte_immeuble();
        mise_a_jour_impact_crotte_mur();
		traceimmeubles(nb_immeubles);
        //trace_explosions();
        trace_laser();
        traces_boulets();
        traces_miss_TC();
        trace_murs();
        trace_cacas();
        trace_soucoupes();
        trace_missiles();
        mise_a_jour_impact_miss_laser();
        mise_a_jour_impact_miss_boulet();
        mise_a_jour_impact_miss_miss();
        mise_a_jour_impact_miss_murs();
        mise_a_jour_impact_soucoupes();
        mise_a_jour_impact_defenses_cacas();
        mise_a_jour_miss_des_murs();
        trace_arme();
        ctx.strokeStyle = 'black';
		if(etat_pause==0)
		{
			ctx.fillStyle = 'white';
		}
		else
		{
			ctx.fillStyle = 'orange';
		}
		//bouton pause
		tracequadrilataire_plein(canvas.width*11/12,canvas.height/20,canvas.width*11/12,canvas.height/20-80*facteur_taille,canvas.width*11/12+40*facteur_taille,canvas.height/20-80*facteur_taille,canvas.width*11/12+40*facteur_taille,canvas.height/20);
		tracequadrilataire_plein(canvas.width*11/12+60*facteur_taille,canvas.height/20,canvas.width*11/12+60*facteur_taille,canvas.height/20-80*facteur_taille,canvas.width*11/12+60*facteur_taille+40*facteur_taille,canvas.height/20-80*facteur_taille,canvas.width*11/12+60*facteur_taille+40*facteur_taille,canvas.height/20);
		tracequadrilataire(canvas.width*11/12,canvas.height/20,canvas.width*11/12,canvas.height/20-80*facteur_taille,canvas.width*11/12+40*facteur_taille,canvas.height/20-80*facteur_taille,canvas.width*11/12+40*facteur_taille,canvas.height/20);
		tracequadrilataire(canvas.width*11/12+60*facteur_taille,canvas.height/20,canvas.width*11/12+60*facteur_taille,canvas.height/20-80*facteur_taille,canvas.width*11/12+60*facteur_taille+40*facteur_taille,canvas.height/20-80*facteur_taille,canvas.width*11/12+60*facteur_taille+40*facteur_taille,canvas.height/20);
		ctx.fillStyle = 'white';
		tracequadrilataire_plein(0,canvas.height,0,hauteur_rect,canvas.width,hauteur_rect,canvas.width,canvas.height);
		tracequadrilataire(0,canvas.height,0,hauteur_rect,canvas.width,hauteur_rect,canvas.width,canvas.height);
		trace_choix_armes();
		check_game_over();
		affiche_game_over();
	//maintenant-dernier_tir_boulet)>temps_entre_2_boulets
    }
	//tracequadrilataire(0,0,canvas.width,0,canvas.width,hauteur_rect,0,hauteur_rect);
}
setInterval(draw, 20);

function affiche_game_over()
{
	var type_0_temp=0;
	var type_1_temp=0;
	var type_2_temp=0;
	var type_3_temp=0;
	var rien_touche=0;
	var bat_entier=0;
	var reste_une_aile=0;
	var pas_completement_detruit=0;
	var gagne_partie=0;
	var partie_score=0;
	var total_score=0;
	

	if(fin_de_partie==1)
	{
		type_0_temp=Math.min(Math.floor((maintenant-debut_de_la_fin)/temps_montee_score*nb_touche_par_type_a_add[0]),nb_touche_par_type_a_add[0]);
		type_1_temp=Math.min(Math.floor((maintenant-debut_de_la_fin)/temps_montee_score*nb_touche_par_type_a_add[1]),nb_touche_par_type_a_add[1]);
		type_2_temp=Math.min(Math.floor((maintenant-debut_de_la_fin)/temps_montee_score*nb_touche_par_type_a_add[2]),nb_touche_par_type_a_add[2]);
		type_3_temp=Math.min(Math.floor((maintenant-debut_de_la_fin)/temps_montee_score*nb_touche_par_type_a_add[3]),nb_touche_par_type_a_add[3]);
		partie_score=type_0_temp*points_par_type[0]+type_1_temp*points_par_type[1]+type_2_temp*points_par_type[2]+type_3_temp*points_par_type[3];
		
		pas_completement_detruit=Math.min(Math.floor((maintenant-debut_de_la_fin)/temps_montee_score*nb_bat_rest[0]),nb_bat_rest[0]);
		reste_une_aile=Math.min(Math.floor((maintenant-debut_de_la_fin)/temps_montee_score*nb_bat_rest[1]),nb_bat_rest[1]);
		bat_entier=Math.min(Math.floor((maintenant-debut_de_la_fin)/temps_montee_score*nb_bat_rest[2]),nb_bat_rest[2]);
		rien_touche=Math.min(Math.floor((maintenant-debut_de_la_fin)/temps_montee_score*nb_bat_rest[3]),nb_bat_rest[3]);
		gagne_partie=Math.min(Math.floor((maintenant-debut_de_la_fin)/temps_montee_score*partie_gagnee),partie_gagnee);
		partie_score=partie_score+pas_completement_detruit*point_par_bat_rest[0]+reste_une_aile*point_par_bat_rest[1]+bat_entier*point_par_bat_rest[2]+rien_touche*point_par_bat_rest[3]+gagne_partie*point_par_partie_gagnee;
		
		total_score=score_tot-score_partie+partie_score;
		ctx.fillStyle = 'white';
		ctx.globalAlpha=0.5;
		tracequadrilataire_plein(0,canvas.height,0,0,canvas.width,0,canvas.width,canvas.height);
		ctx.globalAlpha=1;
		
		ctx.fillStyle = 'black';
		
		ctx.fillText('nb type 0 : '+points_par_type[0]+' x '+type_0_temp,0,canvas.height*1/12);
		ctx.fillText('nb type 1 : '+points_par_type[1]+' x '+type_1_temp,0,canvas.height*2/12);
		ctx.fillText('nb type 2 : '+points_par_type[2]+' x '+type_2_temp,0,canvas.height*3/12);
		ctx.fillText('nb type 3 : '+points_par_type[3]+' x '+type_3_temp,0,canvas.height*4/12);
		ctx.fillText('nb bat pas tot détruits : '+point_par_bat_rest[0]+' x '+pas_completement_detruit,0,canvas.height*5/12);
		ctx.fillText('nb bat avec une aile intacte : '+point_par_bat_rest[1]+' x '+reste_une_aile,0,canvas.height*6/12);
		ctx.fillText('nb bat intacts : '+point_par_bat_rest[2]+' x '+bat_entier,0,canvas.height*7/12);
		ctx.fillText('bonus ville nickel : '+point_par_bat_rest[3]+' x '+rien_touche,0,canvas.height*8/12);
		ctx.fillText('Niveau completé : '+point_par_partie_gagnee+' x '+gagne_partie,0,canvas.height*9/12);
		ctx.fillText('score partie : '+partie_score,0,canvas.height*10/12);
		ctx.fillText('score tot : '+total_score,0,canvas.height*11/12);
		if(level_up==1)
		{
			ctx.fillText('niveau débloqué',0,canvas.height*12/12);
		}
		
	}
}

function check_game_over()
{
	
	var i=0;
	var somme=0;
	for(i=0;i<nb_immeubles;i++)
	{
		somme=somme+etat_facade_droite[i]+etat_facade_gauche[i];
	}
	if(((somme==nb_immeubles*2*2)||((maintenant-state_start_time)>etat_4_duree))&&(fin_de_partie==0))
	{
		score_partie=0;
		fin_de_partie=1;
		debut_de_la_fin=maintenant;
		nb_touche_par_type_a_add=nb_touche_par_type;
		for(i=0;i<points_par_type.length;i++)
		{
			score_partie=score_partie+points_par_type[i]*nb_touche_par_type_a_add[i];
		}
		for(i=0;i<nb_immeubles;i++)
		{
			if(etat_facade_droite[i]+etat_facade_gauche[i]==0)//immeuble entier
			{
				nb_bat_rest[2]=nb_bat_rest[2]+1;
				partie_gagnee=1;
			}
			else if((etat_facade_droite[i]==0)||(etat_facade_gauche[i]==0))//aile debout
			{
				nb_bat_rest[1]=nb_bat_rest[1]+1;
			}
			else if((etat_facade_droite[i]!=2)||(etat_facade_gauche[i]!=2))//reste un morceau
			{
				nb_bat_rest[0]=nb_bat_rest[0]+1;
			}
		}
		if(nb_bat_rest[2]==nb_immeubles)
		{
			nb_bat_rest[3]=1;
		}
		for(i=0;i<point_par_bat_rest.length;i++)
		{
			score_partie=score_partie+point_par_bat_rest[i]*nb_bat_rest[i];
		}
		if(partie_gagnee==1)
		{
			score_partie=score_partie+point_par_partie_gagnee;
			if((max_level==selected_level)&&(x_case_niveau.length!=selected_level))
			{
				max_level++;
				level_up=1;
			}
		}
		score_tot=score_tot+score_partie;
	}
}

function trace_upgrades()
{
	var largeur_zone=canvas.width*6/7;
	var hauteur_zone=canvas.height*4/5.5;
	var color_tab=['#fff','#fff','#fff','#fff'];
	hauteur_menus_arme=hauteur_zone/4.5;
	largeur_menus_arme=largeur_zone;
	largeur_pti_bouton=largeur_zone/6;
	hauteur_pti_bouton=hauteur_menus_arme*4/5;
	x_menus=canvas.width/2-largeur_menus_arme/2;
	posi_x_pti_bout_1=x_menus+largeur_menus_arme/5;
	posi_x_pti_bout_2=x_menus+2*largeur_menus_arme/5;
	posi_x_pti_bout_3=x_menus+3*largeur_menus_arme/5;
	posi_x_pti_bout_4=x_menus+4*largeur_menus_arme/5;
	
	y_menu_boulet=canvas.height/2-hauteur_zone/2;
	y_menu_missile=canvas.height/2-hauteur_zone/2+hauteur_menus_arme+(hauteur_zone-4*hauteur_menus_arme)/3;
	y_menu_laser=canvas.height/2-hauteur_zone/2+hauteur_menus_arme*2+2*(hauteur_zone-4*hauteur_menus_arme)/3;
	y_menu_4_eme_arme=canvas.height/2-hauteur_zone/2+hauteur_menus_arme*3+3*(hauteur_zone-4*hauteur_menus_arme)/3;
	posi_y_pti_bout_boulet=y_menu_boulet+hauteur_menus_arme/2-hauteur_pti_bouton/2;
	posi_y_pti_bout_missile=y_menu_missile+hauteur_menus_arme/2-hauteur_pti_bouton/2;
	posi_y_pti_bout_laser=y_menu_laser+hauteur_menus_arme/2-hauteur_pti_bouton/2;
	posi_y_pti_bout_4_eme_arme=y_menu_4_eme_arme+hauteur_menus_arme/2-hauteur_pti_bouton/2;
	
	
	y_bouton_back=canvas.height*11/12-hauteur_3_boutons/2;
	x_bouton_back=(canvas.width-largeur_case_niveau)/2;
	if (niv_max_arme==0)
	{
		color_tab=['#442','#424','#224','#224'];
	}
	else if(niv_max_arme==1)
	{
		color_tab=['#442','#442','#424','#224'];
	}
	else if(niv_max_arme==2)
	{
		color_tab=['#442','#442','#442','#424'];
	}
	else if(niv_max_arme==3)
	{
		color_tab=['#442','#442','#442','#442'];
	}
	
	
	ctx.fillStyle = '#244';
	tracequadrilataire_plein(0,0,0,canvas.height,canvas.width,canvas.height,canvas.width,0);
	//alert(x_case_niveau.length);
	ctx.fillStyle = 'white';
	ctx.fillText('upgrade ton niveau',canvas.width/3,canvas.height/20);
	ctx.fillText(score_tot+' points',canvas.width/3,canvas.height/10);
	
	
	
	ctx.strokeStyle = 'white';
	
	
	ctx.fillStyle = color_tab[0];
	tracequadrilataire_plein(x_menus,y_menu_boulet,x_menus,y_menu_boulet+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_boulet+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_boulet);
	tracequadrilataire(x_menus,y_menu_boulet,x_menus,y_menu_boulet+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_boulet+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_boulet);
	
	tracequadrilataire(posi_x_pti_bout_1,posi_y_pti_bout_boulet,posi_x_pti_bout_1+largeur_pti_bouton,posi_y_pti_bout_boulet,posi_x_pti_bout_1+largeur_pti_bouton,posi_y_pti_bout_boulet+hauteur_pti_bouton,posi_x_pti_bout_1,posi_y_pti_bout_boulet+hauteur_pti_bouton);
	ctx.strokeText(niv_boulet_freq,posi_x_pti_bout_1,posi_y_pti_bout_boulet+hauteur_pti_bouton);
	//tracequadrilataire(posi_x_pti_bout_2,posi_y_pti_bout_boulet,posi_x_pti_bout_2+largeur_pti_bouton,posi_y_pti_bout_boulet,posi_x_pti_bout_2+largeur_pti_bouton,posi_y_pti_bout_boulet+hauteur_pti_bouton,posi_x_pti_bout_2,posi_y_pti_bout_boulet+hauteur_pti_bouton);
	tracequadrilataire(posi_x_pti_bout_3,posi_y_pti_bout_boulet,posi_x_pti_bout_3+largeur_pti_bouton,posi_y_pti_bout_boulet,posi_x_pti_bout_3+largeur_pti_bouton,posi_y_pti_bout_boulet+hauteur_pti_bouton,posi_x_pti_bout_3,posi_y_pti_bout_boulet+hauteur_pti_bouton);
	ctx.strokeText(niv_boulet_vit,posi_x_pti_bout_3,posi_y_pti_bout_boulet+hauteur_pti_bouton);
	//tracequadrilataire(posi_x_pti_bout_4,posi_y_pti_bout_boulet,posi_x_pti_bout_4+largeur_pti_bouton,posi_y_pti_bout_boulet,posi_x_pti_bout_4+largeur_pti_bouton,posi_y_pti_bout_boulet+hauteur_pti_bouton,posi_x_pti_bout_4,posi_y_pti_bout_boulet+hauteur_pti_bouton);
	
	ctx.fillStyle = color_tab[1];
	tracequadrilataire_plein(x_menus,y_menu_missile,x_menus,y_menu_missile+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_missile+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_missile);
	tracequadrilataire(x_menus,y_menu_missile,x_menus,y_menu_missile+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_missile+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_missile);
	if(niv_max_arme==0)
	{
		ctx.strokeText(prix_miss,x_menus,y_menu_missile+hauteur_menus_arme/2);
	}
	else
	{
		tracequadrilataire(posi_x_pti_bout_1,posi_y_pti_bout_missile,posi_x_pti_bout_1+largeur_pti_bouton,posi_y_pti_bout_missile,posi_x_pti_bout_1+largeur_pti_bouton,posi_y_pti_bout_missile+hauteur_pti_bouton,posi_x_pti_bout_1,posi_y_pti_bout_missile+hauteur_pti_bouton);
		ctx.strokeText(niv_miss_periode,posi_x_pti_bout_1,posi_y_pti_bout_missile+hauteur_pti_bouton);
		tracequadrilataire(posi_x_pti_bout_2,posi_y_pti_bout_missile,posi_x_pti_bout_2+largeur_pti_bouton,posi_y_pti_bout_missile,posi_x_pti_bout_2+largeur_pti_bouton,posi_y_pti_bout_missile+hauteur_pti_bouton,posi_x_pti_bout_2,posi_y_pti_bout_missile+hauteur_pti_bouton);
		ctx.strokeText(niv_vit_miss_TC,posi_x_pti_bout_2,posi_y_pti_bout_missile+hauteur_pti_bouton);
		tracequadrilataire(posi_x_pti_bout_3,posi_y_pti_bout_missile,posi_x_pti_bout_3+largeur_pti_bouton,posi_y_pti_bout_missile,posi_x_pti_bout_3+largeur_pti_bouton,posi_y_pti_bout_missile+hauteur_pti_bouton,posi_x_pti_bout_3,posi_y_pti_bout_missile+hauteur_pti_bouton);
		ctx.strokeText(niv_AD_miss,posi_x_pti_bout_3,posi_y_pti_bout_missile+hauteur_pti_bouton);
		tracequadrilataire(posi_x_pti_bout_4,posi_y_pti_bout_missile,posi_x_pti_bout_4+largeur_pti_bouton,posi_y_pti_bout_missile,posi_x_pti_bout_4+largeur_pti_bouton,posi_y_pti_bout_missile+hauteur_pti_bouton,posi_x_pti_bout_4,posi_y_pti_bout_missile+hauteur_pti_bouton);
		ctx.strokeText(niv_manoeuv_miss,posi_x_pti_bout_4,posi_y_pti_bout_missile+hauteur_pti_bouton);
	}
	
	
	
	ctx.fillStyle = color_tab[2];
	tracequadrilataire_plein(x_menus,y_menu_laser,x_menus,y_menu_laser+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_laser+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_laser);
	tracequadrilataire(x_menus,y_menu_laser,x_menus,y_menu_laser+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_laser+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_laser);
	if(niv_max_arme==1)
	{
		ctx.strokeText(prix_laser,x_menus,y_menu_laser+hauteur_menus_arme/2);
	}
	else if (niv_max_arme>1)
	{
		tracequadrilataire(posi_x_pti_bout_1,posi_y_pti_bout_laser,posi_x_pti_bout_1+largeur_pti_bouton,posi_y_pti_bout_laser,posi_x_pti_bout_1+largeur_pti_bouton,posi_y_pti_bout_laser+hauteur_pti_bouton,posi_x_pti_bout_1,posi_y_pti_bout_laser+hauteur_pti_bouton);
		ctx.strokeText(niv_periode_laser,posi_x_pti_bout_1,posi_y_pti_bout_laser+hauteur_pti_bouton);
		tracequadrilataire(posi_x_pti_bout_2,posi_y_pti_bout_laser,posi_x_pti_bout_2+largeur_pti_bouton,posi_y_pti_bout_laser,posi_x_pti_bout_2+largeur_pti_bouton,posi_y_pti_bout_laser+hauteur_pti_bouton,posi_x_pti_bout_2,posi_y_pti_bout_laser+hauteur_pti_bouton);
		ctx.strokeText(niv_duree_laser,posi_x_pti_bout_2,posi_y_pti_bout_laser+hauteur_pti_bouton);
		tracequadrilataire(posi_x_pti_bout_3,posi_y_pti_bout_laser,posi_x_pti_bout_3+largeur_pti_bouton,posi_y_pti_bout_laser,posi_x_pti_bout_3+largeur_pti_bouton,posi_y_pti_bout_laser+hauteur_pti_bouton,posi_x_pti_bout_3,posi_y_pti_bout_laser+hauteur_pti_bouton);
		ctx.strokeText(niv_largeur_laser,posi_x_pti_bout_3,posi_y_pti_bout_laser+hauteur_pti_bouton);
		//tracequadrilataire(posi_x_pti_bout_4,posi_y_pti_bout_laser,posi_x_pti_bout_4+largeur_pti_bouton,posi_y_pti_bout_laser,posi_x_pti_bout_4+largeur_pti_bouton,posi_y_pti_bout_laser+hauteur_pti_bouton,posi_x_pti_bout_4,posi_y_pti_bout_laser+hauteur_pti_bouton);
	}
	
	ctx.fillStyle = color_tab[3];
	tracequadrilataire_plein(x_menus,y_menu_4_eme_arme,x_menus,y_menu_4_eme_arme+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_4_eme_arme+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_4_eme_arme);
	tracequadrilataire(x_menus,y_menu_4_eme_arme,x_menus,y_menu_4_eme_arme+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_4_eme_arme+hauteur_menus_arme,x_menus+largeur_menus_arme,y_menu_4_eme_arme);
	if(niv_max_arme==2)
	{
		ctx.strokeText(prix_arme_4,x_menus,y_menu_4_eme_arme+hauteur_menus_arme/2);
	}
	else if(niv_max_arme>2)
	{
		tracequadrilataire(posi_x_pti_bout_1,posi_y_pti_bout_4_eme_arme,posi_x_pti_bout_1+largeur_pti_bouton,posi_y_pti_bout_4_eme_arme,posi_x_pti_bout_1+largeur_pti_bouton,posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton,posi_x_pti_bout_1,posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton);
		ctx.strokeText(niv_periode_murs,posi_x_pti_bout_1,posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton);
		tracequadrilataire(posi_x_pti_bout_2,posi_y_pti_bout_4_eme_arme,posi_x_pti_bout_2+largeur_pti_bouton,posi_y_pti_bout_4_eme_arme,posi_x_pti_bout_2+largeur_pti_bouton,posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton,posi_x_pti_bout_2,posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton);
		ctx.strokeText(niv_coef_long_mur,posi_x_pti_bout_2,posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton);
		tracequadrilataire(posi_x_pti_bout_3,posi_y_pti_bout_4_eme_arme,posi_x_pti_bout_3+largeur_pti_bouton,posi_y_pti_bout_4_eme_arme,posi_x_pti_bout_3+largeur_pti_bouton,posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton,posi_x_pti_bout_3,posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton);
		ctx.strokeText(niv_type_de_mur,posi_x_pti_bout_3,posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton);
		tracequadrilataire(posi_x_pti_bout_4,posi_y_pti_bout_4_eme_arme,posi_x_pti_bout_4+largeur_pti_bouton,posi_y_pti_bout_4_eme_arme,posi_x_pti_bout_4+largeur_pti_bouton,posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton,posi_x_pti_bout_4,posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton);
		ctx.strokeText(niv_autodef,posi_x_pti_bout_4,posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton);
		
	}
	
	//bouton retour
	tracequadrilataire(x_bouton_back,y_bouton_back,x_bouton_back+largeur_case_niveau,y_bouton_back,x_bouton_back+largeur_case_niveau,y_bouton_back+hauteur_3_boutons,x_bouton_back,y_bouton_back+hauteur_3_boutons);
	
}

function upgrade_test(gepaX,gepaY)
{
	if((gepaX>x_menus)&&(gepaX<x_menus+largeur_menus_arme)&&(gepaY>y_menu_boulet)&&(gepaY<y_menu_boulet+hauteur_menus_arme))
	{
		if((gepaX>posi_x_pti_bout_1)&&(gepaX<posi_x_pti_bout_1+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_boulet)&&(gepaY<posi_y_pti_bout_boulet+hauteur_pti_bouton))
		{
			if((niv_boulet_freq<(periode_boulet_tab.length-1))&&(score_tot>periode_boulet_tarifs[niv_boulet_freq+1]))
			{
				niv_boulet_freq++;
				score_tot=score_tot-periode_boulet_tarifs[niv_boulet_freq];
				temps_entre_2_boulets=periode_boulet_tab[niv_boulet_freq];
			}
		}
		else if((gepaX>posi_x_pti_bout_3)&&(gepaX<posi_x_pti_bout_3+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_boulet)&&(gepaY<posi_y_pti_bout_boulet+hauteur_pti_bouton))
		{
			if((niv_boulet_vit<(vit_boulet_tab.length-1))&&(score_tot>vit_boulet_tarifs[niv_boulet_vit+1]))
			{
				niv_boulet_vit++;
				score_tot=score_tot-vit_boulet_tarifs[niv_boulet_vit];
				vit_boulets=vit_boulet_tab[niv_boulet_vit];
			}
		}
	}
	else if((gepaX>x_menus)&&(gepaX<x_menus+largeur_menus_arme)&&(gepaY>y_menu_missile)&&(gepaY<y_menu_missile+hauteur_menus_arme))
	{
		if((niv_max_arme==0)&&(score_tot>prix_miss))
		{
			niv_max_arme++;
			score_tot=score_tot-prix_miss;
		}
		else
		{
			if((gepaX>posi_x_pti_bout_1)&&(gepaX<posi_x_pti_bout_1+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_missile)&&(gepaY<posi_y_pti_bout_missile+hauteur_pti_bouton))
			{
				if((niv_miss_periode<(periode_miss_tab.length-1))&&(score_tot>periode_miss_tarifs[niv_miss_periode+1]))
				{
					niv_miss_periode++;
					score_tot=score_tot-periode_miss_tarifs[niv_miss_periode];
					temps_entre_2_miss_TC=periode_miss_tab[niv_miss_periode];
				}
			}
			else if((gepaX>posi_x_pti_bout_2)&&(gepaX<posi_x_pti_bout_2+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_missile)&&(gepaY<posi_y_pti_bout_missile+hauteur_pti_bouton))
			{
				if((niv_vit_miss_TC<(vit_miss_tab.length-1))&&(score_tot>vit_miss_tarifs[niv_vit_miss_TC+1]))
				{
					niv_vit_miss_TC++;
					score_tot=score_tot-vit_miss_tarifs[niv_vit_miss_TC];
					vit_miss_TC=vit_miss_tab[niv_vit_miss_TC];
					accel_miss_TC=vit_miss_tab[niv_vit_miss_TC];
				}
			}
			else if((gepaX>posi_x_pti_bout_3)&&(gepaX<posi_x_pti_bout_3+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_missile)&&(gepaY<posi_y_pti_bout_missile+hauteur_pti_bouton))
			{
				if((niv_AD_miss<(AD_portee_tab.length-1))&&(score_tot>AD_miss_tarifs[niv_AD_miss+1]))
				{
					niv_AD_miss++;
					score_tot=score_tot-AD_miss_tarifs[niv_AD_miss];
					portee_AD=AD_portee_tab[niv_AD_miss];
					angle_vue_AD=AD_angle_tab[niv_AD_miss];
				}
			}
			else if((gepaX>posi_x_pti_bout_4)&&(gepaX<posi_x_pti_bout_4+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_missile)&&(gepaY<posi_y_pti_bout_missile+hauteur_pti_bouton))
			{
				if((niv_manoeuv_miss<(manoeuv_miss_tab.length-1))&&(score_tot>manoeuv_miss_tarifs[niv_manoeuv_miss+1]))
				{
					niv_manoeuv_miss++;
					score_tot=score_tot-manoeuv_miss_tarifs[niv_manoeuv_miss];
					vit_rot_max_TC=manoeuv_miss_tab[niv_manoeuv_miss];
				}
			}
		}
	}
	else if((gepaX>x_menus)&&(gepaX<x_menus+largeur_menus_arme)&&(gepaY>y_menu_laser)&&(gepaY<y_menu_laser+hauteur_menus_arme))
	{
		//alert('laser');
		//periode
		//duree
		//taille(couleur)
		if((niv_max_arme==1)&&(score_tot>prix_laser))
		{
			niv_max_arme++;
			score_tot=score_tot-prix_laser;
		}
		else if(niv_max_arme>1)
		{
			if((gepaX>posi_x_pti_bout_1)&&(gepaX<posi_x_pti_bout_1+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_laser)&&(gepaY<posi_y_pti_bout_laser+hauteur_pti_bouton))
			{
				if((niv_periode_laser<(periode_laser_tab.length-1))&&(score_tot>periode_laser_tarifs[niv_periode_laser+1]))
				{
					niv_periode_laser++;
					score_tot=score_tot-periode_laser_tarifs[niv_periode_laser];
					temps_entre_2_laser=periode_laser_tab[niv_periode_laser];
				}
			}
			else if((gepaX>posi_x_pti_bout_2)&&(gepaX<posi_x_pti_bout_2+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_laser)&&(gepaY<posi_y_pti_bout_laser+hauteur_pti_bouton))
			{
				if((niv_duree_laser<(duree_laser_tab.length-1))&&(score_tot>duree_laser_tarifs[niv_duree_laser+1]))
				{
					niv_duree_laser++;
					score_tot=score_tot-duree_laser_tarifs[niv_duree_laser];
					duree_laser=duree_laser_tab[niv_duree_laser];
				}
			}
			else if((gepaX>posi_x_pti_bout_3)&&(gepaX<posi_x_pti_bout_3+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_laser)&&(gepaY<posi_y_pti_bout_laser+hauteur_pti_bouton))
			{
				if((niv_largeur_laser<(largeur_laser_tab.length-1))&&(score_tot>largeur_laser_tarifs[niv_largeur_laser+1]))
				{
					niv_largeur_laser++;
					score_tot=score_tot-largeur_laser_tarifs[niv_largeur_laser];
					coef_largeur_laser=largeur_laser_tab[niv_largeur_laser];
					laser_couleur=laser_couleur_tab[niv_largeur_laser];
				}
			}
		}
	}
	else if((gepaX>x_menus)&&(gepaX<x_menus+largeur_menus_arme)&&(gepaY>y_menu_4_eme_arme)&&(gepaY<y_menu_4_eme_arme+hauteur_menus_arme))
	{
		//alert('4_eme_arme');
		if((niv_max_arme==2)&&(score_tot>prix_arme_4))
		{
			niv_max_arme++;
			score_tot=score_tot-prix_arme_4;
		}
		else if(niv_max_arme>2)
		{
			if((gepaX>posi_x_pti_bout_1)&&(gepaX<posi_x_pti_bout_1+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_4_eme_arme)&&(gepaY<posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton))
			{
				if((niv_periode_murs<(periode_murs_tab.length-1))&&(score_tot>periode_murs_tarifs[niv_periode_murs+1]))
				{
					niv_periode_murs++;
					score_tot=score_tot-periode_murs_tarifs[niv_periode_murs];
					periode_murs=periode_murs_tab[niv_periode_murs];
				}
			}
			else if((gepaX>posi_x_pti_bout_2)&&(gepaX<posi_x_pti_bout_2+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_4_eme_arme)&&(gepaY<posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton))
			{
				if((niv_coef_long_mur<(coef_long_mur_tab.length-1))&&(score_tot>coef_long_mur_tarifs[niv_coef_long_mur+1]))
				{
					niv_coef_long_mur++;
					score_tot=score_tot-coef_long_mur_tarifs[niv_coef_long_mur];
					coef_long_mur=coef_long_mur_tab[niv_coef_long_mur];
				}
			}
			else if((gepaX>posi_x_pti_bout_3)&&(gepaX<posi_x_pti_bout_3+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_4_eme_arme)&&(gepaY<posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton))
			{
				if((niv_type_de_mur<(type_de_mur_tab.length-1))&&(score_tot>type_de_mur_tarifs[niv_type_de_mur+1]))
				{
					niv_type_de_mur++;
					score_tot=score_tot-type_de_mur_tarifs[niv_type_de_mur];
					type_de_mur=type_de_mur_tab[niv_type_de_mur];
				}
			}
			else if((gepaX>posi_x_pti_bout_4)&&(gepaX<posi_x_pti_bout_4+largeur_pti_bouton)&&(gepaY>posi_y_pti_bout_4_eme_arme)&&(gepaY<posi_y_pti_bout_4_eme_arme+hauteur_pti_bouton))
			{
				if((niv_autodef<(autodef_tab.length-1))&&(score_tot>autodef_tarifs[niv_autodef+1]))
				{
					niv_autodef++;
					score_tot=score_tot-autodef_tarifs[niv_autodef];
					autodef=autodef_tab[niv_autodef];
				}
			}
		}
	}
	/*else
	{
		alert('mal vise');
	}*/
}

function affiche_tuto()
{
	var oldlineWidth=ctx.lineWidth;
    ctx.lineWidth=3//canvas.width/50;
	ctx.globalAlpha=0.5;
	ctx.fillStyle="white";
	//x_3_boutons[lindice],y_3_boutons,
	var largeur_zone=canvas.width*3/4;
	var marge=(largeur_zone-3*largeur_case_niveau)/6;
	var taille_police=canvas.width*0.07;
	tracequadrilataire_plein(0,y_case_niveau[0]-marge,0,0,canvas.width,0,canvas.width,y_case_niveau[0]-marge);
	tracequadrilataire_plein(0,y_case_niveau[0]-marge,0,y_case_niveau[11]+hauteur_case_niveau+marge,x_case_niveau[0]-marge,y_case_niveau[11]+hauteur_case_niveau+marge,x_case_niveau[0]-marge,y_case_niveau[0]-marge);
	tracequadrilataire_plein(canvas.width,y_case_niveau[0]-marge,canvas.width,y_case_niveau[11]+hauteur_case_niveau+marge,x_case_niveau[2]+largeur_case_niveau+marge,y_case_niveau[11]+hauteur_case_niveau+marge,x_case_niveau[2]+largeur_case_niveau+marge,y_case_niveau[0]-marge);
	tracequadrilataire_plein(0,y_case_niveau[11]+hauteur_case_niveau+marge,0,y_3_boutons-marge,canvas.width,y_3_boutons-marge,canvas.width,y_case_niveau[11]+hauteur_case_niveau+marge);
	tracequadrilataire_plein(0,y_3_boutons-marge,0,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[0]-marge,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[0]-marge,y_3_boutons-marge);
	tracequadrilataire_plein(canvas.width,y_3_boutons-marge,canvas.width,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[2]+largeur_case_niveau+marge,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[2]+largeur_case_niveau+marge,y_3_boutons-marge);
	tracequadrilataire_plein(x_3_boutons[2]-marge,y_3_boutons-marge,x_3_boutons[2]-marge,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[1]+largeur_case_niveau+marge,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[1]+largeur_case_niveau+marge,y_3_boutons-marge);
	tracequadrilataire_plein(x_3_boutons[1]-marge,y_3_boutons-marge,x_3_boutons[1]-marge,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[0]+largeur_case_niveau+marge,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[0]+largeur_case_niveau+marge,y_3_boutons-marge);
	tracequadrilataire_plein(0,y_3_boutons+hauteur_3_boutons+marge,0,canvas.height ,canvas.width,canvas.height,canvas.width,y_3_boutons+marge+hauteur_3_boutons);
	
	ctx.globalAlpha=1;
	
	ctx.strokeStyle="green";
	tracequadrilataire(x_3_boutons[0]-marge,y_3_boutons-marge,x_3_boutons[0]-marge,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[0]+largeur_case_niveau+marge,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[0]+largeur_case_niveau+marge,y_3_boutons-marge);
	ctx.strokeStyle="red";
	ctx.beginPath();
	ctx.lineTo(x_3_boutons[1]+largeur_case_niveau/2,y_3_boutons-marge);
	ctx.lineTo(x_3_boutons[1]+largeur_case_niveau/2,y_3_boutons-taille_police-marge*2);
	ctx.stroke();
	tracequadrilataire(x_3_boutons[1]-marge,y_3_boutons-marge,x_3_boutons[1]-marge,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[1]+largeur_case_niveau+marge,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[1]+largeur_case_niveau+marge,y_3_boutons-marge);
	ctx.strokeStyle="blue";
	tracequadrilataire(x_3_boutons[2]-marge,y_3_boutons-marge,x_3_boutons[2]-marge,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[2]+largeur_case_niveau+marge,y_3_boutons+hauteur_3_boutons+marge,x_3_boutons[2]+largeur_case_niveau+marge,y_3_boutons-marge);
	ctx.strokeStyle="yellow";
	ctx.beginPath();
	ctx.lineTo(x_3_boutons[1]+largeur_case_niveau/2-taille_police*3,y_case_niveau[11]+hauteur_case_niveau+marge);
	ctx.lineTo(x_case_niveau[0]-marge,y_case_niveau[11]+hauteur_case_niveau+marge);
	ctx.lineTo(x_case_niveau[0]-marge,y_case_niveau[0]-marge);
	ctx.lineTo(x_case_niveau[2]+largeur_case_niveau+marge,y_case_niveau[0]-marge);
	ctx.lineTo(x_case_niveau[2]+largeur_case_niveau+marge,y_case_niveau[11]+hauteur_case_niveau+marge);
	ctx.lineTo(x_3_boutons[1]+largeur_case_niveau/2+taille_police*3,y_case_niveau[11]+hauteur_case_niveau+marge);
	ctx.stroke();
	
	ctx.lineWidth=oldlineWidth;
	ctx.strokeStyle="black";
	ctx.fillStyle='yellow'
	//ctx.font='oblique small-caps 900 '+taille_police+'px Arial';
	ctx.font='oblique 900 '+taille_police+'px Arial';
	ctx.fillText('Choix du niveau', x_case_niveau[1]+largeur_case_niveau/2-taille_police*3.5, y_case_niveau[0]-marge*2);
	ctx.strokeText('Choix du niveau', x_case_niveau[1]+largeur_case_niveau/2-taille_police*3.5, y_case_niveau[0]-marge*2);
	ctx.fillStyle='green'
	ctx.fillText('Code de triche',x_3_boutons[0]+largeur_case_niveau/2-taille_police*3 , y_3_boutons-marge*2);
	ctx.strokeText('Code de triche', x_3_boutons[0]+largeur_case_niveau/2-taille_police*3, y_3_boutons-marge*2);
	ctx.fillStyle='red'
	ctx.fillText('Améliorations', x_3_boutons[1]+largeur_case_niveau/2-taille_police*3, y_3_boutons-taille_police-marge*2);
	ctx.strokeText('Améliorations', x_3_boutons[1]+largeur_case_niveau/2-taille_police*3, y_3_boutons-taille_police-marge*2);
	ctx.fillStyle='blue'
	ctx.fillText('Jouer', x_3_boutons[2]+largeur_case_niveau/2-taille_police*1.3, y_3_boutons-marge*2);
	ctx.strokeText('Jouer', x_3_boutons[2]+largeur_case_niveau/2-taille_police*1.3, y_3_boutons-marge*2);
	
	
}

function affiche_choix_niveau()
{
	/*
	paysage(num_paysage);
	*/
	var lindice=0;
	var oldlineWidth=ctx.lineWidth;
	largeur_case_niveau=canvas.width/5;
	hauteur_case_niveau=canvas.height/7;
	var largeur_zone=canvas.width*3/4;
	var hauteur_zone=canvas.height*2/3;
	var largeur_int=(largeur_zone-3*largeur_case_niveau)/2;
	var hauteur_int=(hauteur_zone-4*hauteur_case_niveau)/3;
	hauteur_3_boutons=canvas.height/15;
	y_3_boutons=canvas.height-(canvas.height-hauteur_zone)/4-hauteur_3_boutons/2;
	
	ctx.fillStyle = '#244';
	tracequadrilataire_plein(0,0,0,canvas.height,canvas.width,canvas.height,canvas.width,0);
	//alert(x_case_niveau.length);
	for(lindice=0;lindice<x_case_niveau.length;lindice++)
	{
		x_case_niveau[lindice]=(largeur_case_niveau+largeur_int)*(lindice%3)+(canvas.width-largeur_zone)/2;
		y_case_niveau[lindice]=(hauteur_case_niveau+hauteur_int)*(Math.floor(lindice/3))+(canvas.height-hauteur_zone)/2-canvas.height/20;
		if((lindice+1)>max_level)
		{
			ctx.fillStyle = '#224';
			tracequadrilataire_plein(x_case_niveau[lindice],y_case_niveau[lindice],x_case_niveau[lindice]+largeur_case_niveau,y_case_niveau[lindice],x_case_niveau[lindice]+largeur_case_niveau,y_case_niveau[lindice]+hauteur_case_niveau,x_case_niveau[lindice],y_case_niveau[lindice]+hauteur_case_niveau);
		}
		else
		{
			ctx.translate((x_case_niveau[lindice]+largeur_case_niveau/2),(y_case_niveau[lindice]+hauteur_case_niveau/2));
			ctx.scale(0.2, 0.2);
			ctx.translate(-(canvas.width/2),-(canvas.height/2));
			ctx.fillStyle = '#a00';
			paysage(lindice+1);
			ctx.translate((canvas.width/2),(canvas.height/2));
			ctx.scale(5, 5);
			ctx.translate(-(x_case_niveau[lindice]+largeur_case_niveau/2),-(y_case_niveau[lindice]+hauteur_case_niveau/2));
		}
	}
	
	ctx.fillStyle='orange';
	tracequadrilataire_plein(0,0,0,y_case_niveau[0],canvas.width,y_case_niveau[0],canvas.width,0);
	tracequadrilataire_plein(0,y_case_niveau[0]+hauteur_case_niveau,0,y_case_niveau[3],canvas.width,y_case_niveau[3],canvas.width,y_case_niveau[0]+hauteur_case_niveau);
	tracequadrilataire_plein(0,y_case_niveau[3]+hauteur_case_niveau,0,y_case_niveau[6],canvas.width,y_case_niveau[6],canvas.width,y_case_niveau[3]+hauteur_case_niveau);
	tracequadrilataire_plein(0,y_case_niveau[6]+hauteur_case_niveau,0,y_case_niveau[9],canvas.width,y_case_niveau[9],canvas.width,y_case_niveau[6]+hauteur_case_niveau);
	tracequadrilataire_plein(0,y_case_niveau[9]+hauteur_case_niveau,0,canvas.height,canvas.width,canvas.height,canvas.width,y_case_niveau[9]+hauteur_case_niveau);
	
	tracequadrilataire_plein(0,0,0,canvas.height,x_case_niveau[0],canvas.height,x_case_niveau[0],0);
	tracequadrilataire_plein(x_case_niveau[0]+largeur_case_niveau,0,x_case_niveau[0]+largeur_case_niveau,canvas.height,x_case_niveau[1],canvas.height,x_case_niveau[1],0);
	tracequadrilataire_plein(x_case_niveau[1]+largeur_case_niveau,0,x_case_niveau[1]+largeur_case_niveau,canvas.height,x_case_niveau[2],canvas.height,x_case_niveau[2],0);
	tracequadrilataire_plein(x_case_niveau[2]+largeur_case_niveau,0,x_case_niveau[2]+largeur_case_niveau,canvas.height,canvas.width,canvas.height,canvas.width,0);
	
	ctx.strokeStyle = 'white';
	for(lindice=0;lindice<x_case_niveau.length;lindice++)
	{
		x_case_niveau[lindice]=(largeur_case_niveau+largeur_int)*(lindice%3)+(canvas.width-largeur_zone)/2;
		y_case_niveau[lindice]=(hauteur_case_niveau+hauteur_int)*(Math.floor(lindice/3))+(canvas.height-hauteur_zone)/2-canvas.height/20;
		if(selected_level==(lindice+1))
		{
			ctx.lineWidth=5;
			ctx.strokeStyle='red';
		}
		else
		{
			ctx.lineWidth=oldlineWidth;
			ctx.strokeStyle='white';
		}
		tracequadrilataire(x_case_niveau[lindice],y_case_niveau[lindice],x_case_niveau[lindice]+largeur_case_niveau,y_case_niveau[lindice],x_case_niveau[lindice]+largeur_case_niveau,y_case_niveau[lindice]+hauteur_case_niveau,x_case_niveau[lindice],y_case_niveau[lindice]+hauteur_case_niveau);
	}
	ctx.lineWidth=oldlineWidth;
	ctx.strokeStyle='white';
	ctx.fillStyle = '#229';
	for(lindice=0;lindice<3;lindice++)
	{
		x_3_boutons[lindice]=(largeur_case_niveau+largeur_int)*(lindice%3)+(canvas.width-largeur_zone)/2;
		tracequadrilataire_plein(x_3_boutons[lindice],y_3_boutons,x_3_boutons[lindice]+largeur_case_niveau,y_3_boutons,x_3_boutons[lindice]+largeur_case_niveau,y_3_boutons+hauteur_3_boutons,x_3_boutons[lindice],y_3_boutons+hauteur_3_boutons);
		tracequadrilataire(x_3_boutons[lindice],y_3_boutons,x_3_boutons[lindice]+largeur_case_niveau,y_3_boutons,x_3_boutons[lindice]+largeur_case_niveau,y_3_boutons+hauteur_3_boutons,x_3_boutons[lindice],y_3_boutons+hauteur_3_boutons);
	}
	

}

function RAZ_niveau()
{
	fin_de_partie=0;
	partie_gagnee=0;
	level_up=0;
    vit_x_boulet=[];
	vit_y_boulet=[];
	pos_x_boulet=[];
	pos_y_boulet=[];
	
     vit_x_miss_TC=[];
      vit_y_miss_TC=[];
     pos_x_miss_TC=[];
     pos_y_miss_TC=[];
     
     mur_fantome=0;
   
		type_mur=[];
		vies_mur=[];
		coef_longueur_mur=[];
		autodefense_mur=[];
	    pos_x_mur=[];
		pos_y_mur=[];
		indices_miss_special=[];
		dernier_tir_miss_special=[];
		
		
	
     laser_ON=0;
     dernier_tir_laser=0;
     haut_laser=0;
     bas_laser=0;
     t_OFF_laser=0;

     x_bat_explose=[];
     y_bat_explose=[];
     x_miss_explose=[];
     y_miss_explose=[];
     date_impact=[];
     vit_x_miss_exlpose=[];
     vit_y_miss_explose=[];
     ind_immeuble_explosion=[];

     vit_x_miss =[];
     vit_y_miss =[];
     pos_x_miss =[];
     pos_y_miss =[];
     type_miss =[];
     angle_miss=[];
     etat_propu=[];

     largeur_immeubles=[];
     hauteur_immeubles=[];
     posi_immeubles=[];
     etat_facade_droite=[];
     etat_facade_gauche=[];

    pos_bat_a_jour=0;
    
    angle_canon=0;
    selection_arme=0;//0:canon    1:missile_ad    2:laser    3:briques
	score_partie=0;
	nb_touche_par_type=[0,0,0,0];
	nb_bat_rest=[0,0,0,0];
	
	pos_x_soucoupe=[];
	pos_y_soucoupe=[];
	vit_soucoupe=[];
	points_vie_soucoupe=[];
	instant_dernier_impact_soucoupe=[];
	soucoupe_inv=[];
 x_objectif_soucoupe=[];
 instant_dernier_arret_soucoupe=[];
 a_fait_caca=[];
 duree_soucoupe_inv=1;

 pos_x_caca=[];
 pos_y_caca=[];
 vit_caca=[];
 instant_caca_par_terre=[];
}

function level_config()
{
	num_paysage=selected_level;
	
	if (selected_level==1)
	{
		proportion_type_missile=[1,0,0,1];
	}
	else if (selected_level==2)
	{
		proportion_type_missile=[1,4,1,0];
	}
	else if (selected_level==3)
	{
		proportion_type_missile=[0,1,3,0];
	}
	
	//points_par_type=[5,5,10,20];
    //point_par_partie_gagnee=100;
   //point_par_bat_rest=[5,6,10];
	// nb bâtiments. nb_immeubles--;
}

function affiche_titre()
{
	var temps_restant_titre=intro_duree-(maintenant-state_start_time);
	ctx.fillText(temps_restant_titre,200,80);
	ctx.fillText("Missiles DTC",canvas.width/10,canvas.height/3);
}

function trace_choix_armes()
{
	var hauteur_barre=hauteur_rect+2/3*(canvas.height-hauteur_rect);
	var hauteur_barre_2=hauteur_rect+8/9*(canvas.height-hauteur_rect);
	var largeur_barre=canvas.width/5;
	var debut_barre_1=(canvas.width/4-largeur_barre)/2;
	var debut_barre_2=canvas.width/4+(canvas.width/4-largeur_barre)/2;
	var debut_barre_3=2*canvas.width/4+(canvas.width/4-largeur_barre)/2;
	var debut_barre_4=3*canvas.width/4+(canvas.width/4-largeur_barre)/2;
	var part_de_barre_boulet=Math.min(1,(maintenant-dernier_tir_boulet)/temps_entre_2_boulets);
	var part_de_barre_TC=Math.min(1,(maintenant-dernier_tir_TC)/temps_entre_2_miss_TC);
	var part_de_barre_laser=Math.min(1,(maintenant-dernier_tir_laser)/temps_entre_2_laser);
	var part_de_barre_mur=Math.min(1,(maintenant-dernier_mur)/periode_murs);
	var dice=0;
	for(dice=0;dice<4;dice++)
	{
		if(dice==selection_arme)
		{
			ctx.fillStyle = 'white';
		}
		else
		{
			ctx.fillStyle = '#ddd';
		}
		tracequadrilataire_plein(dice*canvas.width/4,canvas.height,dice*canvas.width/4,hauteur_rect,(dice+1)*canvas.width/4,hauteur_rect,(dice+1)*canvas.width/4,canvas.height);
		tracequadrilataire(dice*canvas.width/4,canvas.height,dice*canvas.width/4,hauteur_rect,(dice+1)*canvas.width/4,hauteur_rect,(dice+1)*canvas.width/4,canvas.height);
	}
	if(part_de_barre_boulet==1)
	{
		ctx.fillStyle = 'green';
	}
	else
	{
		ctx.fillStyle = 'orange';
	}
	tracequadrilataire(debut_barre_1,hauteur_barre_2,debut_barre_1,hauteur_barre,debut_barre_1+largeur_barre,hauteur_barre,debut_barre_1+largeur_barre,hauteur_barre_2);
	tracequadrilataire_plein(debut_barre_1,hauteur_barre_2,debut_barre_1,hauteur_barre,debut_barre_1+largeur_barre*part_de_barre_boulet,hauteur_barre,debut_barre_1+largeur_barre*part_de_barre_boulet,hauteur_barre_2);
	if(part_de_barre_TC==1)
	{
		ctx.fillStyle = 'green';
	}
	else
	{
		ctx.fillStyle = 'orange';
	}
	tracequadrilataire(debut_barre_2,hauteur_barre_2,debut_barre_2,hauteur_barre,debut_barre_2+largeur_barre,hauteur_barre,debut_barre_2+largeur_barre,hauteur_barre_2);
	tracequadrilataire_plein(debut_barre_2,hauteur_barre_2,debut_barre_2,hauteur_barre,debut_barre_2+largeur_barre*part_de_barre_TC,hauteur_barre,debut_barre_2+largeur_barre*part_de_barre_TC,hauteur_barre_2);
	if(part_de_barre_laser==1)
	{
		ctx.fillStyle = 'green';
	}
	else
	{
		ctx.fillStyle = 'orange';
	}
	tracequadrilataire(debut_barre_3,hauteur_barre_2,debut_barre_3,hauteur_barre,debut_barre_3+largeur_barre,hauteur_barre,debut_barre_3+largeur_barre,hauteur_barre_2);
	tracequadrilataire_plein(debut_barre_3,hauteur_barre_2,debut_barre_3,hauteur_barre,debut_barre_3+largeur_barre*part_de_barre_laser,hauteur_barre,debut_barre_3+largeur_barre*part_de_barre_laser,hauteur_barre_2);
	if(part_de_barre_mur==1)
	{
		ctx.fillStyle = 'green';
	}
	else
	{
		ctx.fillStyle = 'orange';
	}
	tracequadrilataire(debut_barre_4,hauteur_barre_2,debut_barre_4,hauteur_barre,debut_barre_4+largeur_barre,hauteur_barre,debut_barre_4+largeur_barre,hauteur_barre_2);
	tracequadrilataire_plein(debut_barre_4,hauteur_barre_2,debut_barre_4,hauteur_barre,debut_barre_4+largeur_barre*part_de_barre_mur,hauteur_barre,debut_barre_4+largeur_barre*part_de_barre_mur,hauteur_barre_2);
	
	for(dice=0;dice<4;dice++)
	{
	/*selection_arme=0;//0:canon    1:missile_ad    2:laser    3:briques
var niv_max_arme=1;*/
		if(dice>niv_max_arme)
		{
			ctx.fillStyle = 'grey';
			tracequadrilataire_plein(dice*canvas.width/4,canvas.height,dice*canvas.width/4,hauteur_rect,(dice+1)*canvas.width/4,hauteur_rect,(dice+1)*canvas.width/4,canvas.height);
		}
		ctx.strokeStyle = 'black';
	}
	//max_max_level=1;
	//
}

function trace_laser()
{
	//largeur_laser;
	//haut_laser;
	//bas_laser;
	var largeur_laser_loc=largeur_laser*(0.9+Math.random()*0.2);
	ctx.translate(canvas.width/2,hauteur_rect-largeur_socle/4-largeur_socle/3);
	ctx.rotate(angle_canon);
	//tracequadrilataire(-1,-1,-1,1,1,1,1,-1);
	ctx.fillStyle = laser_couleur;
	ctx.globalAlpha=0.2;
	tracequadrilataire_plein(largeur_laser_loc,-bas_laser,-largeur_laser_loc,-bas_laser,-largeur_laser_loc,-haut_laser,largeur_laser_loc,-haut_laser);
	ctx.globalAlpha=1;
	tracequadrilataire_plein(largeur_laser_loc/2,-bas_laser,-largeur_laser_loc/2,-bas_laser,-largeur_laser_loc/2,-haut_laser,largeur_laser_loc/2,-haut_laser);
	ctx.fillStyle = 'white';
	tracequadrilataire_plein(largeur_laser/2.5,-bas_laser,-largeur_laser/2.5,-bas_laser,-largeur_laser/2.5,-haut_laser,largeur_laser/2.5,-haut_laser);
	ctx.rotate(-angle_canon);
	ctx.translate(-canvas.width/2,-hauteur_rect+largeur_socle/4+largeur_socle/3);
}

function mise_a_jour_laser()
{
	if((clic_en_cours==1)&&(selection_arme==2))
	{
		if((maintenant-dernier_tir_laser)>temps_entre_2_laser)
		{
			//alert(maintenant-dernier_tir_laser);
			dernier_tir_laser=maintenant;
			laser_ON=1;
			//alert(0);
		}
	}
	if(((maintenant-dernier_tir_laser)>duree_laser)&&(laser_ON==1))
	{
		t_OFF_laser=maintenant;
		laser_ON=0;
	}
	haut_laser=Math.min((maintenant-dernier_tir_laser)*vitesse_lumiere*hauteur_rect,2*hauteur_rect);
	if(laser_ON==1)
	{
		bas_laser=0;
	}
	else
	{
		bas_laser=Math.min((maintenant-(dernier_tir_laser+duree_laser))*vitesse_lumiere*hauteur_rect,2*hauteur_rect);
	}
	
}

function mise_a_jour_murs()
{
	var y_mur=0;
	if((clic_en_cours==1)&&(selection_arme==3))
	{
		if((maintenant-dernier_mur)>periode_murs)
		{
			dernier_mur=maintenant;
			mur_fantome=1;
		}
		if(mur_fantome==1)
		{
			//tracequadrilataire_plein(5,5,10,5,10,10,5,10);
			tracefantome();
		}
	}
	else if(mur_fantome==1)
	{
		mur_fantome=0;
		type_mur.push(type_de_mur);
		vies_mur.push(type_de_mur+1);
		coef_longueur_mur.push(coef_long_mur);
		autodefense_mur.push(autodef);
	    y_mur=Math.max(yrond[0],hauteur_rect/2);
		y_mur=Math.min(y_mur,hauteur_rect*6/7);
		pos_x_mur.push(xrond[0]);
		pos_y_mur.push(y_mur);
		dernier_tir_miss_special.push(maintenant);
	}
}

function tracemurpaille(x_remu,y_remu,coef_long_remu,autodef_remu,vies_remu,transpar)
{
	ctx.fillStyle='yellow';
	ctx.globalAlpha=transpar;
	var longueur_mur_sur_2=coef_long_remu*canvas.width/(2*rapport_coef_murs);
	epaisseur_mur=hauteur_rect/(0.85*rapport_coef_murs);
	tracequadrilataire_plein(x_remu-longueur_mur_sur_2,y_remu-epaisseur_mur,x_remu-longueur_mur_sur_2,y_remu+epaisseur_mur,x_remu+longueur_mur_sur_2,y_remu+epaisseur_mur,x_remu+longueur_mur_sur_2,y_remu-epaisseur_mur);
	ctx.globalAlpha=1;
}
function tracemurbois(x_remu,y_remu,coef_long_remu,autodef_remu,vies_remu,transpar)
{
	ctx.fillStyle='brown';
	ctx.globalAlpha=transpar;
	var longueur_mur_sur_2=coef_long_remu*canvas.width/(2*rapport_coef_murs);
	epaisseur_mur=hauteur_rect/(0.85*rapport_coef_murs);
	tracequadrilataire_plein(x_remu-longueur_mur_sur_2,y_remu-epaisseur_mur,x_remu-longueur_mur_sur_2,y_remu+epaisseur_mur,x_remu+longueur_mur_sur_2,y_remu+epaisseur_mur,x_remu+longueur_mur_sur_2,y_remu-epaisseur_mur);
	ctx.globalAlpha=1;
}
function tracemurbriques(x_remu,y_remu,coef_long_remu,autodef_remu,vies_remu,transpar)
{
	ctx.fillStyle='red';
	ctx.globalAlpha=transpar;
	var longueur_mur_sur_2=coef_long_remu*canvas.width/(2*rapport_coef_murs);
	epaisseur_mur=hauteur_rect/(0.85*rapport_coef_murs);
	tracequadrilataire_plein(x_remu-longueur_mur_sur_2,y_remu-epaisseur_mur,x_remu-longueur_mur_sur_2,y_remu+epaisseur_mur,x_remu+longueur_mur_sur_2,y_remu+epaisseur_mur,x_remu+longueur_mur_sur_2,y_remu-epaisseur_mur);
	ctx.globalAlpha=1;
}
function tracemurmetal(x_remu,y_remu,coef_long_remu,autodef_remu,vies_remu,transpar)
{
	ctx.fillStyle='grey';
	ctx.globalAlpha=transpar;
	var longueur_mur_sur_2=coef_long_remu*canvas.width/(2*rapport_coef_murs);
	epaisseur_mur=hauteur_rect/(0.85*rapport_coef_murs);
	tracequadrilataire_plein(x_remu-longueur_mur_sur_2,y_remu-epaisseur_mur,x_remu-longueur_mur_sur_2,y_remu+epaisseur_mur,x_remu+longueur_mur_sur_2,y_remu+epaisseur_mur,x_remu+longueur_mur_sur_2,y_remu-epaisseur_mur);
	ctx.globalAlpha=1;
}

function tracefantome()
{
	var y_remure=0;
	y_remure=Math.max(yrond[0],hauteur_rect/2);
	y_remure=Math.min(y_remure,hauteur_rect*6/7);
	if(type_de_mur==0)
	{
		//alert(coef_long_mur);
		tracemurpaille(xrond[0],y_remure,coef_long_mur,autodef,1,0.65);
	}
	else if(type_de_mur==1)
	{
		tracemurbois(xrond[0],y_remure,coef_long_mur,autodef,2,0.65);
	}
	else if(type_de_mur==2)
	{
		tracemurbriques(xrond[0],y_remure,coef_long_mur,autodef,3,0.65);
	}
	else if(type_de_mur==3)
	{
		tracemurmetal(xrond[0],y_remure,coef_long_mur,autodef,4,0.65);
	}
}

function trace_murs()
{
	var deux_dice=0;
	var nombre_puins = pos_x_mur.length;
	if (nombre_puins>=1)
	{
		//alert(nombre_puins);
		for (deux_dice=0;deux_dice<nombre_puins;deux_dice++)
		{
			if(type_mur[deux_dice]==0)
			{
				tracemurpaille(pos_x_mur[deux_dice],pos_y_mur[deux_dice],coef_longueur_mur[deux_dice],autodefense_mur[deux_dice],vies_mur[deux_dice],1);
			}
			else if(type_mur[deux_dice]==1)
			{
				tracemurbois(pos_x_mur[deux_dice],pos_y_mur[deux_dice],coef_longueur_mur[deux_dice],autodefense_mur[deux_dice],vies_mur[deux_dice],1);
			}
			else if(type_mur[deux_dice]==2)
			{
				tracemurbriques(pos_x_mur[deux_dice],pos_y_mur[deux_dice],coef_longueur_mur[deux_dice],autodefense_mur[deux_dice],vies_mur[deux_dice],1);
			}
			else if(type_mur[deux_dice]==3)
			{
				tracemurmetal(pos_x_mur[deux_dice],pos_y_mur[deux_dice],coef_longueur_mur[deux_dice],autodefense_mur[deux_dice],vies_mur[deux_dice],1);
			}
	    }
	}
}

function mise_a_jour_miss_TC()
{
	var nb_miss_TC=0;
	var undiz=0;
	var nb_menaces=0;
	var long_min=99999;
	var distance=0;
	var angle_max=0;
	var angle_miss_miss=0;
	var ind_long_min=0;
	var trois_dice=0;
	var dist_miss_miss_X=0;
	var dist_miss_miss_Y=0;
	var vit_miss_TC_loc=0;
	var test_ang_miss=0;
	var facteur_vit_avant_apres_loc=0;
	var rot_max=0;
	var delta_rotation=0;
	var angle_miss_TC_loc=0;
	var AD_portee=0;
	if((clic_en_cours==1)&&(selection_arme==1))
	{
		if((maintenant-dernier_tir_TC)>temps_entre_2_miss_TC)
		{
			creation_miss_TC();
			dernier_tir_TC=maintenant;
		}
	}
	nb_miss_TC=vit_x_miss_TC.length;
	for(trois_dice=0;trois_dice<nb_miss_TC;trois_dice++)
	{
		if(indices_miss_special.indexOf(trois_dice)>-1)
		{
			angle_max=AD_angle_miss_special[autodef]*Math.PI/180;
			AD_portee=AD_portee_miss_special[autodef];
			rot_max=manoeuv_miss_special[autodef]*deltat*Math.PI/180;
		}
		else
		{
			angle_max=angle_vue_AD*Math.PI/180;
			AD_portee=portee_AD;
			rot_max=vit_rot_max_TC*deltat*Math.PI/180;
		}
			
		long_min=99999;
		angle_miss_TC_loc=calcul_angle_miss(vit_x_miss_TC[trois_dice],vit_y_miss_TC[trois_dice]);
		delta_rotation=0;
		vit_miss_TC_loc=(vit_x_miss_TC[trois_dice]**2+vit_y_miss_TC[trois_dice]**2)**(1/2)*(1+accel_miss_TC*deltat);
		nb_menaces=pos_x_miss.length;
		/*
		var manoeuv_miss_special=[100,100,150,200];
		*/
		for(undiz=0;undiz<nb_menaces;undiz++)
		{
			dist_miss_miss_X=pos_x_miss[undiz]-pos_x_miss_TC[trois_dice];
			dist_miss_miss_Y=pos_y_miss[undiz]-pos_y_miss_TC[trois_dice];
			distance=(dist_miss_miss_X**2+dist_miss_miss_Y**2)**(1/2);
			angle_miss_miss=calcul_angle_miss(dist_miss_miss_X,dist_miss_miss_Y)-angle_miss_TC_loc;
			if (angle_miss_miss>Math.PI)
			{
				angle_miss_miss=angle_miss_miss-2*Math.PI;
			}
			else if (angle_miss_miss<-Math.PI)
			{
				angle_miss_miss=angle_miss_miss+2*Math.PI;
			}
			if((distance<long_min)&&(Math.abs(angle_miss_miss)<=angle_max)&&(distance<=AD_portee*hauteur_rect))
			{
				long_min=distance;
				ind_long_min=undiz;
				delta_rotation=Math.max(Math.min(angle_miss_miss,rot_max),-rot_max);
				//alert(delta_rotation);
				//test_ang_miss=angle_miss_miss*180/Math.PI;
			}
		}
		nb_menaces=pos_x_soucoupe.length;
		for(undiz=0;undiz<nb_menaces;undiz++)
		{
			if(soucoupe_inv[undiz]==0)
			{
				dist_miss_miss_X=pos_x_soucoupe[undiz]-pos_x_miss_TC[trois_dice];
				dist_miss_miss_Y=pos_y_soucoupe[undiz]-pos_y_miss_TC[trois_dice];
				distance=(dist_miss_miss_X**2+dist_miss_miss_Y**2)**(1/2);
				angle_miss_miss=calcul_angle_miss(dist_miss_miss_X,dist_miss_miss_Y)-angle_miss_TC_loc;
				if (angle_miss_miss>Math.PI)
				{
					angle_miss_miss=angle_miss_miss-2*Math.PI;
				}
				else if (angle_miss_miss<-Math.PI)
				{
					angle_miss_miss=angle_miss_miss+2*Math.PI;
				}
				if((distance<long_min)&&(Math.abs(angle_miss_miss)<=angle_max)&&(distance<=AD_portee*hauteur_rect))
				{
					long_min=distance;
					ind_long_min=undiz;
					delta_rotation=Math.max(Math.min(angle_miss_miss,rot_max),-rot_max);
					//alert(delta_rotation);
					//test_ang_miss=angle_miss_miss*180/Math.PI;
				}
			}
		}
		vit_x_miss_TC[trois_dice]=vit_miss_TC_loc*Math.sin(delta_rotation+angle_miss_TC_loc);
		vit_y_miss_TC[trois_dice]=-vit_miss_TC_loc*Math.cos(delta_rotation+angle_miss_TC_loc);
		//alert(vit_x_miss_TC[trois_dice]);
		//alert(vit_y_miss_TC[trois_dice]);
		delta_piX=hauteur_rect*vit_x_miss_TC[trois_dice]*deltat;
		delta_piY=hauteur_rect*vit_y_miss_TC[trois_dice]*deltat;
		pos_x_miss_TC[trois_dice]=pos_x_miss_TC[trois_dice]+delta_piX;
		pos_y_miss_TC[trois_dice]=pos_y_miss_TC[trois_dice]+delta_piY;
		if((pos_y_miss_TC[trois_dice]<(-hauteur_rect/10))||(pos_x_miss_TC[trois_dice]>11*canvas.width/10)||(pos_x_miss_TC[trois_dice]<-canvas.width/10))
		{
			suppression_miss_TC(trois_dice);
			//alert(0);
			trois_dice--;
			nb_miss_TC--;
		}
	}
}

function mise_a_jour_boulets()
{
	var nb_boulets=0;
	var trois_dice=0;
	var delta_piX=0;
	var delta_piY=0;
	if((clic_en_cours==1)&&(selection_arme==0))
	{
		if((maintenant-dernier_tir_boulet)>temps_entre_2_boulets)
		{
			creation_boulet();
			dernier_tir_boulet=maintenant;
		}
	}
	nb_boulets=vit_x_boulet.length;
	for(trois_dice=0;trois_dice<nb_boulets;trois_dice++)
	{
		delta_piX=hauteur_rect*vit_x_boulet[trois_dice]*deltat;
		delta_piY=hauteur_rect*vit_y_boulet[trois_dice]*deltat;
		pos_x_boulet[trois_dice]=pos_x_boulet[trois_dice]+delta_piX;
		pos_y_boulet[trois_dice]=pos_y_boulet[trois_dice]+delta_piY;
		if((pos_y_boulet[trois_dice]<(-hauteur_rect/10))||(pos_x_boulet[trois_dice]>11*canvas.width/10)||(pos_x_boulet[trois_dice]<-canvas.width/10))
		{
			suppression_boulet(trois_dice);
			trois_dice--;
			nb_boulets--;
		}
	}
}

function creation_boulet(){
	vit_x_boulet.push(vit_boulets*Math.sin(angle_canon));
	vit_y_boulet.push(-vit_boulets*Math.cos(angle_canon));
	pos_x_boulet.push(canvas.width/2);
	pos_y_boulet.push(hauteur_rect-largeur_socle/4-largeur_socle/3);
}

function creation_miss_TC(){
	vit_x_miss_TC.push(vit_miss_TC*Math.sin(angle_canon));
	vit_y_miss_TC.push(-vit_miss_TC*Math.cos(angle_canon));
	pos_x_miss_TC.push(canvas.width/2);
	pos_y_miss_TC.push(hauteur_rect-largeur_socle/4-largeur_socle/3);
}

function mise_a_j_pos_bat(nb_imm){
     var ind=0;
     var somme_large = 0;
     for(ind=0;ind<nb_imm;ind++)
     {
        largeur_immeubles.push(hauteur_rect/20+Math.floor(Math.random()*hauteur_rect*0.092));
         hauteur_immeubles.push(hauteur_rect/20+Math.floor(Math.random()*hauteur_rect*0.092));
		posi_immeubles.push(Math.floor(Math.random()*(canvas.width-largeur_immeubles[ind])));
		etat_facade_droite.push(0);
		etat_facade_gauche.push(0);
     }
}

function mise_a_jour_missiles() {
	var trois_dice=0;
	var deux_dice=0;
	var undiz=0;
	var nb_miss=0;
	var nb_souc=0;
	var nb_cakes=0;
	var delta_pixel_y=0;
	var delta_pixel_x=0;
	var min_vit_x=0;
	var max_vit_x=0;
	var dist_miss_bat_X=0;
	var dist_miss_bat_Y=0;
	var distance=0;
	var angle_miss_bat=0;
	var angle_miss_TC_loc=0;
	var long_min=999999;
	var ind_long_min=0;
	var delta_rotation=0;
	var rot_max=vit_rot_max_TC*deltat*Math.PI/180*2/3;
	var module_delta=0;
	var test_x=0;
	var test_y=0;
	if(last_miss_date==0)
	{
	    delay_before_next_miss=min_delay_between_2_miss+Math.random()*(max_delay_between_2_miss-min_delay_between_2_miss);
	    last_miss_date=maintenant;
	}
	if((maintenant-last_miss_date)>=delay_before_next_miss)
	{
	     delay_before_next_miss=min_delay_between_2_miss+Math.random()*(max_delay_between_2_miss-min_delay_between_2_miss);
	     last_miss_date=maintenant;   
		creation_missile();
	}
	nb_miss=pos_x_miss.length;
	for(trois_dice=0;trois_dice<nb_miss;trois_dice++)
	{
		//alert(pos_y_miss[trois_dice]);
		if((type_miss[trois_dice]==1)&&(pos_y_miss[trois_dice]>hauteur_rect/2))
		{
			angle_miss_TC_loc=calcul_angle_miss(vit_x_miss[trois_dice]*canvas.width,vit_y_miss[trois_dice]*hauteur_rect);
			long_min=999999;
			//alert(angle_miss_TC_loc*180/Math.PI);
			for(undiz=0;undiz<nb_immeubles;undiz++)
			{
				for(deux_dice=0;deux_dice<2;deux_dice++)
				{
					if(deux_dice==0)
					{
						if(etat_facade_gauche[undiz]==0)
						{
							test_x=posi_immeubles[undiz]+largeur_immeubles[undiz]/4;
							test_y=hauteur_rect-hauteur_immeubles[undiz]*3/4;
						}
						else if(etat_facade_gauche[undiz]==1)
						{
							test_x=posi_immeubles[undiz]+largeur_immeubles[undiz]/4;
							test_y=hauteur_rect-hauteur_immeubles[undiz]/4;
						}
						else
						{
							test_x=1000;
							test_y=1000;
						}
					}
					else
					{
						if(etat_facade_droite[undiz]==0)
						{
							test_x=posi_immeubles[undiz]+largeur_immeubles[undiz]*3/4;
							test_y=hauteur_rect-hauteur_immeubles[undiz]*3/4;
						}
						else if(etat_facade_droite[undiz]==1)
						{
							test_x=posi_immeubles[undiz]+largeur_immeubles[undiz]*3/4;
							test_y=hauteur_rect-hauteur_immeubles[undiz]/4;
						}
						else
						{
							test_x=1000;
							test_y=1000;
						}
					}
					dist_miss_bat_X=-pos_x_miss[trois_dice]+test_x;
					dist_miss_bat_Y=-pos_y_miss[trois_dice]+test_y;
					//alert(dist_miss_bat_X/canvas.width);
					distance=(dist_miss_bat_X**2+dist_miss_bat_Y**2)**(1/2);
					angle_miss_bat=calcul_angle_miss(dist_miss_bat_X,dist_miss_bat_Y)-angle_miss_TC_loc;
					//alert(angle_miss_bat*180/Math.PI/deltat);
					if (angle_miss_bat>Math.PI)
					{
						angle_miss_bat=angle_miss_bat-2*Math.PI;
					}
					else if (angle_miss_bat<-Math.PI)
					{
						angle_miss_bat=angle_miss_bat+2*Math.PI;
					}
					//alert(angle_miss_bat*180/Math.PI);
					if(distance<long_min)
					{
						long_min=distance;
						ind_long_min=undiz;
						
						delta_rotation=Math.max(Math.min(angle_miss_bat,rot_max),-rot_max);
						//alert(delta_rotation);
						//test_ang_miss=angle_miss_miss*180/Math.PI;
					}
				}
			}
			
			//alert(delta_rotation*180/Math.PI);
			//alert(ind_long_min);
			/*
			vit_x_miss_TC[trois_dice]=vit_miss_TC_loc*Math.sin(delta_rotation+angle_miss_TC_loc);
			vit_y_miss_TC[trois_dice]=-vit_miss_TC_loc*Math.cos(delta_rotation+angle_miss_TC_loc);
			//alert(vit_x_miss_TC[trois_dice]);
			//alert(vit_y_miss_TC[trois_dice]);
			delta_piX=hauteur_rect*vit_x_miss_TC[trois_dice]*deltat;
			delta_piY=hauteur_rect*vit_y_miss_TC[trois_dice]*deltat;
			*/
			delta_pixel_x=canvas.width*vit_x_miss[trois_dice]*deltat;
			delta_pixel_y=hauteur_rect*vit_y_miss[trois_dice]*deltat;
			module_delta=(delta_pixel_x**2+delta_pixel_y**2)**(1/2);
			delta_pixel_x=module_delta*Math.sin(delta_rotation+angle_miss_TC_loc);
			delta_pixel_y=-module_delta*Math.cos(delta_rotation+angle_miss_TC_loc);
			vit_x_miss[trois_dice]=delta_pixel_x/deltat/canvas.width;
			vit_y_miss[trois_dice]=delta_pixel_y/deltat/hauteur_rect;
			angle_miss[trois_dice]=calcul_angle_miss(delta_pixel_x,delta_pixel_y);
		}
		else
		{
			delta_pixel_x=canvas.width*vit_x_miss[trois_dice]*deltat;
			delta_pixel_y=hauteur_rect*vit_y_miss[trois_dice]*deltat;
		}
		pos_x_miss[trois_dice]=pos_x_miss[trois_dice]+delta_pixel_x;
		pos_y_miss[trois_dice]=pos_y_miss[trois_dice]+delta_pixel_y;
		etat_propu[trois_dice]=(etat_propu[trois_dice]+1)%3;
		if(pos_y_miss[trois_dice]>ligne_arrivee_miss*hauteur_rect)
		{
			suppression_missile(trois_dice)
			trois_dice--;
			nb_miss--;
		}
	}
	nb_souc=pos_x_soucoupe.length;
	for(trois_dice=0;trois_dice<nb_souc;trois_dice++)
	{
		//alert('avant : '+vit_soucoupe[trois_dice]);
		pos_x_soucoupe[trois_dice]=pos_x_soucoupe[trois_dice]+vit_soucoupe[trois_dice]*deltat;
		if((vit_soucoupe[trois_dice]>0)&&(pos_x_soucoupe[trois_dice]>x_objectif_soucoupe[trois_dice]))
		{
			vit_soucoupe[trois_dice]=0;
			instant_dernier_arret_soucoupe[trois_dice]=maintenant;
		}
		else if((vit_soucoupe[trois_dice]<0)&&(pos_x_soucoupe[trois_dice]<x_objectif_soucoupe[trois_dice]))
		{
			vit_soucoupe[trois_dice]=0;
			instant_dernier_arret_soucoupe[trois_dice]=maintenant;
		}
		else if((vit_soucoupe[trois_dice]==0)&&(maintenant-instant_dernier_arret_soucoupe[trois_dice]>duree_caca))
		{
			x_objectif_soucoupe[trois_dice]=attribu_objectif();
			a_fait_caca[trois_dice]=0;
			if((x_objectif_soucoupe[trois_dice]-pos_x_soucoupe[trois_dice]>0))
			{
				vit_soucoupe[trois_dice]=canvas.width/3;
			}
			else
			{
				vit_soucoupe[trois_dice]=-canvas.width/3;
			}
		}
		else if((vit_soucoupe[trois_dice]==0)&&(maintenant-instant_dernier_arret_soucoupe[trois_dice]>duree_caca*5/6)&&(a_fait_caca[trois_dice]==0))
		{
			pos_x_caca.push(pos_x_soucoupe[trois_dice]);
			pos_y_caca.push(pos_y_soucoupe[trois_dice]+taille_soucoupe/5);
			vit_caca.push(0.1);
			instant_caca_par_terre.push(0);
			a_fait_caca[trois_dice]=1;
		}
		
		/*pos_x_soucoupe=[];
var pos_y_soucoupe=[];
var vit_soucoupe=[];
var points_vie_soucoupe=[];
var instant_dernier_impact_soucoupe=[];
var soucoupe_inv=[];
var x_objectif_soucoupe=[];
var instant_dernier_arret_soucoupe=[];
var duree_soucoupe_inv=1;
var duree_caca=1.5;
var taille_soucoupe=40;*/
		if((soucoupe_inv[trois_dice]==1)&&(maintenant-instant_dernier_impact_soucoupe[trois_dice]>duree_soucoupe_inv))
		{
			soucoupe_inv[trois_dice]=0;
		}
	}
	nb_cakes=pos_x_caca.length;
	for(trois_dice=0;trois_dice<nb_cakes;trois_dice++)
	{
		pos_y_caca[trois_dice]=pos_y_caca[trois_dice]+vit_caca[trois_dice]*hauteur_rect*deltat;
		if(vit_caca[trois_dice]!=0)
		{
			vit_caca[trois_dice]=vit_caca[trois_dice]+acc_caca*deltat;
		}
		if((vit_caca[trois_dice]!=0)&&(pos_y_caca[trois_dice]-vit_caca[trois_dice]*taille_caca*4>hauteur_rect))
		{
			vit_caca[trois_dice]=0;
			instant_caca_par_terre[trois_dice]=maintenant;
			//alert(instant_caca_par_terre[trois_dice]);
		}
		if((vit_caca[trois_dice]==0)&&((maintenant-instant_caca_par_terre[trois_dice])>duree_par_terre))
		//if(vit_caca[trois_dice]==0)
		{
			//if((maintenant-instant_caca_par_terre[trois_dice])>duree_par_terre)
			//{
			//alert(trois_dice);
			sup_caca(trois_dice);
			trois_dice--;
			nb_cakes--;
			//}
		}
	}
	
}

function trace_arme()
{
	ctx.strokeStyle = 'black';
	ctx.fillStyle = 'pink';
	ctx.beginPath();
	ctx.lineTo(canvas.width/2-largeur_socle/2,hauteur_rect);
	ctx.lineTo(canvas.width/2-largeur_socle/2,hauteur_rect-largeur_socle/6);
	ctx.lineTo(canvas.width/2,hauteur_rect-largeur_socle/6-largeur_socle/3);
	ctx.lineTo(canvas.width/2-largeur_socle/6,hauteur_rect-largeur_socle/6);
	ctx.lineTo(canvas.width/2+largeur_socle/6,hauteur_rect-largeur_socle/6);
	ctx.lineTo(canvas.width/2,hauteur_rect-largeur_socle/6-largeur_socle/3);
	ctx.lineTo(canvas.width/2+largeur_socle/2,hauteur_rect-largeur_socle/6);
	ctx.lineTo(canvas.width/2+largeur_socle/2,hauteur_rect-largeur_socle/6);
	ctx.lineTo(canvas.width/2+largeur_socle/2,hauteur_rect);
		//ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		//ctx.lineTo(larg_mis_sur_2/4, long_p_cent+2.8*long_par);
		//ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		//ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(canvas.width/2-largeur_socle/2,hauteur_rect);
		ctx.closePath();
		ctx.fill();
		ctx.stroke();
		
	ctx.translate(canvas.width/2,hauteur_rect-largeur_socle/4-largeur_socle/3);
	ctx.rotate(angle_canon);
	ctx.beginPath();
	ctx.arc(0, 0, largeur_socle/5, -Math.PI/2+Math.PI/6, 3*Math.PI/2-Math.PI/6,false);
	ctx.lineTo(-largeur_socle/10,-largeur_socle/3);
	ctx.lineTo(largeur_socle/10,-largeur_socle/3);
	//ctx.lineTo(0,0);
    ctx.closePath();
	ctx.fill();
	ctx.stroke();
	ctx.rotate(-angle_canon);
	ctx.translate(-canvas.width/2,-hauteur_rect+largeur_socle/4+largeur_socle/3);
}

function creation_missile()
{
	//proportion_type_missile
	var type_de_missile=5;
	var somme_prop=0;
	var prop_cumul=[];
	var i=0;
	var randome=0;
	for(i=0;i<proportion_type_missile.length;i++)
	{
		somme_prop=somme_prop+proportion_type_missile[i];
		prop_cumul.push(somme_prop);
		//alert("prop cum "+i+" : "+prop_cumul[i]);
	}
	randome=somme_prop*Math.random();
	for(i=proportion_type_missile.length-1;i>=0;i--)
	{
		if(prop_cumul[i]>randome)
		{
			type_de_missile=i;
		}
	}
	//type_de_missile=Math.floor(Math.random()*nb_enemy_max);
	if(type_de_missile<=2)
	{
	     vit_y_miss.push(vit_min_traverse_ecran[type_de_missile]+Math.random()*(vit_max_traverse_ecran[type_de_missile]-vit_min_traverse_ecran[type_de_missile]));
	     pos_x_miss.push(-ligne_depart_miss*canvas.width+Math.random()*canvas.width*(1+2*ligne_depart_miss));
		 if(pos_x_miss[pos_x_miss.length-1]<=0)
		{
			min_vit_x=vit_y_miss[vit_y_miss.length-1]*((-pos_x_miss[pos_x_miss.length-1])/canvas.width)/ligne_depart_miss;
			max_vit_x=vit_y_miss[vit_y_miss.length-1]*(1-pos_x_miss[pos_x_miss.length-1]/canvas.width)/(1+ligne_depart_miss);
		}
	     else if(pos_x_miss[pos_x_miss.length-1]>=canvas.width)
		{
			min_vit_x=vit_y_miss[vit_y_miss.length-1]*((-pos_x_miss[pos_x_miss.length-1])/canvas.width)/(1+ligne_depart_miss);
			max_vit_x=vit_y_miss[vit_y_miss.length-1]*(1-pos_x_miss[pos_x_miss.length-1]/canvas.width)/(ligne_depart_miss);
		}
		else
		{
			min_vit_x=vit_y_miss[vit_y_miss.length-1]*((-pos_x_miss[pos_x_miss.length-1])/canvas.width)/(1+ligne_depart_miss);
			max_vit_x=vit_y_miss[vit_y_miss.length-1]*(1-pos_x_miss[pos_x_miss.length-1]/canvas.width)/(1+ligne_depart_miss);
		}
		vit_x_miss.push(min_vit_x+Math.random()*(max_vit_x-min_vit_x));
	     //alert(vit_x_miss[vit_x_miss.length-1]);
	      pos_y_miss.push(-hauteur_rect*ligne_depart_miss);
	     type_miss.push(type_de_missile);
		 etat_propu.push(0);
		angle_miss.push(calcul_angle_miss(canvas.width*vit_x_miss[vit_x_miss.length-1],hauteur_rect*vit_y_miss[vit_y_miss.length-1]));
	}
	else
	{
		randome=Math.floor(Math.random()*2);
		//alert(randome);
		pos_x_soucoupe.push(randome*canvas.width+(randome-0.5)*2*taille_soucoupe*0.6);
		pos_y_soucoupe.push(canvas.height/8);
		x_objectif_soucoupe.push(attribu_objectif());
		vit_soucoupe.push(-(randome-0.5)*2*canvas.width/3);
		points_vie_soucoupe.push(3);
		instant_dernier_impact_soucoupe.push(0);
		instant_dernier_arret_soucoupe.push(0);
		soucoupe_inv.push(0);
		a_fait_caca.push(0);
	}
}

function attribu_objectif()
{
	return Math.random()*canvas.width;
}

function creat_double_miss(x_miss_decede,y_miss_decede)
{
	var index=0;
     for(index=0;index<2;index++)
     {
		vit_y_miss.push(vit_min_traverse_ecran[2]+Math.random()*(vit_max_traverse_ecran[2]-vit_min_traverse_ecran[2]));
	     pos_x_miss.push(x_miss_decede);
	     pos_y_miss.push(y_miss_decede);
		 if(pos_x_miss[pos_x_miss.length-1]<=0)
		{
			min_vit_x=vit_y_miss[vit_y_miss.length-1]*((-pos_x_miss[pos_x_miss.length-1])/canvas.width)/(-y_miss_decede/hauteur_rect);
			max_vit_x=vit_y_miss[vit_y_miss.length-1]*(1-pos_x_miss[pos_x_miss.length-1]/canvas.width)/(1+(-y_miss_decede/hauteur_rect));
		}
	     else if(pos_x_miss[pos_x_miss.length-1]>=canvas.width)
		{
			min_vit_x=vit_y_miss[vit_y_miss.length-1]*((-pos_x_miss[pos_x_miss.length-1])/canvas.width)/(1+(-y_miss_decede/hauteur_rect));
			max_vit_x=vit_y_miss[vit_y_miss.length-1]*(1-pos_x_miss[pos_x_miss.length-1]/canvas.width)/((-y_miss_decede/hauteur_rect));
		}
		else
		{
			min_vit_x=vit_y_miss[vit_y_miss.length-1]*((-pos_x_miss[pos_x_miss.length-1])/canvas.width)/(1+(-y_miss_decede/hauteur_rect));
			max_vit_x=vit_y_miss[vit_y_miss.length-1]*(1-pos_x_miss[pos_x_miss.length-1]/canvas.width)/(1+(-y_miss_decede/hauteur_rect));
		}
		vit_x_miss.push(min_vit_x+Math.random()*(max_vit_x-min_vit_x));
	     //alert(vit_x_miss[vit_x_miss.length-1]);
	     type_miss.push(0);
		 etat_propu.push(0);
		angle_miss.push(calcul_angle_miss(canvas.width*vit_x_miss[vit_x_miss.length-1],hauteur_rect*vit_y_miss[vit_y_miss.length-1]));
	}
}

function calcul_angle_miss(vit_x,vit_y)
{
	var angle;
	if (vit_x>0)
	{
		angle=Math.atan(vit_y/vit_x)+Math.PI/2;
	}
	else if (vit_x<0)
	{
	     angle=Math.atan(vit_y/vit_x)+Math.PI*3/2;
	}
	else if (vit_y>0)
	{
		angle=Math.PI;
	}
	else
	{
		angle=0;
	}
	return angle;
}

function mise_a_jour_impact_miss_laser()
{
	var undice=0;
	var resultat_collision=0;
	var nb_missiles_a_tester=pos_x_miss.length;
	var x_p_1=0;
	var x_p_2=0;
	var x_p_3=0;
	var x_p_4=0;
	var y_p_1=0;
	var y_p_2=0;
	var y_p_3=0;
	var y_p_4=0;
	for(undice=0;undice<nb_missiles_a_tester;undice++)
	{
			//pos_x_point_1=(largeur_corps_miss[type_miss[undice]]/2)*Math.cos(angle_miss[undice])+0*Math.sin(angle_miss[undice]);
	//pos_y_point_1=-(largeur_corps_miss[type_miss[undice]]/2)*Math.sin(angle_miss[undice])+0*Math.cos(angle_miss[undice]);
			x_p_1=pos_x_miss[undice]+(largeur_corps_miss[type_miss[undice]]/2)*Math.cos(angle_miss[undice])-0*Math.sin(angle_miss[undice]);
			y_p_1=pos_y_miss[undice]+((largeur_corps_miss[type_miss[undice]]/2)*Math.sin(angle_miss[undice])+0*Math.cos(angle_miss[undice]));
			x_p_2=pos_x_miss[undice]+(-largeur_corps_miss[type_miss[undice]]/2)*Math.cos(angle_miss[undice])-0*Math.sin(angle_miss[undice]);
			y_p_2=pos_y_miss[undice]+((-largeur_corps_miss[type_miss[undice]]/2)*Math.sin(angle_miss[undice])+0*Math.cos(angle_miss[undice]));
			x_p_3=pos_x_miss[undice]+(-largeur_corps_miss[type_miss[undice]]/2)*Math.cos(angle_miss[undice])-longueur_corps_miss[type_miss[undice]]*Math.sin(angle_miss[undice]);
			y_p_3=pos_y_miss[undice]+((-largeur_corps_miss[type_miss[undice]]/2)*Math.sin(angle_miss[undice])+longueur_corps_miss[type_miss[undice]]*Math.cos(angle_miss[undice]));
			x_p_4=pos_x_miss[undice]+(largeur_corps_miss[type_miss[undice]]/2)*Math.cos(angle_miss[undice])-longueur_corps_miss[type_miss[undice]]*Math.sin(angle_miss[undice]);
			y_p_4=pos_y_miss[undice]+((largeur_corps_miss[type_miss[undice]]/2)*Math.sin(angle_miss[undice])+longueur_corps_miss[type_miss[undice]]*Math.cos(angle_miss[undice]));
			
			
			/*ctx.strokeStyle = 'red';
			tracequadrilataire(x_p_1,y_p_1,x_p_2,y_p_2,x_p_3,y_p_3,x_p_4,y_p_4);*/
			resultat_collision=test_collision_segment_vs_laser(x_p_1,y_p_1,x_p_2,y_p_2,angle_canon,largeur_laser,bas_laser,haut_laser);
			resultat_collision=test_collision_segment_vs_laser(x_p_2,y_p_2,x_p_3,y_p_3,angle_canon,largeur_laser,bas_laser,haut_laser)+resultat_collision;
			resultat_collision=test_collision_segment_vs_laser(x_p_3,y_p_3,x_p_4,y_p_4,angle_canon,largeur_laser,bas_laser,haut_laser)+resultat_collision;
			resultat_collision=test_collision_segment_vs_laser(x_p_4,y_p_4,x_p_1,y_p_1,angle_canon,largeur_laser,bas_laser,haut_laser)+resultat_collision;
			if(resultat_collision>0)
			{
				if(type_miss[undice]!=2)
				{
					nb_touche_par_type[type_miss[undice]]=nb_touche_par_type[type_miss[undice]]+1;
					suppression_missile(undice);
					undice--;
					nb_missiles_a_tester--;
				}
				else
				{
					creat_double_miss(pos_x_miss[undice],pos_y_miss[undice]);
					nb_touche_par_type[type_miss[undice]]=nb_touche_par_type[type_miss[undice]]+1;
					suppression_missile(undice);
					undice--;
					nb_missiles_a_tester++;
				}
			}
	}
}

function mise_a_jour_impact_miss_miss()
{
	var undice=0;
	var deuxdice=0;
	var resultat_collision=0;
	var nb_missiles_a_tester=pos_x_miss.length;
	var nb_miss_TC_a_tester=vit_x_miss_TC.length;
	for(undice=0;undice<nb_missiles_a_tester;undice++)
	{
		for(deuxdice=0;deuxdice<nb_miss_TC_a_tester;deuxdice++)
		{
			resultat_collision=test_collision_boulet_vs_miss(pos_x_miss[undice],pos_y_miss[undice],type_miss[undice],angle_miss[undice],pos_x_miss_TC[deuxdice],pos_y_miss_TC[deuxdice],taille_miss_TC);
			//alert(resultat_collision);
			if(resultat_collision==1)
			{
				if(type_miss[undice]!=2)
				{
					nb_touche_par_type[type_miss[undice]]=nb_touche_par_type[type_miss[undice]]+1;
					suppression_missile(undice);
					undice--;
					nb_missiles_a_tester--;
				}
				else
				{
					creat_double_miss(pos_x_miss[undice],pos_y_miss[undice]);
					nb_touche_par_type[type_miss[undice]]=nb_touche_par_type[type_miss[undice]]+1;
					suppression_missile(undice);
					undice--;
					nb_missiles_a_tester++;
				}
				suppression_miss_TC(deuxdice);
				deuxdice--;
				nb_miss_TC_a_tester--;
			}
		}
	}
}

function mise_a_jour_impact_soucoupes()
{
	//suite ici
	var undice=0;
	var deuxdice=0;
	var resultat_collision=0;
	var nb_soucoupes_a_tester=pos_x_soucoupe.length;
	var nb_boulets_a_tester=vit_x_boulet.length;
	var nb_miss_TC_a_tester=vit_x_miss_TC.length;
	for(undice=0;undice<nb_soucoupes_a_tester;undice++)
	{
		for(deuxdice=0;deuxdice<nb_boulets_a_tester;deuxdice++)
		{
			resultat_collision=test_collision_boulet_vs_soucoupe(pos_x_soucoupe[undice],pos_y_soucoupe[undice],pos_x_boulet[deuxdice],pos_y_boulet[deuxdice],taille_boulet);
			if((resultat_collision==1)&&(soucoupe_inv[undice]==0))
			{
				suppression_boulet(deuxdice);
				deuxdice--;
				nb_boulets_a_tester--;
				points_vie_soucoupe[undice]=points_vie_soucoupe[undice]-1;
				soucoupe_inv[undice]=1;
				instant_dernier_impact_soucoupe[undice]=maintenant;
				x_objectif_soucoupe[undice]=attribu_objectif();
				a_fait_caca[undice]=0;
				if(x_objectif_soucoupe[undice]-pos_x_soucoupe[undice]>0)
				{
					vit_soucoupe[undice]=canvas.width/3;
				}
				else
				{
					vit_soucoupe[undice]=-canvas.width/3;
				}
				//alert(instant_dernier_impact_soucoupe[undice]);
				if(points_vie_soucoupe[undice]==0)
				{
					nb_touche_par_type[3]=nb_touche_par_type[3]+1;
					
					suppression_soucoupe(undice);
					
					undice--;
					nb_soucoupes_a_tester++;
				}
			}
		}
		for(deuxdice=0;deuxdice<nb_miss_TC_a_tester;deuxdice++)
		{
			resultat_collision=test_collision_boulet_vs_soucoupe(pos_x_soucoupe[undice],pos_y_soucoupe[undice],pos_x_miss_TC[deuxdice],pos_y_miss_TC[deuxdice],taille_miss_TC);
			//alert(resultat_collision);
			if((resultat_collision==1)&&(soucoupe_inv[undice]==0))
			{
				suppression_miss_TC(deuxdice);
				deuxdice--;
				nb_miss_TC_a_tester--;
				points_vie_soucoupe[undice]=points_vie_soucoupe[undice]-1;
				soucoupe_inv[undice]=1;
				instant_dernier_impact_soucoupe[undice]=maintenant;
				x_objectif_soucoupe[undice]=attribu_objectif();
				a_fait_caca[undice]=0;
				if(x_objectif_soucoupe[undice]-pos_x_soucoupe[undice]>0)
				{
					vit_soucoupe[undice]=canvas.width/3;
				}
				else
				{
					vit_soucoupe[undice]=-canvas.width/3;
				}
				if(points_vie_soucoupe[undice]==0)
				{
					nb_touche_par_type[3]=nb_touche_par_type[3]+1;
					suppression_soucoupe(undice);
					undice--;
					nb_soucoupes_a_tester++;
				}
			}
		}
		resultat_collision=test_collision_segment_vs_laser(pos_x_soucoupe[undice]-taille_soucoupe*Math.cos(Math.PI/5),pos_y_soucoupe[undice],pos_x_soucoupe[undice]+taille_soucoupe*Math.cos(Math.PI/5),pos_y_soucoupe[undice],angle_canon,largeur_laser,bas_laser,haut_laser);
		if((resultat_collision==1)&&(soucoupe_inv[undice]==0))
		{
			points_vie_soucoupe[undice]=points_vie_soucoupe[undice]-1;
			soucoupe_inv[undice]=1;
			instant_dernier_impact_soucoupe[undice]=maintenant;
			x_objectif_soucoupe[undice]=attribu_objectif();
			a_fait_caca[undice]=0;
			if(x_objectif_soucoupe[undice]-pos_x_soucoupe[undice]>0)
			{
				vit_soucoupe[undice]=canvas.width/3;
			}
			else
			{
				vit_soucoupe[undice]=-canvas.width/3;
			}
			if(points_vie_soucoupe[undice]==0)
			{
				nb_touche_par_type[3]=nb_touche_par_type[3]+1;
				suppression_soucoupe(undice);
				undice--;
				nb_soucoupes_a_tester++;
			}
		}
	}
}

function mise_a_jour_impact_defenses_cacas()
{
	var undice=0;
	var deuxdice=0;
	var resultat_collision=0;
	var nb_cacas_a_tester=pos_x_caca.length;
	var nb_boulets_a_tester=vit_x_boulet.length;
	var nb_missiles_a_tester=vit_x_miss_TC.length;
	var x_p_1=0;
	var x_p_2=0;
	var x_p_3=0;
	var x_p_4=0;
	var y_p_1=0;
	var y_p_2=0;
	var y_p_3=0;
	var y_p_4=0;
	for(undice=0;undice<nb_cacas_a_tester;undice++)
	{
		for(deuxdice=0;deuxdice<nb_boulets_a_tester;deuxdice++)
		{
			resultat_collision=test_collision_boulet_vs_miss(pos_x_caca[undice],pos_y_caca[undice],3,0,pos_x_boulet[deuxdice],pos_y_boulet[deuxdice],taille_boulet);
			//alert(resultat_collision);
			if(resultat_collision==1)
			{
				//nb_touche_par_type[type_miss[undice]]=nb_touche_par_type[type_miss[undice]]+1;
				sup_caca(undice);
				undice--;
				nb_cacas_a_tester--;
			}
		}
		for(deuxdice=0;deuxdice<nb_missiles_a_tester;deuxdice++)
		{
			resultat_collision=test_collision_boulet_vs_miss(pos_x_caca[undice],pos_y_caca[undice],3,0,pos_x_miss_TC[deuxdice],pos_y_miss_TC[deuxdice],taille_miss_TC);
			 //alert(resultat_collision);
			if(resultat_collision==1)
			{
				//nb_touche_par_type[type_miss[undice]]=nb_touche_par_type[type_miss[undice]]+1;
				sup_caca(undice);
				undice--;
				nb_cacas_a_tester--;
			}
		}
		/*
		x_p_1=pos_x_caca[undice]+(largeur_corps_miss[3]/2)*Math.cos(angle_miss[undice]);//-0*Math.sin(angle_miss[undice]);
		y_p_1=pos_y_caca[undice]+((largeur_corps_miss[3]/2)*Math.sin(angle_miss[undice]);//+0*Math.cos(angle_miss[undice]));
		x_p_2=pos_x_caca[undice]+(-largeur_corps_miss[3]/2)*Math.cos(angle_miss[undice]);//-0*Math.sin(angle_miss[undice]);
		y_p_2=pos_y_caca[undice]+((-largeur_corps_miss[3]/2)*Math.sin(angle_miss[undice]);//+0*Math.cos(angle_miss[undice]));
		x_p_3=pos_x_caca[undice]+(-largeur_corps_miss[3]/2)*Math.cos(angle_miss[undice]);//-longueur_corps_miss[type_miss[undice]]*Math.sin(angle_miss[undice]);
		y_p_3=pos_y_caca[undice]+((-largeur_corps_miss[3]/2)*Math.sin(angle_miss[undice])+longueur_corps_miss[type_miss[undice]];//*Math.cos(angle_miss[undice]));
		x_p_4=pos_x_caca[undice]+(largeur_corps_miss[3]/2)*Math.cos(angle_miss[undice]);//-longueur_corps_miss[type_miss[undice]]*Math.sin(angle_miss[undice]);
		y_p_4=pos_y_caca[undice]+((largeur_corps_miss[3]/2)*Math.sin(angle_miss[undice])+longueur_corps_miss[type_miss[undice]];//*Math.cos(angle_miss[undice]));
		*/
		
		x_p_1=pos_x_caca[undice]+(largeur_corps_miss[3]/2);
		y_p_1=pos_y_caca[undice];
		x_p_2=pos_x_caca[undice]+(-largeur_corps_miss[3]/2);
		y_p_2=pos_y_caca[undice];
		x_p_3=pos_x_caca[undice]+(-largeur_corps_miss[3]/2);
		y_p_3=pos_y_caca[undice]+longueur_corps_miss[3];
		x_p_4=pos_x_caca[undice]+(largeur_corps_miss[3]/2);
		y_p_4=pos_y_caca[undice]+longueur_corps_miss[3];
		
		
		resultat_collision=test_collision_segment_vs_laser(x_p_1,y_p_1,x_p_2,y_p_2,angle_canon,largeur_laser,bas_laser,haut_laser);
		resultat_collision=test_collision_segment_vs_laser(x_p_2,y_p_2,x_p_3,y_p_3,angle_canon,largeur_laser,bas_laser,haut_laser)+resultat_collision;
		resultat_collision=test_collision_segment_vs_laser(x_p_3,y_p_3,x_p_4,y_p_4,angle_canon,largeur_laser,bas_laser,haut_laser)+resultat_collision;
		resultat_collision=test_collision_segment_vs_laser(x_p_4,y_p_4,x_p_1,y_p_1,angle_canon,largeur_laser,bas_laser,haut_laser)+resultat_collision;
		
		if(resultat_collision>0)
		{
			sup_caca(undice);
			undice--;
			nb_cacas_a_tester--;
		}
	}
}

function mise_a_jour_impact_miss_boulet()
{
	var undice=0;
	var deuxdice=0;
	var resultat_collision=0;
	var nb_missiles_a_tester=pos_x_miss.length;
	var nb_boulets_a_tester=vit_x_boulet.length;
	for(undice=0;undice<nb_missiles_a_tester;undice++)
	{
		for(deuxdice=0;deuxdice<nb_boulets_a_tester;deuxdice++)
		{
			resultat_collision=test_collision_boulet_vs_miss(pos_x_miss[undice],pos_y_miss[undice],type_miss[undice],angle_miss[undice],pos_x_boulet[deuxdice],pos_y_boulet[deuxdice],taille_boulet);
			//alert(resultat_collision);
			if(resultat_collision==1)
			{
				if(type_miss[undice]!=2)
				{
					nb_touche_par_type[type_miss[undice]]=nb_touche_par_type[type_miss[undice]]+1;
					suppression_missile(undice);
					undice--;
					nb_missiles_a_tester--;
				}
				else
				{
					creat_double_miss(pos_x_miss[undice],pos_y_miss[undice]);
					nb_touche_par_type[type_miss[undice]]=nb_touche_par_type[type_miss[undice]]+1;
					suppression_missile(undice);
					undice--;
					nb_missiles_a_tester++;
				}
				suppression_boulet(deuxdice);
				deuxdice--;
				nb_boulets_a_tester--;
				//alert(resultat_collision);
			}
		}
	}
}

function test_collision_segment_vs_laser(pos_x_point_1,pos_y_point_1,pos_x_point_2,pos_y_point_2,angle_laser,larg_laser,laser_bas,laser_haut)
{
	var resultat=0;
	pos_x_point_1=pos_x_point_1-canvas.width/2;
	pos_y_point_1=pos_y_point_1-(hauteur_rect-largeur_socle/4-largeur_socle/3);
	pos_x_point_1=pos_x_point_1*Math.cos(angle_laser)+pos_y_point_1*Math.sin(angle_laser);
	pos_y_point_1=-pos_x_point_1*Math.sin(angle_laser)+pos_y_point_1*Math.cos(angle_laser);
	
	pos_x_point_2=pos_x_point_2-canvas.width/2;
	pos_y_point_2=pos_y_point_2-(hauteur_rect-largeur_socle/4-largeur_socle/3);
	pos_x_point_2=pos_x_point_2*Math.cos(angle_laser)+pos_y_point_2*Math.sin(angle_laser);
	pos_y_point_2=-pos_x_point_2*Math.sin(angle_laser)+pos_y_point_2*Math.cos(angle_laser);
	if((pos_x_point_1<=larg_laser/2)&&(pos_x_point_1>=(-larg_laser/2))&&(pos_y_point_1<=(-laser_bas))&&(pos_y_point_1>=(-laser_haut)))
	{
		resultat=1;
	}
	else if((pos_x_point_2<=larg_laser/2)&&(pos_x_point_2>=(-larg_laser/2))&&(pos_y_point_2<=(-laser_bas))&&(pos_y_point_2>=(-laser_haut)))
	{
		resultat=1;
	}
	else if((pos_x_point_2>=larg_laser/2)&&(pos_x_point_1<=(-larg_laser/2))&&(pos_y_point_1<=(-laser_bas))&&(pos_y_point_1>=(-laser_haut))&&(pos_y_point_2<=(-laser_bas))&&(pos_y_point_2>=(-laser_haut)))
	{
		resultat=1;
	}
	else if((pos_x_point_1>=larg_laser/2)&&(pos_x_point_2<=(-larg_laser/2))&&(pos_y_point_1<=(-laser_bas))&&(pos_y_point_1>=(-laser_haut))&&(pos_y_point_2<=(-laser_bas))&&(pos_y_point_2>=(-laser_haut)))
	{
		resultat=1;
	}
	return resultat;
}

function test_collision_boulet_vs_soucoupe(soucoupeX,soucoupeY,BouletX,BouletY,BouletTaille)
{
	var resultat=0;
	var dist=0;
	
	dist=((soucoupeX-BouletX)**2+((soucoupeY-taille_soucoupe/2)-BouletY)**2)**(1/2);
	if((dist<=(taille_soucoupe+BouletTaille))&&(BouletY>=(soucoupeY-BouletTaille)))
	{
		resultat=1;
	}
	dist=((soucoupeX-BouletX)**2+((soucoupeY)-BouletY)**2)**(1/2);
	if((dist<=(taille_soucoupe/3+BouletTaille))&&(BouletY<=(soucoupeY+BouletTaille)))
	{
		resultat=1;
	}
	return resultat;
}


function test_collision_boulet_vs_miss(missileX,missileY,missileType,missileAngle,BouletX,BouletY,BouletTaille)
{
	var resultat=0;
	BouletX=BouletX-missileX;
	BouletY=BouletY-missileY;
	BouletX=BouletX*Math.cos(missileAngle)+BouletY*Math.sin(missileAngle);
	BouletY=-BouletX*Math.sin(missileAngle)+BouletY*Math.cos(missileAngle);
	if((BouletX<=(largeur_corps_miss[missileType]/2+BouletTaille))&&(BouletX>=(-largeur_corps_miss[missileType]/2-BouletTaille))&&(BouletY<=(longueur_corps_miss[missileType]+BouletTaille))&&(BouletY>=-BouletTaille))
	{
		resultat=1;
	}
	return resultat;
}

function mise_a_jour_impact_miss_murs()
{
	var undice=0;
	var deuxdice=0;
	
	var taille_t_miss=0;
	var posXmiss=0;
	var posYmiss=0;
	var longueur_mur_sur_1=0;
	epaisseur_mur=hauteur_rect/(0.85*rapport_coef_murs);
	
	for(undice=(pos_x_miss.length-1);undice>=0;undice--)
	{
		for(deuxdice=(pos_x_mur.length-1);deuxdice>=0;deuxdice--)
		{
			taille_t_miss=taille_tete_miss_par_type[type_miss[undice]];
			posXmiss=pos_x_miss[undice];
			posYmiss=pos_y_miss[undice];
			longueur_mur_sur_1=coef_longueur_mur[deuxdice]*canvas.width/(rapport_coef_murs);
			pos_y_mur[deuxdice]-epaisseur_mur
			if((posXmiss>(pos_x_mur[deuxdice]-longueur_mur_sur_1/2-taille_t_miss))&&(posXmiss<(pos_x_mur[deuxdice]+longueur_mur_sur_1/2+taille_t_miss))&&(posYmiss>(pos_y_mur[deuxdice]-epaisseur_mur-taille_t_miss))&&(posYmiss<(pos_y_mur[deuxdice]+epaisseur_mur+taille_t_miss)))
			{
				/*if(type_miss[undice]==2)
				{
					creat_double_miss(pos_x_miss[undice],pos_y_miss[undice]);
				}*/
				suppression_missile(undice);
				vies_mur[deuxdice]=vies_mur[deuxdice]-1;
				if(autodefense_mur[deuxdice]>0)
				{
					autodefense_mur[deuxdice]=autodefense_mur[deuxdice]-1;
				}
				if(vies_mur[deuxdice]==0)
				{
					suppression_mur(deuxdice);
				}
			}
		}
	}
}

function mise_a_jour_miss_des_murs()
{
	var deuxdice=0;
	var temps_entre_2_tirs=[0,6,2,0.5];
	for(deuxdice=(pos_x_mur.length-1);deuxdice>=0;deuxdice--)
	{
		
		if((autodefense_mur[deuxdice]>0)&&(maintenant-dernier_tir_miss_special[deuxdice]>periode_miss_special[autodefense_mur[deuxdice]]))
		{
			indices_miss_special.push(vit_x_miss_TC.length);
			vit_x_miss_TC.push(0);
			vit_y_miss_TC.push(-vitesse_miss_special[autodefense_mur[deuxdice]]);
			pos_x_miss_TC.push(pos_x_mur[deuxdice]);
			pos_y_miss_TC.push(pos_y_mur[deuxdice]);
			dernier_tir_miss_special[deuxdice]=maintenant;
		}
		/*
		var indices_miss_special=[];
		var dernier_tir_miss_special=[];
		var periode_miss_special=[0,3,1.5,0.5];
		var AD_portee_miss_special=[1/5,1/3,1/2,3/4];
		var AD_angle_miss_special=[30,45,60,90];
		var manoeuv_miss_special=[100,150,225,360];
		var vitesse_miss_special=[0,0.3,0.6,1];
		
        var autodefense_mur=[];
        
		*/
	}
}

function mise_a_jour_impact_avec_immeuble()
{
	var undice=0;
	var deuxdice=0;
	
    var taille_t_miss=0;
	var posXmiss=0;
	var posYmiss=0;
	
	var largimm=0;
	var hautimm=0;
	var posimm=0;
	var etat_d=0;
	var etat_g=0;
	
	for(undice=(pos_x_miss.length-1);undice>=0;undice--)
	{
		//alert(pos_x_miss.length);
		//ctx.fillStyle = 'red';
		//tracerond(pos_x_miss[undice],pos_y_miss[undice],taille_tete_miss_par_type[type_miss[undice]]);
		for(deuxdice=(posi_immeubles.length-1);deuxdice>=0;deuxdice--)
		{
			taille_t_miss=taille_tete_miss_par_type[type_miss[undice]];
			posXmiss=pos_x_miss[undice];
			posYmiss=pos_y_miss[undice];
	
			largimm=largeur_immeubles[deuxdice];
			hautimm=hauteur_immeubles[deuxdice];
			posimm=posi_immeubles[deuxdice];
			
			etat_d=etat_facade_droite[deuxdice];
			etat_g=etat_facade_gauche[deuxdice];
            
			if((posXmiss>(posimm-taille_t_miss))&&(posXmiss<(posimm+largimm/2))&&(posYmiss>(hauteur_rect-hautimm-taille_t_miss))&&(posYmiss<(hauteur_rect-taille_t_miss))&&(etat_g==0))
			{
				//alert("impact gauche");
				x_bat_explose.push(posimm+largimm/4);
				y_bat_explose.push(hauteur_rect-hautimm*3/4);
				x_miss_explose.push(posXmiss);
				y_miss_explose.push(posYmiss);
				date_impact.push(maintenant);
				vit_x_miss_exlpose.push(vit_x_miss[undice]);
				vit_y_miss_explose.push(vit_y_miss[undice]);
				 ind_immeuble_explosion.push(deuxdice);
				etat_facade_gauche[deuxdice]=1;
				suppression_missile(undice);
			}
			else if((posXmiss>(posimm+largimm/2))&&(posXmiss<(posimm+largimm+taille_t_miss))&&(posYmiss>(hauteur_rect-hautimm-taille_t_miss))&&(posYmiss<(hauteur_rect-taille_t_miss))&&(etat_d==0))
			{
				//alert("impact droite");
				x_bat_explose.push(posimm+largimm*3/4);
				y_bat_explose.push(hauteur_rect-hautimm*3/4);
				x_miss_explose.push(posXmiss);
				y_miss_explose.push(posYmiss);
				date_impact.push(maintenant);
				vit_x_miss_exlpose.push(vit_x_miss[undice]);
				vit_y_miss_explose.push(vit_y_miss[undice]);
				ind_immeuble_explosion.push(deuxdice);
				etat_facade_droite[deuxdice]=1;
				suppression_missile(undice);
			}
			else if((posXmiss>(posimm-taille_t_miss))&&(posXmiss<(posimm+largimm/2))&&(posYmiss>(hauteur_rect-hautimm/2-taille_t_miss))&&(posYmiss<(hauteur_rect-taille_t_miss))&&(etat_g==1))
			{
				//alert("impact gauche");
				x_bat_explose.push(posimm+largimm/4);
				y_bat_explose.push(hauteur_rect-hautimm/4);
				x_miss_explose.push(posXmiss);
				y_miss_explose.push(posYmiss);
				date_impact.push(maintenant);
				vit_x_miss_exlpose.push(vit_x_miss[undice]);
				vit_y_miss_explose.push(vit_y_miss[undice]);
				ind_immeuble_explosion.push(deuxdice);
				etat_facade_gauche[deuxdice]=2;
				suppression_missile(undice);
			}
			else if((posXmiss>(posimm+largimm/2))&&(posXmiss<(posimm+largimm+taille_t_miss))&&(posYmiss>(hauteur_rect-hautimm/2-taille_t_miss))&&(posYmiss<(hauteur_rect-taille_t_miss))&&(etat_d==1))
			{
				//alert("impact droite");
				x_bat_explose.push(posimm+largimm*3/4);
				y_bat_explose.push(hauteur_rect-hautimm/4);
				x_miss_explose.push(posXmiss);
				y_miss_explose.push(posYmiss);
				date_impact.push(maintenant);
				vit_x_miss_exlpose.push(vit_x_miss[undice]);
				vit_y_miss_explose.push(vit_y_miss[undice]);
				ind_immeuble_explosion.push(deuxdice);
				etat_facade_droite[deuxdice]=2;
				suppression_missile(undice);
			}
			
		}
	}
}

function mise_a_jour_impact_crotte_mur()
{
	var undice=0;
	var deuxdice=0;
	var taille_t_miss=0;
	var posXmiss=0;
	var posYmiss=0;
	var longueur_mur_sur_1=0;
	epaisseur_mur=hauteur_rect/(0.85*rapport_coef_murs);
	
	for(undice=(pos_x_caca.length-1);undice>=0;undice--)
	{
		for(deuxdice=(pos_x_mur.length-1);deuxdice>=0;deuxdice--)
		{
			taille_t_miss=taille_caca;
			posXmiss=pos_x_caca[undice];
			posYmiss=pos_y_caca[undice];
			longueur_mur_sur_1=coef_longueur_mur[deuxdice]*canvas.width/(rapport_coef_murs);
			pos_y_mur[deuxdice]-epaisseur_mur
			if((posXmiss>(pos_x_mur[deuxdice]-longueur_mur_sur_1/2-taille_t_miss))&&(posXmiss<(pos_x_mur[deuxdice]+longueur_mur_sur_1/2+taille_t_miss))&&(posYmiss>(pos_y_mur[deuxdice]-epaisseur_mur-taille_t_miss))&&(posYmiss<(pos_y_mur[deuxdice]+epaisseur_mur+taille_t_miss)))
			{
				sup_caca(undice);
				vies_mur[deuxdice]=vies_mur[deuxdice]-1;
				if(vies_mur[deuxdice]==0)
				{
					suppression_mur(deuxdice);
				}
			}
		}
	}
}

function mise_a_jour_impact_crotte_immeuble()
{
	var undice=0;
	var deuxdice=0;
	
    var taille_t_miss=0;
	var posXmiss=0;
	var posYmiss=0;
	
	var largimm=0;
	var hautimm=0;
	var posimm=0;
	var etat_d=0;
	var etat_g=0;
	
	for(undice=(pos_x_caca.length-1);undice>=0;undice--)
	{
		//alert(pos_x_caca.length);
		//ctx.fillStyle = 'red';
		//tracerond(pos_x_miss[undice],pos_y_miss[undice],taille_tete_miss_par_type[type_miss[undice]]);
		for(deuxdice=(posi_immeubles.length-1);deuxdice>=0;deuxdice--)
		{
			taille_t_miss=taille_caca;
			posXmiss=pos_x_caca[undice];
			posYmiss=pos_y_caca[undice];
	
			largimm=largeur_immeubles[deuxdice];
			hautimm=hauteur_immeubles[deuxdice];
			posimm=posi_immeubles[deuxdice];
			
			etat_d=etat_facade_droite[deuxdice];
			etat_g=etat_facade_gauche[deuxdice];
            
			if((posXmiss>(posimm-taille_t_miss))&&(posXmiss<(posimm+largimm/2))&&(posYmiss>(hauteur_rect-hautimm-taille_t_miss))&&(posYmiss<(hauteur_rect-taille_t_miss))&&(etat_g==0))
			{
				//alert("impact gauche");
				x_bat_explose.push(posimm+largimm/4);
				y_bat_explose.push(hauteur_rect-hautimm*3/4);
				x_miss_explose.push(posXmiss);
				y_miss_explose.push(posYmiss);
				date_impact.push(maintenant);
				vit_x_miss_exlpose.push(vit_x_miss[undice]);
				vit_y_miss_explose.push(vit_y_miss[undice]);
				 ind_immeuble_explosion.push(deuxdice);
				etat_facade_gauche[deuxdice]=1;
				sup_caca(undice);
			}
			else if((posXmiss>(posimm+largimm/2))&&(posXmiss<(posimm+largimm+taille_t_miss))&&(posYmiss>(hauteur_rect-hautimm-taille_t_miss))&&(posYmiss<(hauteur_rect-taille_t_miss))&&(etat_d==0))
			{
				//alert("impact droite");
				x_bat_explose.push(posimm+largimm*3/4);
				y_bat_explose.push(hauteur_rect-hautimm*3/4);
				x_miss_explose.push(posXmiss);
				y_miss_explose.push(posYmiss);
				date_impact.push(maintenant);
				vit_x_miss_exlpose.push(vit_x_miss[undice]);
				vit_y_miss_explose.push(vit_y_miss[undice]);
				ind_immeuble_explosion.push(deuxdice);
				etat_facade_droite[deuxdice]=1;
				sup_caca(undice);
			}
			else if((posXmiss>(posimm-taille_t_miss))&&(posXmiss<(posimm+largimm/2))&&(posYmiss>(hauteur_rect-hautimm/2-taille_t_miss))&&(posYmiss<(hauteur_rect-taille_t_miss))&&(etat_g==1))
			{
				//alert("impact gauche");
				x_bat_explose.push(posimm+largimm/4);
				y_bat_explose.push(hauteur_rect-hautimm/4);
				x_miss_explose.push(posXmiss);
				y_miss_explose.push(posYmiss);
				date_impact.push(maintenant);
				vit_x_miss_exlpose.push(vit_x_miss[undice]);
				vit_y_miss_explose.push(vit_y_miss[undice]);
				ind_immeuble_explosion.push(deuxdice);
				etat_facade_gauche[deuxdice]=2;
				sup_caca(undice);
			}
			else if((posXmiss>(posimm+largimm/2))&&(posXmiss<(posimm+largimm+taille_t_miss))&&(posYmiss>(hauteur_rect-hautimm/2-taille_t_miss))&&(posYmiss<(hauteur_rect-taille_t_miss))&&(etat_d==1))
			{
				//alert("impact droite");
				x_bat_explose.push(posimm+largimm*3/4);
				y_bat_explose.push(hauteur_rect-hautimm/4);
				x_miss_explose.push(posXmiss);
				y_miss_explose.push(posYmiss);
				date_impact.push(maintenant);
				vit_x_miss_exlpose.push(vit_x_miss[undice]);
				vit_y_miss_explose.push(vit_y_miss[undice]);
				ind_immeuble_explosion.push(deuxdice);
				etat_facade_droite[deuxdice]=2;
				sup_caca(undice);
			}
			
		}
	}
}

function suppression_boulet(ind_a_suppr)
{
	vit_x_boulet.splice(ind_a_suppr,1);
	vit_y_boulet.splice(ind_a_suppr,1);
	pos_x_boulet.splice(ind_a_suppr,1);
	pos_y_boulet.splice(ind_a_suppr,1);
}

function sup_caca(ind_a_suppr)
{
	pos_x_caca.splice(ind_a_suppr,1);
	pos_y_caca.splice(ind_a_suppr,1);
	vit_caca.splice(ind_a_suppr,1);
	instant_caca_par_terre.splice(ind_a_suppr,1);
}

function suppression_miss_TC(ind_a_suppr)
{
	var v2d0x=0;
	if(indices_miss_special.indexOf(ind_a_suppr)>=0)
	{
		indices_miss_special.splice(indices_miss_special.indexOf(ind_a_suppr),1);
	}
	for(v2d0x=0;v2d0x<indices_miss_special.length;v2d0x++)
	{
		if(indices_miss_special[v2d0x]>ind_a_suppr)
		{
			indices_miss_special[v2d0x]=indices_miss_special[v2d0x]-1;
		}
	}
	
	vit_x_miss_TC.splice(ind_a_suppr,1);
	vit_y_miss_TC.splice(ind_a_suppr,1);
	pos_x_miss_TC.splice(ind_a_suppr,1);
	//alert(pos_y_miss_TC.length);
	pos_y_miss_TC.splice(ind_a_suppr,1);
	//alert(pos_y_miss_TC.length);
	//alert(1);
}

function suppression_soucoupe(ind_a_suppr)
{
	pos_x_soucoupe.splice(ind_a_suppr,1);
	pos_y_soucoupe.splice(ind_a_suppr,1);
	vit_soucoupe.splice(ind_a_suppr,1);
	points_vie_soucoupe.splice(ind_a_suppr,1);
	instant_dernier_impact_soucoupe.splice(ind_a_suppr,1);
	soucoupe_inv.splice(ind_a_suppr,1);
	x_objectif_soucoupe.splice(ind_a_suppr,1);
	instant_dernier_arret_soucoupe.splice(ind_a_suppr,1);
	a_fait_caca.splice(ind_a_suppr,1);
}

function suppression_mur(ind_a_suppr)
{
	type_mur.splice(ind_a_suppr,1);
	vies_mur.splice(ind_a_suppr,1);
    coef_longueur_mur.splice(ind_a_suppr,1);
    autodefense_mur.splice(ind_a_suppr,1);
    pos_x_mur.splice(ind_a_suppr,1);
	pos_y_mur.splice(ind_a_suppr,1);
	dernier_tir_miss_special.splice(ind_a_suppr,1);
}

function suppression_missile(ind_a_suppr)
{
	vit_y_miss.splice(ind_a_suppr,1);
	vit_x_miss.splice(ind_a_suppr,1);
    pos_x_miss.splice(ind_a_suppr,1);
    pos_y_miss.splice(ind_a_suppr,1);
    type_miss.splice(ind_a_suppr,1);
	etat_propu.splice(ind_a_suppr,1);
	angle_miss.splice(ind_a_suppr,1);
}

function traces_miss_TC()
{
	var deux_dice=0;
	var nombre_puins = pos_x_miss_TC.length;
	if (nombre_puins>=1)
	{
		//alert(nombre_puins);
		for (deux_dice=0;deux_dice<nombre_puins;deux_dice++)
		{
			if(indices_miss_special.indexOf(deux_dice)<0)
			{
				trace_1_miss_TC(pos_x_miss_TC[deux_dice],pos_y_miss_TC[deux_dice],calcul_angle_miss(vit_x_miss_TC[deux_dice],vit_y_miss_TC[deux_dice]),Math.random()*3);
			}
			else
			{
				trace_1_miss_special(pos_x_miss_TC[deux_dice],pos_y_miss_TC[deux_dice],calcul_angle_miss(vit_x_miss_TC[deux_dice],vit_y_miss_TC[deux_dice]),Math.random()*3);
			}
		    //ctx.fillStyle = 'red';
			//tracerond(pos_x_miss_TC[deux_dice],pos_y_miss_TC[deux_dice],taille_miss_TC);
			//alert(taille_tete_miss_par_type[type_miss[deux_dice]]);
	    }
	}
}

function traces_boulets()
{
	var deux_dice=0;
	var nombre_puins = pos_x_boulet.length;
	if (nombre_puins>=1)
	{
		//alert(nombre_puins);
		for (deux_dice=0;deux_dice<nombre_puins;deux_dice++)
		{
		    ctx.fillStyle = 'black';
			tracerond(pos_x_boulet[deux_dice],pos_y_boulet[deux_dice],taille_boulet);
			//alert(taille_tete_miss_par_type[type_miss[deux_dice]]);
	    }
	}
}

function trace_missiles(){
	var deux_dice=0;
	var nombre_puins = pos_x_miss.length;
	if (nombre_puins>=1)
	{
		for (deux_dice=0;deux_dice<nombre_puins;deux_dice++)
		{
			if(type_miss[deux_dice]==0)
			{
			    trace_1_miss_type_0(pos_x_miss[deux_dice],pos_y_miss[deux_dice],angle_miss[deux_dice],etat_propu[deux_dice]);
			}
			else if(type_miss[deux_dice]==1)
			{
			    trace_1_miss_type_1(pos_x_miss[deux_dice],pos_y_miss[deux_dice],angle_miss[deux_dice],etat_propu[deux_dice]);
			}
			else if(type_miss[deux_dice]==2)
			{
			    trace_1_miss_type_2(pos_x_miss[deux_dice],pos_y_miss[deux_dice],angle_miss[deux_dice],etat_propu[deux_dice]);
			}
			
			
			//alert(taille_tete_miss_par_type[type_miss[deux_dice]]);
	    }
	}
}

function trace_1_miss_special(pos_mX,pos_mY,Anguele,flamme)
{
	//alert(canvas.widt);
	var taille_mis=facteur_taille*2/3;
	var X_cent_cercle=20*taille_mis;
	var Y_cent_cercle=5*taille_mis;
	var diam_cercle=40*taille_mis;
	var long_p_cent=145*taille_mis;
	var long_par=50*taille_mis;
	var larg_mis_sur_2=Math.cos(Math.asin(Y_cent_cercle/diam_cercle))*diam_cercle-X_cent_cercle;
	var larg_wg=25*taille_mis;
	var long_wg=70*taille_mis;
	var ang_wg=40*Math.PI/180;
	
	ctx.translate(pos_mX,pos_mY);
	ctx.rotate(Anguele);
	//alert(flamme);
	if (Math.floor(flamme)==0)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(larg_mis_sur_2/4, long_p_cent+2.8*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
		//alert(0);
	}
	else if(Math.floor(flamme)==1)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+3.1*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
		//alert(1);
	}
	else if(Math.floor(flamme)==2)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2*1.3, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+2.3*long_par);
		ctx.lineTo(-larg_mis_sur_2*1.2, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+1.5*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
		//alert(2);
	}
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.fillStyle = 'yellow';
	ctx.fill();
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.fillStyle = 'blue';
	ctx.fill();
	
	ctx.beginPath();
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	ctx.closePath();
	ctx.fillStyle = 'yellow';
	ctx.fill();
	
	
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.strokeStyle = 'black';
	ctx.stroke();
	
	ctx.rotate(-Anguele);
	ctx.translate(-pos_mX,-pos_mY);
}

function trace_1_miss_TC(pos_mX,pos_mY,Anguele,flamme)
{
	//alert(canvas.widt);
	var taille_mis=facteur_taille*2/3;
	var X_cent_cercle=20*taille_mis;
	var Y_cent_cercle=5*taille_mis;
	var diam_cercle=40*taille_mis;
	var long_p_cent=145*taille_mis;
	var long_par=50*taille_mis;
	var larg_mis_sur_2=Math.cos(Math.asin(Y_cent_cercle/diam_cercle))*diam_cercle-X_cent_cercle;
	var larg_wg=25*taille_mis;
	var long_wg=70*taille_mis;
	var ang_wg=40*Math.PI/180;
	
	ctx.translate(pos_mX,pos_mY);
	ctx.rotate(Anguele);
	//alert(flamme);
	if (Math.floor(flamme)==0)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(larg_mis_sur_2/4, long_p_cent+2.8*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
		//alert(0);
	}
	else if(Math.floor(flamme)==1)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+3.1*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
		//alert(1);
	}
	else if(Math.floor(flamme)==2)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2*1.3, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+2.3*long_par);
		ctx.lineTo(-larg_mis_sur_2*1.2, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+1.5*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
		//alert(2);
	}
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.fillStyle = 'white';
	ctx.fill();
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.fillStyle = 'blue';
	ctx.fill();
	
	ctx.beginPath();
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	ctx.closePath();
	ctx.fillStyle = 'red';
	ctx.fill();
	
	
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.strokeStyle = 'black';
	ctx.stroke();
	
	ctx.rotate(-Anguele);
	ctx.translate(-pos_mX,-pos_mY);
}

function trace_cacas()
{
	taille_caca=taille_soucoupe/11;
	var taille_caca_par_terre=taille_caca;
	var angle=0;
	//alert(0);
	for(idex=0;idex<pos_x_caca.length;idex++)
	{
		//alert(0);
		ctx.fillStyle = 'brown';
		ctx.strokeStyle = 'black';
		if(vit_caca[idex]==0)
		{
			
			ctx.beginPath();
			ctx.lineTo(pos_x_caca[idex]-taille_caca_par_terre/2,hauteur_rect-taille_caca_par_terre*5.5);
			ctx.lineTo(pos_x_caca[idex]-taille_caca_par_terre*1.3,hauteur_rect-taille_caca_par_terre*3.5);
			ctx.lineTo(pos_x_caca[idex]+taille_caca_par_terre*0.5,hauteur_rect-taille_caca_par_terre*4.5);
			ctx.closePath();
			ctx.fill();
			ctx.stroke();
			
			ctx.beginPath();
			ctx.arc(pos_x_caca[idex]-taille_caca_par_terre*2.5, hauteur_rect-taille_caca_par_terre/2, taille_caca_par_terre/2, Math.PI/2, -Math.PI/2, false);
			ctx.arc(pos_x_caca[idex]+taille_caca_par_terre*2.5, hauteur_rect-taille_caca_par_terre/2, taille_caca_par_terre/2, -Math.PI/2, Math.PI/2, false);
			ctx.closePath();
			ctx.fill();
			ctx.stroke();
			
			angle=Math.PI/8;
			
			ctx.beginPath();
			ctx.arc(pos_x_caca[idex]-taille_caca_par_terre*2.5, hauteur_rect-taille_caca_par_terre/2, taille_caca_par_terre/2, Math.PI/2-angle, -Math.PI/2-angle, false);
			ctx.arc(pos_x_caca[idex]+taille_caca_par_terre*2, hauteur_rect-taille_caca_par_terre*(1+1/2), taille_caca_par_terre/2, -Math.PI/2-angle, Math.PI/2-angle, false);
			ctx.closePath();
			ctx.fill();
			ctx.stroke();
			
			angle=Math.PI/7;
			
			ctx.beginPath();
			ctx.arc(pos_x_caca[idex]-taille_caca_par_terre*2, hauteur_rect-taille_caca_par_terre*(1.1+1/2), taille_caca_par_terre/2, Math.PI/2-angle, -Math.PI/2-angle, false);
			ctx.arc(pos_x_caca[idex]+taille_caca_par_terre*1.5, hauteur_rect-taille_caca_par_terre*(1.9+1/2), taille_caca_par_terre/2, -Math.PI/2-angle, Math.PI/2-angle, false);
			ctx.closePath();
			ctx.fill();
			ctx.stroke();
			
			angle=Math.PI/6;
			
			ctx.beginPath();
			ctx.arc(pos_x_caca[idex]-taille_caca_par_terre*1.5, hauteur_rect-taille_caca_par_terre*(2.1+1/2), taille_caca_par_terre/2, Math.PI/2-angle, -Math.PI/2-angle, false);
			ctx.arc(pos_x_caca[idex]+taille_caca_par_terre*1, hauteur_rect-taille_caca_par_terre*(2.8+1/2), taille_caca_par_terre/2, -Math.PI/2-angle, Math.PI/2-angle, false);
			ctx.closePath();
			ctx.fill();
			ctx.stroke();
			
			angle=Math.PI/4;
			
			ctx.beginPath();
			ctx.arc(pos_x_caca[idex]-taille_caca_par_terre*1, hauteur_rect-taille_caca_par_terre*(3.2+1/2), taille_caca_par_terre/2, Math.PI/2-angle, -Math.PI/2-angle, false);
			ctx.arc(pos_x_caca[idex]+taille_caca_par_terre*0.5, hauteur_rect-taille_caca_par_terre*(3.6+1/2), taille_caca_par_terre/2, -Math.PI/2-angle, Math.PI/2-angle, false);
			ctx.closePath();
			ctx.fill();
			ctx.stroke();
			
			ctx.fillStyle = 'white';
			ctx.beginPath();
			ctx.arc(pos_x_caca[idex]-taille_caca_par_terre*0.85, hauteur_rect-taille_caca_par_terre*2.5, taille_caca_par_terre*0.75, Math.PI, -Math.PI, false);
			ctx.fill();
			ctx.beginPath();
			ctx.arc(pos_x_caca[idex]+taille_caca_par_terre*0.85, hauteur_rect-taille_caca_par_terre*2.5, taille_caca_par_terre*0.75, Math.PI, -Math.PI, false);
			ctx.fill();
			
			ctx.fillStyle = 'black';
			ctx.beginPath();
			ctx.arc(pos_x_caca[idex]-taille_caca_par_terre*0.85, hauteur_rect-taille_caca_par_terre*2.5, taille_caca_par_terre*0.38, Math.PI, -Math.PI, false);
			ctx.fill();
			ctx.beginPath();
			ctx.arc(pos_x_caca[idex]+taille_caca_par_terre*0.85, hauteur_rect-taille_caca_par_terre*2.5, taille_caca_par_terre*0.38, Math.PI, -Math.PI, false);
			ctx.fill();
			
			ctx.beginPath();
			ctx.arc(pos_x_caca[idex], hauteur_rect-taille_caca_par_terre*2.9, taille_caca_par_terre*2, Math.PI/2-Math.PI/4, Math.PI/2+Math.PI/4, false);
			ctx.arc(pos_x_caca[idex], hauteur_rect-taille_caca_par_terre*2.3, taille_caca_par_terre*2, Math.PI/2+Math.PI/4, Math.PI/2-Math.PI/4, true);
			ctx.fill();
			
			ctx.fillStyle = 'white';
			ctx.beginPath();
			ctx.arc(pos_x_caca[idex], hauteur_rect-taille_caca_par_terre*2.9, taille_caca_par_terre*2, Math.PI/2-Math.PI/4, Math.PI/2+Math.PI/4, false);
			ctx.fill();
			
		}
		else
		{
			if(pos_y_caca[idex]+taille_soucoupe/6<=hauteur_rect)
			{
				ctx.beginPath();
				ctx.arc(pos_x_caca[idex], pos_y_caca[idex]-vit_caca[idex]*taille_caca*4, taille_caca*0.8, -Math.PI, 0, true);
				ctx.arc(pos_x_caca[idex], pos_y_caca[idex]-taille_caca*2-vit_caca[idex]*taille_caca*4, taille_caca*0.5, 0, -Math.PI, true);
				ctx.closePath();
				ctx.fill();
				
				ctx.beginPath();
				ctx.arc(pos_x_caca[idex], pos_y_caca[idex]+taille_soucoupe/6, taille_caca, -Math.PI, 0, true);
				ctx.lineTo(pos_x_caca[idex]+taille_caca,pos_y_caca[idex]+taille_soucoupe/10);
				ctx.lineTo(pos_x_caca[idex],pos_y_caca[idex]-taille_caca*2);
				ctx.lineTo(pos_x_caca[idex]-taille_caca,pos_y_caca[idex]+taille_soucoupe/10);
				ctx.closePath();
				ctx.fill();
				/*
				taille_tete_miss_par_type=[0,0,0,0];
				largeur_corps_miss=[0,0,0,0];
				longueur_corps_miss=[0,0,0,0];
				*/
				ctx.strokeStyle = 'red';
				ctx.beginPath();
				ctx.rect(pos_x_caca[idex]-largeur_corps_miss[3]/2,pos_y_caca[idex]-longueur_corps_miss[3],largeur_corps_miss[3],longueur_corps_miss[3]);
				ctx.closePath();
				ctx.stroke();
			}
			else
			{
				ctx.beginPath();
				ctx.lineTo(pos_x_caca[idex]-taille_caca*2,hauteur_rect);
				ctx.lineTo(pos_x_caca[idex]+taille_caca*2,hauteur_rect);
				ctx.lineTo(pos_x_caca[idex]+taille_caca*2,hauteur_rect-taille_caca);
				ctx.lineTo(pos_x_caca[idex]-taille_caca*2,hauteur_rect-taille_caca);
				ctx.fill();
				ctx.stroke();
				
				ctx.beginPath();
				ctx.arc(pos_x_caca[idex], pos_y_caca[idex]-vit_caca[idex]*taille_caca*4, taille_caca*0.8, -Math.PI, 0, true);
				ctx.arc(pos_x_caca[idex], pos_y_caca[idex]-taille_caca*2-vit_caca[idex]*taille_caca*4, taille_caca*0.5, 0, -Math.PI, true);
				ctx.closePath();
				ctx.fill();
				
			}
		}
	}
}

function trace_soucoupes()
{
	//variables locales
	var idex=0;
	var ceoi=0;
	var couleur_extrat=0;
	var couleur_extrat='#000';
	var delta_x_extrat=0;
	var delta_y_extrat=0;
	var angle_trape=0;
	
	/*
	vit_soucoupe=[];
var points_vie_soucoupe=[];
var instant_dernier_impact_soucoupe=[];
var soucoupe_inv=[];
var x_objectif_soucoupe=[];
var instant_dernier_arret_soucoupe=[];
var duree_caca=1.5;*/
	
	for(idex=0;idex<pos_x_soucoupe.length;idex++)
	{
		delta_x_extrat=0;
		delta_y_extrat=0;
		angle_trape=0;
		if(soucoupe_inv[idex]==1)
		{
			ceoi=0.5;
		}
		else
		{
			ceoi=1;
		}
		ctx.globalAlpha=ceoi;
		
		if(vit_soucoupe[idex]==0)
		{
			if(maintenant-instant_dernier_arret_soucoupe[idex]<duree_caca/2)
			{
				couleur_extrat='#'+(15*(maintenant-instant_dernier_arret_soucoupe[idex])/(duree_caca/2)/15*0xF<<0).toString(16)+((1-(maintenant-instant_dernier_arret_soucoupe[idex])/(duree_caca/2))*10/15*0xF<<0).toString(16)+(0*0xF<<0).toString(16);
			}
			else
			{
				couleur_extrat='#f00';
				delta_x_extrat=(Math.random()-0.5)*taille_soucoupe/15;
				delta_y_extrat=(Math.random()-0.5)*taille_soucoupe/15;
			}
			angle_trape=Math.PI/5;
			if(maintenant-instant_dernier_arret_soucoupe[idex]<duree_caca/10)
			{
				angle_trape=angle_trape*(maintenant-instant_dernier_arret_soucoupe[idex])*10/duree_caca;
			}
			else if(maintenant-instant_dernier_arret_soucoupe[idex]>duree_caca*9/10)
			{
				angle_trape=angle_trape*(1-((maintenant-instant_dernier_arret_soucoupe[idex])-9*duree_caca/10)*10/duree_caca);
			}
		}
		else
		{
			couleur_extrat='#0a0';
		}
		
		ctx.fillStyle = couleur_extrat;
		ctx.strokeStyle = couleur_extrat;
		ctx.beginPath();
		ctx.arc(pos_x_soucoupe[idex]+delta_x_extrat, pos_y_soucoupe[idex]+delta_y_extrat, taille_soucoupe/7, -Math.PI, Math.PI, true);
		//ctx.lineTo(pos_x_soucoupe[idex], pos_y_soucoupe[idex]);
		ctx.fill();
		
		ctx.beginPath();
		ctx.arc(pos_x_soucoupe[idex]+delta_x_extrat-taille_soucoupe/7, pos_y_soucoupe[idex]+delta_y_extrat-taille_soucoupe/6, taille_soucoupe/25, 0, Math.PI*2, true);
		ctx.fill();
		
		ctx.beginPath();
		ctx.arc(pos_x_soucoupe[idex]+delta_x_extrat+taille_soucoupe/7, pos_y_soucoupe[idex]+delta_y_extrat-taille_soucoupe/6, taille_soucoupe/25, 0, Math.PI*2, true);
		ctx.fill();
		
		ctx.beginPath();
		ctx.lineTo(pos_x_soucoupe[idex]+delta_x_extrat-taille_soucoupe/7, pos_y_soucoupe[idex]+delta_y_extrat-taille_soucoupe/6);
		ctx.lineTo(pos_x_soucoupe[idex]+delta_x_extrat, pos_y_soucoupe[idex]+delta_y_extrat);
		ctx.stroke();
		
		ctx.beginPath();
		ctx.lineTo(pos_x_soucoupe[idex]+delta_x_extrat+taille_soucoupe/7, pos_y_soucoupe[idex]+delta_y_extrat-taille_soucoupe/6);
		ctx.lineTo(pos_x_soucoupe[idex]+delta_x_extrat, pos_y_soucoupe[idex]+delta_y_extrat);
		ctx.stroke();
		
		ctx.strokeStyle = 'blue';
		ctx.fillStyle = 'blue';
		ctx.beginPath();
		ctx.arc(pos_x_soucoupe[idex], pos_y_soucoupe[idex], taille_soucoupe/3, 0, Math.PI, true);
		ctx.globalAlpha=0.2*ceoi;
		ctx.fill();
		ctx.globalAlpha=ceoi;
		ctx.stroke();
		
		
		ctx.strokeStyle = 'black';
		ctx.fillStyle = 'grey';
		ctx.beginPath();
		ctx.lineTo(pos_x_soucoupe[idex]+taille_soucoupe/3,pos_y_soucoupe[idex]);
		ctx.arc(pos_x_soucoupe[idex], pos_y_soucoupe[idex]-taille_soucoupe/2, taille_soucoupe, Math.PI/5, Math.PI*4/5, false);
		ctx.lineTo(pos_x_soucoupe[idex]-taille_soucoupe/3,pos_y_soucoupe[idex]);
		ctx.closePath();
		ctx.fill();
		ctx.stroke();
		
		ctx.fillStyle = 'black';
		ctx.beginPath();
		//ctx.lineTo(pos_x_soucoupe[idex]+taille_soucoupe/3,pos_y_soucoupe[idex]);
		ctx.arc(pos_x_soucoupe[idex], pos_y_soucoupe[idex]-taille_soucoupe/2, taille_soucoupe, Math.PI/2-angle_trape/2, Math.PI/2+angle_trape/2, false);
		ctx.arc(pos_x_soucoupe[idex], pos_y_soucoupe[idex]-taille_soucoupe/2, taille_soucoupe*3/4, Math.PI/2+angle_trape/2, Math.PI/2-angle_trape/2, true);
		//ctx.lineTo(pos_x_soucoupe[idex]-taille_soucoupe/3,pos_y_soucoupe[idex]);
		ctx.closePath();
		ctx.fill();
		
		ctx.globalAlpha=1;
	}
}


function trace_1_miss_type_0(pos_mX,pos_mY,Anguele,flamme)
{
	//alert(canvas.widt);
	var taille_mis=facteur_taille*2/3;
	var X_cent_cercle=20*taille_mis;
	var Y_cent_cercle=5*taille_mis;
	var diam_cercle=40*taille_mis;
	var long_p_cent=145*taille_mis;
	var long_par=50*taille_mis;
	var larg_mis_sur_2=Math.cos(Math.asin(Y_cent_cercle/diam_cercle))*diam_cercle-X_cent_cercle;
	var larg_wg=50*taille_mis;
	var long_wg=25*taille_mis;
	var ang_wg=0*Math.PI/180;
	
	ctx.translate(pos_mX,pos_mY);
	ctx.rotate(Anguele);
	//alert(flamme);
	if (Math.floor(flamme)==0)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(larg_mis_sur_2/4, long_p_cent+2.8*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	else if(Math.floor(flamme)==1)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+3.1*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	else if(Math.floor(flamme)==2)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2*1.3, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+2.3*long_par);
		ctx.lineTo(-larg_mis_sur_2*1.2, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+1.5*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.strokeStyle = 'black';
	ctx.fillStyle = 'grey';
	ctx.fill();
	ctx.stroke();
	
	
	
	/*ctx.strokeStyle = 'red';
	//alert(longueur_corps_miss);
	//longueur_corps_miss
	ctx.beginPath();
	ctx.lineTo(-largeur_corps_miss[0]/2,0);
	ctx.lineTo(largeur_corps_miss[0]/2,0);
	ctx.lineTo(largeur_corps_miss[0]/2,longueur_corps_miss[0]);
	ctx.lineTo(-largeur_corps_miss[0]/2,longueur_corps_miss[0]);
	ctx.closePath();
	//alert(0);
    ctx.stroke();*/
	
	
	ctx.rotate(-Anguele);
	ctx.translate(-pos_mX,-pos_mY);
	
	
	
}

function trace_1_miss_type_1(pos_mX,pos_mY,Anguele,flamme)
{
	//alert(canvas.widt);
	var taille_mis=facteur_taille*1/2;
	var X_cent_cercle=20*taille_mis;
	var Y_cent_cercle=5*taille_mis;
	var diam_cercle=40*taille_mis;
	var long_p_cent=145*taille_mis;
	var long_par=50*taille_mis;
	var larg_mis_sur_2=Math.cos(Math.asin(Y_cent_cercle/diam_cercle))*diam_cercle-X_cent_cercle;
	var larg_wg=50*taille_mis;
	var long_wg=25*taille_mis;
	var ang_wg=0*Math.PI/180;
	
	ctx.translate(pos_mX,pos_mY);
	ctx.rotate(Anguele);
	//alert(flamme);
	if (Math.floor(flamme)==0)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(larg_mis_sur_2/4, long_p_cent+2.8*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	else if(Math.floor(flamme)==1)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+3.1*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	else if(Math.floor(flamme)==2)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2*1.3, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+2.3*long_par);
		ctx.lineTo(-larg_mis_sur_2*1.2, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+1.5*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.strokeStyle = 'black';
	ctx.fillStyle = 'green';
	ctx.fill();
	ctx.stroke();
	
	
	
	/*ctx.strokeStyle = 'blue';
	//alert(longueur_corps_miss);
	//longueur_corps_miss
	ctx.beginPath();
	ctx.lineTo(-largeur_corps_miss[1]/2,0);
	ctx.lineTo(largeur_corps_miss[1]/2,0);
	ctx.lineTo(largeur_corps_miss[1]/2,longueur_corps_miss[1]);
	ctx.lineTo(-largeur_corps_miss[1]/2,longueur_corps_miss[1]);
	ctx.closePath();
	//alert(0);
    ctx.stroke();*/
	
	
	ctx.rotate(-Anguele);
	ctx.translate(-pos_mX,-pos_mY);
	
	
	
}


function trace_1_miss_type_2(pos_mX,pos_mY,Anguele,flamme)
{
	//alert(canvas.widt);
	var taille_mis=facteur_taille*2/3;
	var X_cent_cercle=20*taille_mis;
	var Y_cent_cercle=30*taille_mis;
	var diam_cercle=80*taille_mis;
	var long_p_cent=145*taille_mis;
	var long_par=50*taille_mis;
	var larg_mis_sur_2=Math.cos(Math.asin(Y_cent_cercle/diam_cercle))*diam_cercle-X_cent_cercle;
	var larg_wg=50*taille_mis;
	var long_wg=25*taille_mis;
	var ang_wg=0*Math.PI/180;
	
	ctx.translate(pos_mX,pos_mY);
	ctx.rotate(Anguele);
	//alert(flamme);
	if (Math.floor(flamme)==0)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(larg_mis_sur_2/4, long_p_cent+2.8*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	else if(Math.floor(flamme)==1)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+3.1*long_par);
		ctx.lineTo(-larg_mis_sur_2, long_p_cent+1.8*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+2*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	else if(Math.floor(flamme)==2)
	{
		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(larg_mis_sur_2*1.3, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/4, long_p_cent+2.3*long_par);
		ctx.lineTo(-larg_mis_sur_2*1.2, long_p_cent+1.4*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'red';
		ctx.fillStyle = 'orange';
		ctx.fill();
		ctx.stroke();

		ctx.beginPath();
		ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.lineTo(0, long_p_cent+1.5*long_par);
		ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
		ctx.closePath();
		ctx.strokeStyle = 'yellow';
		ctx.fillStyle = 'yellow';
		ctx.fill();
		ctx.stroke();
	}
	
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.strokeStyle = 'black';
	ctx.fillStyle = 'red';
	ctx.fill();
	ctx.stroke();
	
	
	
	/*ctx.strokeStyle = 'green';
	//alert(longueur_corps_miss);
	//longueur_corps_miss
	ctx.beginPath();
	ctx.lineTo(-largeur_corps_miss[2]/2,0);
	ctx.lineTo(largeur_corps_miss[2]/2,0);
	ctx.lineTo(largeur_corps_miss[2]/2,longueur_corps_miss[2]);
	ctx.lineTo(-largeur_corps_miss[2]/2,longueur_corps_miss[2]);
	ctx.closePath();
	//alert(0);
    ctx.stroke();*/
	
	
	ctx.rotate(-Anguele);
	ctx.translate(-pos_mX,-pos_mY);
	
	
	
}

function down_mouse(e) {    
	var x_clic = e.offsetX;
	var y_clic = e.offsetY;
	var nb_poioints=tab_x.length;
	if(y_clic>=hauteur_rect)
	{
		tir_mis=1;
		date_tir=Date.now()/1000;
	}
	else if((tir_mis==0)&&((x_clic!=0)||(y_clic!=0)))
	{
		nb_ronds=1;
		xrond[0]=x_clic;
		yrond[0]=y_clic;
		clic_en_cours=1;
		tab_x.push(xrond[0]);
		tab_y.push(yrond[0]);
		if(nb_poioints>0)
		{
			temps_point_passage.push(temps_point_passage[nb_poioints-1]+Math.pow(Math.pow(tab_x[nb_poioints]-tab_x[nb_poioints-1],2)+Math.pow(tab_y[nb_poioints]-tab_y[nb_poioints-1],2),1/2)/vit_pix_par_sec);
		}
	}
}	

function move_mouse(e) {    
	var x_clic = e.offsetX;
	var y_clic = e.offsetY;
	var nb_poioints=tab_x.length;
	if(clic_en_cours==1&&(tir_mis==0)&&((x_clic!=0)||(y_clic!=0)))
	{
		nb_ronds=1;
		xrond[0]=x_clic;
		yrond[0]=y_clic;
		tab_x.push(xrond[0]);
		tab_y.push(yrond[0]);
		if(nb_poioints>0)
		{
			temps_point_passage.push(temps_point_passage[nb_poioints-1]+Math.pow(Math.pow(tab_x[nb_poioints]-tab_x[nb_poioints-1],2)+Math.pow(tab_y[nb_poioints]-tab_y[nb_poioints-1],2),1/2)/vit_pix_par_sec);
		}
	}
}	

function up_mouse(e) {    
	var x_clic = e.offsetX;
	var y_clic = e.offsetY;
	var nb_poioints=tab_x.length;
	if((tir_mis==0)&&((x_clic!=0)||(y_clic!=0)))
	{
		nb_ronds=1;
		xrond[0]=x_clic;
		yrond[0]=y_clic;
		tab_x.push(xrond[0]);
		tab_y.push(yrond[0]);
		if(nb_poioints>0)
		{
			temps_point_passage.push(temps_point_passage[nb_poioints-1]+Math.pow(Math.pow(tab_x[nb_poioints]-tab_x[nb_poioints-1],2)+Math.pow(tab_y[nb_poioints]-tab_y[nb_poioints-1],2),1/2)/vit_pix_par_sec);
		}
		clic_en_cours=0;
	}
}

function down_touch(e) {    
	e.preventDefault();
	var touches = e.changedTouches;
	var nb_poioints=tab_x.length;
	var i=0;
	var ligne=0;
	var colone=0;
	var bouton=0;
	var cheatcode='jeilhddsu';
	xrond=[];
	yrond=[];
	nb_ronds=touches.length;
	if(etat==4)
	{
		if(fin_de_partie==0)
		{
			if((touches[0].pageY>=hauteur_rect)&&(etat_pause==0))
			{
				//mise a jour arme
				//date_tir=Date.now()/1000;
				if((touches[0].pageX>=0)&&(touches[0].pageX<=canvas.width/4)&&(niv_max_arme>=0))
				{
					selection_arme=0;
				}
				else if((touches[0].pageX>=canvas.width/4)&&(touches[0].pageX<=canvas.width/2)&&(niv_max_arme>=1))
				{
					selection_arme=1;
				}
				else if((touches[0].pageX>=canvas.width/2)&&(touches[0].pageX<=canvas.width*3/4)&&(niv_max_arme>=2))
				{
					selection_arme=2;
				}
				else if((touches[0].pageX>=canvas.width*3/4)&&(touches[0].pageX<=canvas.width)&&(niv_max_arme>=3))
				{
					selection_arme=3;
				}
				//alert(selection_arme);
			}
			else if((touches[0].pageX>canvas.width*11/12)&&(touches[0].pageY<canvas.height/20))
			{
				etat_pause=(etat_pause+1)%2;
			}
			else if(((touches[0].pageX!=0)||(touches[0].pageY!=0))&&(etat_pause==0))
			{
				for (i=0; i<nb_ronds; i++) {
					//ongoingTouches.push(touches[i]);
					xrond[i]=touches[i].pageX;
					yrond[i]=touches[i].pageY;
				}
				clic_en_cours=1;
		        angle_canon=calcul_angle_miss(xrond[0]-canvas.width/2,yrond[0]-(hauteur_rect-largeur_socle/4-largeur_socle/3));
		        tab_x.push(xrond[0]);
				tab_y.push(yrond[0]);
				if(nb_poioints>0)
				{
					temps_point_passage.push(temps_point_passage[nb_poioints-1]+Math.pow(Math.pow(tab_x[nb_poioints]-tab_x[nb_poioints-1],2)+Math.pow(tab_y[nb_poioints]-tab_y[nb_poioints-1],2),1/2)/vit_pix_par_sec);
				}
			}
		}
		else
		{
			etat=2;
			first_draw=1;
		}
	}
	else if(etat==5)
	{
		etat=3;
		first_draw=1;
	}
	else if((etat==1))
	{
		etat=2;
		first_draw=1;
	}
	else if(etat==3)
	{
		if((touches[0].pageX>x_bouton_back)&&(touches[0].pageY>y_bouton_back)&&(touches[0].pageX<x_bouton_back+largeur_case_niveau)&&(touches[0].pageY<y_bouton_back+hauteur_3_boutons))
		{
			etat=2;
			first_draw=1;
		}
		else
		{
			upgrade_test(touches[0].pageX,touches[0].pageY);
		}
	}
	else if(etat==2)
	{
		for(i=0;i<x_case_niveau.length;i++)
		{
			//alert(0);
			if((touches[0].pageX>x_case_niveau[i])&&(touches[0].pageX<(x_case_niveau[i]+largeur_case_niveau))&&(touches[0].pageY>y_case_niveau[i])&&(touches[0].pageY<(y_case_niveau[i]+hauteur_case_niveau)))
			{
				if(i+1<=max_level)
				{
					selected_level=i+1;
					level_config();
				}
			}
		}
		for(i=0;i<3;i++)
		{
			if((touches[0].pageX>x_3_boutons[i])&&(touches[0].pageX<x_3_boutons[i]+largeur_case_niveau)&&(touches[0].pageY>y_3_boutons)&&(touches[0].pageY<y_3_boutons+hauteur_3_boutons))
			{
				bouton=i+1;
			}
		}
		if(bouton==1)
		{
			cheatcode=generation_cheatcode();
			cheatcode=prompt('cheat code : ',cheatcode)
			//alert(cheatcode);
			recuperation_cheatcode(cheatcode);
		}
		else if(bouton==2)
		{
			etat=3;
			first_draw=1;
		}
		else if(bouton==3)
		{
			etat=4;
			first_draw=1;
		}
	}
	/*
var x_case_niveau=[0,0,0,0,0,0,0,0,0,0,0,0];
var y_case_niveau=[0,0,0,0,0,0,0,0,0,0,0,0];
var largeur_case_niveau=0;
var hauteur_case_niveau=0;
var x_3_boutons=[0,0,0];
var y_3_boutons=0;
var hauteur_3_boutons=0;*/
}	

function move_touch(e) {    
	e.preventDefault();
	var touches = e.changedTouches;
	var i=0;
	var nb_poioints=tab_x.length;
	xrond=[];
	yrond=[];	
	if(clic_en_cours==1&&((touches[0].pageX!=0)||(touches[0].pageY!=0)))
	{
		nb_ronds=touches.length;
		for (i=0; i<nb_ronds; i++) {
			//ongoingTouches.push(touches[i]);
			xrond[i]=touches[i].pageX;
			yrond[i]=touches[i].pageY;

		}
		angle_canon=calcul_angle_miss(xrond[0]-canvas.width/2,yrond[0]-(hauteur_rect-largeur_socle/4-largeur_socle/3));
		tab_x.push(xrond[0]);
		tab_y.push(yrond[0]);
		if(nb_poioints>0)
		{
			temps_point_passage.push(temps_point_passage[nb_poioints-1]+Math.pow(Math.pow(tab_x[nb_poioints]-tab_x[nb_poioints-1],2)+Math.pow(tab_y[nb_poioints]-tab_y[nb_poioints-1],2),1/2)/vit_pix_par_sec);
		}
	}
}	

function up_touch(e) {    
	e.preventDefault();
	var touches = e.changedTouches;
	var i=0;
	var nb_poioints=tab_x.length;
	xrond=[];
	yrond=[];
	nb_ronds=touches.length;
	if((tir_mis==0)&&((touches[0].pageX!=0)||(touches[0].pageY!=0)))
	{
		for (i=0; i<nb_ronds; i++) {
			//ongoingTouches.push(touches[i]);
			xrond[i]=touches[i].pageX;
			yrond[i]=touches[i].pageY;
		}
		tab_x.push(xrond[0]);
		tab_y.push(yrond[0]);
		if(nb_poioints>0)
		{
			temps_point_passage.push(temps_point_passage[nb_poioints-1]+Math.pow(Math.pow(tab_x[nb_poioints]-tab_x[nb_poioints-1],2)+Math.pow(tab_y[nb_poioints]-tab_y[nb_poioints-1],2),1/2)/vit_pix_par_sec);
		}
	}
	clic_en_cours=0;
}	

function tracerond (xrond,yrond,tailleRond){
	ctx.beginPath();
	ctx.arc(xrond, yrond, tailleRond, 0, Math.PI*2, false);
	ctx.fill();
	ctx.closePath();
}

function traceimmeubles(){
	var disiz=0;
	var lapeste=0;
	var nb_boom=0;
	var boom_list=[];
	var idx;
	var nb_im=posi_immeubles.length;
	for(disiz=0;disiz<nb_im;disiz++)
	{
			ctx.fillStyle = 'grey';
           
          //  tracequadrilataire_plein(posi_immeubles[disiz],hauteur_rect,posi_immeubles[disiz],hauteur_rect-hauteur_immeubles[disiz],posi_immeubles[disiz]+largeur_immeubles[disiz],hauteur_rect-hauteur_immeubles[disiz],posi_immeubles[disiz]+largeur_immeubles[disiz],  hauteur_rect);
         //   tracequadrilataire(posi_immeubles[disiz],hauteur_rect,posi_immeubles[disiz],hauteur_rect-hauteur_immeubles[disiz],posi_immeubles[disiz]+largeur_immeubles[disiz],hauteur_rect-hauteur_immeubles[disiz],posi_immeubles[disiz]+largeur_immeubles[disiz],  hauteur_rect);
         //  ctx.fillStyle = 'pink';
 
          
          if(etat_facade_gauche[disiz]==0)
           {
				trace_gauche_0(posi_immeubles[disiz],hauteur_immeubles[disiz],largeur_immeubles[disiz]);
	       }
           else if(etat_facade_gauche[disiz]==1)
           {
           	trace_gauche_1(posi_immeubles[disiz],hauteur_immeubles[disiz],largeur_immeubles[disiz]);
           }
           else if(etat_facade_gauche[disiz]==2)
           {
           	trace_gauche_2(posi_immeubles[disiz],hauteur_immeubles[disiz],largeur_immeubles[disiz]);
           }
           
          // ctx.fillStyle = 'green';
           if(etat_facade_droite[disiz]==0)
           {
				trace_droite_0(posi_immeubles[disiz],hauteur_immeubles[disiz],largeur_immeubles[disiz]);
	       }
           else if(etat_facade_droite[disiz]==1)
           {
           	trace_droite_1(posi_immeubles[disiz],hauteur_immeubles[disiz],largeur_immeubles[disiz]);
           }
           else if(etat_facade_droite[disiz]==2)
           {
           	trace_droite_2(posi_immeubles[disiz],hauteur_immeubles[disiz],largeur_immeubles[disiz]);
           }
           
           
           
           boom_list=[];
          //  x_bat_explose.push(posimm+largimm/4);
				//y_bat_explose.push(hauteur_rect-hautimm*3/4);
				//x_miss_explose.push(posXmiss);
				//y_miss_explose.push(posYmiss);
				//date_impact.push(maintenant);
				//vit_x_miss_exlpose.push(vit_x_miss[undice]);
				//vit_y_miss_explose.push(vit_y_miss[undice]);
				// ind_immeuble_explosion.push(deuxdice);
				
				
			idx = ind_immeuble_explosion.indexOf(disiz);
			while (idx != -1) {
				boom_list.push(idx);
				idx = ind_immeuble_explosion.indexOf(disiz, idx + 1);
			}
				
			nb_boom=boom_list.length;
			//alert(nb_boom);
           if(nb_boom>0)
            {
            	for(lapeste=0;lapeste<nb_boom;lapeste++)
	            {
					if((maintenant-date_impact[boom_list[lapeste]])<duree_explose_immeuble/6)
					{
						ctx.fillStyle = 'yellow';
						//
						tracerond(x_bat_explose[boom_list[lapeste]],y_bat_explose[boom_list[lapeste]],(maintenant-date_impact[boom_list[lapeste]])/(duree_explose_immeuble/6)*40*facteur_taille);
						tracerond(x_miss_explose[boom_list[lapeste]],y_miss_explose[boom_list[lapeste]],(maintenant-date_impact[boom_list[lapeste]])/(duree_explose_immeuble/6)*40*facteur_taille);
					}
					else if((maintenant-date_impact[boom_list[lapeste]])<duree_explose_immeuble/3)
					{
						ctx.fillStyle = 'orange';
						tracerond(x_bat_explose[boom_list[lapeste]],y_bat_explose[boom_list[lapeste]],(maintenant-date_impact[boom_list[lapeste]])/(duree_explose_immeuble/3)*80*facteur_taille);
						tracerond(x_miss_explose[boom_list[lapeste]],y_miss_explose[boom_list[lapeste]],(maintenant-date_impact[boom_list[lapeste]])/(duree_explose_immeuble/3)*80*facteur_taille);
						ctx.fillStyle = 'yellow';
						tracerond(x_bat_explose[boom_list[lapeste]],y_bat_explose[boom_list[lapeste]],40*facteur_taille);
						tracerond(x_miss_explose[boom_list[lapeste]],y_miss_explose[boom_list[lapeste]],40*facteur_taille);
					}
					else if((maintenant-date_impact[boom_list[lapeste]])<duree_explose_immeuble*2/3)
					{
						ctx.fillStyle = 'orange';
						tracerond(x_bat_explose[boom_list[lapeste]],y_bat_explose[boom_list[lapeste]],80*facteur_taille);
						tracerond(x_miss_explose[boom_list[lapeste]],y_miss_explose[boom_list[lapeste]],80*facteur_taille);
						ctx.fillStyle = 'yellow';
						tracerond(x_bat_explose[boom_list[lapeste]],y_bat_explose[boom_list[lapeste]],40*facteur_taille);
						tracerond(x_miss_explose[boom_list[lapeste]],y_miss_explose[boom_list[lapeste]],40*facteur_taille);
					}
					else
					{
						//on supprime
					}
				}
			}
           

     }
}

function trace_gauche_0(posi_imm,hauteur_imm,largeur_imm)
{
	ctx.beginPath();
	ctx.moveTo(posi_imm+largeur_imm/2, hauteur_rect);
	ctx.lineTo(posi_imm, hauteur_rect);
	ctx.lineTo(posi_imm, hauteur_rect-hauteur_imm);
	ctx.lineTo(posi_imm+largeur_imm/2, hauteur_rect-hauteur_imm);	
	ctx.fill();
	//ctx.stroke();
}

function trace_droite_0(posi_imm,hauteur_imm,largeur_imm)
{
	ctx.beginPath();
	ctx.moveTo(posi_imm+largeur_imm/2, hauteur_rect);
	ctx.lineTo(posi_imm+largeur_imm, hauteur_rect);
	ctx.lineTo(posi_imm+largeur_imm, hauteur_rect-hauteur_imm);
	ctx.lineTo(posi_imm+largeur_imm/2, hauteur_rect-hauteur_imm);	
	ctx.fill();
	//ctx.stroke();
}


function trace_gauche_1(posi_imm,hauteur_imm,largeur_imm)
{
	ctx.beginPath();
	ctx.moveTo(posi_imm+largeur_imm/2, hauteur_rect-hauteur_imm/2);
	//ctx.lineTo(posi_imm+largeur_imm/10*4.8, hauteur_rect-hauteur_imm);
	ctx.lineTo(posi_imm+largeur_imm/10*3, hauteur_rect-5*hauteur_imm/9);
	ctx.lineTo(posi_imm, hauteur_rect-hauteur_imm/2);
	ctx.lineTo(posi_imm, hauteur_rect);
	ctx.lineTo(posi_imm+largeur_imm/2, hauteur_rect);	
	ctx.fill();
	//ctx.stroke();
}

function trace_droite_1(posi_imm,hauteur_imm,largeur_imm)
{
	ctx.beginPath();
	ctx.moveTo(posi_imm+largeur_imm/2, hauteur_rect-hauteur_imm/2);
	//ctx.lineTo(posi_imm+largeur_imm/10*5.3, hauteur_rect-hauteur_imm);
	ctx.lineTo(posi_imm+largeur_imm/9*6, hauteur_rect-5*hauteur_imm/9);
	ctx.lineTo(posi_imm+largeur_imm, hauteur_rect-hauteur_imm/2);
	ctx.lineTo(posi_imm+largeur_imm, hauteur_rect);
	ctx.lineTo(posi_imm+largeur_imm/2, hauteur_rect);	
	ctx.fill();
	//ctx.stroke();
}

function trace_gauche_2(posi_imm,hauteur_imm,largeur_imm)
{
	ctx.beginPath();
	ctx.moveTo(posi_imm+largeur_imm/2, hauteur_rect-hauteur_imm/9);
	//ctx.lineTo(posi_imm+largeur_imm/10*4.8, hauteur_rect-hauteur_imm);
	ctx.lineTo(posi_imm+largeur_imm/10*2.5, hauteur_rect-hauteur_imm/8);
	ctx.lineTo(posi_imm, hauteur_rect-hauteur_imm/8);
	ctx.lineTo(posi_imm, hauteur_rect);
	ctx.lineTo(posi_imm+largeur_imm/2, hauteur_rect);	
	ctx.fill();
	//ctx.stroke();
}

function trace_droite_2(posi_imm,hauteur_imm,largeur_imm)
{
	ctx.beginPath();
	ctx.moveTo(posi_imm+largeur_imm/2, hauteur_rect-hauteur_imm/9);
	//ctx.lineTo(posi_imm+largeur_imm/10*5.3, hauteur_rect-hauteur_imm);
	ctx.lineTo(posi_imm+largeur_imm/9*7, hauteur_rect-hauteur_imm/8);
	ctx.lineTo(posi_imm+largeur_imm, hauteur_rect-hauteur_imm/10);
	ctx.lineTo(posi_imm+largeur_imm, hauteur_rect);
	ctx.lineTo(posi_imm+largeur_imm/2, hauteur_rect);	
	ctx.fill();
	//ctx.stroke();
}


function tracequadrilataire(x1,y1,x2,y2,x3,y3,x4,y4)
{
		ctx.beginPath();
		ctx.moveTo(x1, y1);
		ctx.lineTo(x2, y2);
		ctx.lineTo(x3, y3);
		ctx.lineTo(x4, y4);
		ctx.lineTo(x1, y1);
		ctx.closePath();	
		ctx.stroke();
}

function tracequadrilataire_plein(x1,y1,x2,y2,x3,y3,x4,y4)
{
		ctx.beginPath();
		ctx.moveTo(x1, y1);
		ctx.lineTo(x2, y2);
		ctx.lineTo(x3, y3);
		ctx.lineTo(x4, y4);
		ctx.lineTo(x1, y1);
		ctx.closePath();	
		ctx.fill();
}

function affiche_titres()
{
	//Missiles dans ton cul
	//sur une idée de PoulainNico
}

function trace_traj(tabloX,tabloY)
{
	var n_puins = tabloX.length;
	var induice = 1;
	if (n_puins>1)
	{
		ctx.beginPath();
		ctx.moveTo(tabloX[0], tabloY[0]);
		for (induice=1;induice<n_puins;induice++)
		{
			ctx.lineTo(tabloX[induice], tabloY[induice]);
		}
		ctx.stroke();
	}	
}

function position_et_orientation_du_missile()
{
	var coord = [0,0,0];
	var filtre = [];
	var num_dernier_point_de_passage=0;
	
	filtre=temps_point_passage.filter(suffisammentPetit);
	num_dernier_point_de_passage=filtre.length-1;
	
	coord[0]=tab_x[num_dernier_point_de_passage]+(tab_x[num_dernier_point_de_passage+1]-tab_x[num_dernier_point_de_passage])*(tps_depuis_tir-temps_point_passage[num_dernier_point_de_passage])/(temps_point_passage[num_dernier_point_de_passage+1]-temps_point_passage[num_dernier_point_de_passage]);
	coord[1]=tab_y[num_dernier_point_de_passage]+(tab_y[num_dernier_point_de_passage+1]-tab_y[num_dernier_point_de_passage])*(tps_depuis_tir-temps_point_passage[num_dernier_point_de_passage])/(temps_point_passage[num_dernier_point_de_passage+1]-temps_point_passage[num_dernier_point_de_passage]);
	if ((tab_x[num_dernier_point_de_passage+1]-tab_x[num_dernier_point_de_passage])>0)
	{
		coord[2]=Math.atan((tab_y[num_dernier_point_de_passage+1]-tab_y[num_dernier_point_de_passage])/(tab_x[num_dernier_point_de_passage+1]-tab_x[num_dernier_point_de_passage]))+Math.PI/2;
	}
	else if ((tab_x[num_dernier_point_de_passage+1]-tab_x[num_dernier_point_de_passage])<0)
	{
		coord[2]=Math.atan((tab_y[num_dernier_point_de_passage+1]-tab_y[num_dernier_point_de_passage])/(tab_x[num_dernier_point_de_passage+1]-tab_x[num_dernier_point_de_passage]))+Math.PI*3/2;
	}
	else if ((tab_y[num_dernier_point_de_passage+1]-tab_y[num_dernier_point_de_passage])>0)
	{
		coord[2]=Math.PI;
	}
	else
	{
		coord[2]=0;
	}

	return coord;
}

function suffisammentPetit(element) 
{
  return element <= tps_depuis_tir;
}

function paysage(numero_de_paysage)
{
	var proportion_t_etat=(maintenant-state_start_time)/etat_4_duree;
	var x_av=0;
	var y_av=0;
	var taille_av=0;
	var taille_logo=0;
	var x_logo=0;
	var y_logo=0;
	var temps=(maintenant-state_start_time)%8;
	if(numero_de_paysage==1)
	{
		//ciel
		//ctx.strokeStyle = 'yellow';
		ctx.fillStyle = '#bdf';
		tracequadrilataire_plein(0,0,canvas.width,0,canvas.width,hauteur_rect,0,hauteur_rect);
		//nuage
		
		ctx.fillStyle = '#fff';
		ctx.beginPath();
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width/7,hauteur_rect*2/40);
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width/5,hauteur_rect*2/40);
		ctx.arc(proportion_t_etat*3*canvas.width/5+canvas.width/5, hauteur_rect*5/80, hauteur_rect/80, -Math.PI/2, Math.PI/2, false);
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width/3,hauteur_rect*3/40);
		ctx.arc(proportion_t_etat*3*canvas.width/5+canvas.width/3, hauteur_rect*8/80, hauteur_rect/40, -Math.PI/2, Math.PI/2, false);
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width/4,hauteur_rect*5/40);
		ctx.arc(proportion_t_etat*3*canvas.width/5+canvas.width/4, hauteur_rect*11/80, hauteur_rect/80, -Math.PI/2, Math.PI/2, false);
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width*1.3/20,hauteur_rect*6/40);
		ctx.arc(proportion_t_etat*3*canvas.width/5+canvas.width*1.3/20, hauteur_rect*10/80, hauteur_rect/40, Math.PI/2, Math.PI*3/2, false);
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width/15,hauteur_rect*4/40);
		ctx.arc(proportion_t_etat*3*canvas.width/5+canvas.width/15, hauteur_rect*7/80, hauteur_rect/80, Math.PI/2, Math.PI*3/2, false);
		ctx.lineTo(proportion_t_etat*3*canvas.width/5+canvas.width/7,hauteur_rect*3/40);
		ctx.arc(proportion_t_etat*3*canvas.width/5+canvas.width/7, hauteur_rect*5/80, hauteur_rect/80, Math.PI/2, Math.PI*3/2, false);
		
		
		
		ctx.closePath();
		ctx.fill();
		
		//montagnes
		ctx.fillStyle = '#fcb';
		ctx.beginPath();
		ctx.lineTo(0,hauteur_rect);
		ctx.lineTo(0,hauteur_rect/2);
		ctx.lineTo(canvas.width/6,hauteur_rect/3);
		ctx.lineTo(canvas.width,hauteur_rect*6/5);
		ctx.lineTo(canvas.width,hauteur_rect);
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = '#fff';
		ctx.beginPath();
		ctx.lineTo(canvas.width/20,hauteur_rect*(1/2-1/20));
		ctx.lineTo(canvas.width/6,hauteur_rect/3);
		ctx.lineTo(canvas.width*(2/6-1/20),hauteur_rect*(1/2-1/20));
		ctx.lineTo(canvas.width*(1/6*4/3),hauteur_rect*(1/2-1/15));
		ctx.lineTo(canvas.width*(1/6*2/3),hauteur_rect*(1/2-1/30));
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = '#eba';
		ctx.beginPath();
		ctx.lineTo(0,hauteur_rect);
		ctx.lineTo(0,3*hauteur_rect/4);
		ctx.lineTo(2*canvas.width/3,hauteur_rect/5);
		ctx.lineTo(canvas.width,hauteur_rect/2);
		ctx.lineTo(canvas.width,hauteur_rect);
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = '#fff';
		ctx.beginPath();
		ctx.lineTo(canvas.width*4/9.5,hauteur_rect/2.5);
		ctx.lineTo(2*canvas.width/3,hauteur_rect/5);
		ctx.lineTo(canvas.width*9/10.1,hauteur_rect/2.5);
		ctx.lineTo(canvas.width*8/11,hauteur_rect/2.3);
		ctx.lineTo(canvas.width*6.5/11,hauteur_rect/2.7);
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = '#cd9';
		ctx.beginPath();
		ctx.lineTo(0, hauteur_rect);
		ctx.arc(canvas.width,canvas.height*3,canvas.height*2.35,-Math.acos((-canvas.width)/(canvas.height*2.35)),-Math.acos((0)/(canvas.height*2.35)), false);
		ctx.lineTo(canvas.width, hauteur_rect);
		ctx.closePath();
		ctx.fill();
		//tracerond(canvas.width,canvas.height*3,canvas.height*2.35);
		
		ctx.fillStyle = '#bc8';
		ctx.beginPath();
		ctx.lineTo(0, hauteur_rect);
		ctx.arc(canvas.width/4, hauteur_rect*3, hauteur_rect*2.3,-Math.acos((-canvas.width/4)/(hauteur_rect*2.3)),-Math.acos((canvas.width*3/4)/(hauteur_rect*2.3)), false);
		ctx.lineTo(canvas.width, hauteur_rect);
		ctx.closePath();
		ctx.fill();
	}
	else if(numero_de_paysage==2)
	{
		//ciel
		ctx.fillStyle = '#da6';
		tracequadrilataire_plein(0,0,canvas.width,0,canvas.width,hauteur_rect,0,hauteur_rect);
		
		ctx.fillStyle = '#da6';
		tracequadrilataire_plein(0,hauteur_rect/6,canvas.width,hauteur_rect/6,canvas.width,hauteur_rect,0,hauteur_rect);
		//tracerond(canvas.width*2/3,hauteur_rect/3,canvas.width/2);
		
		ctx.fillStyle = '#e62';
		tracequadrilataire_plein(0,hauteur_rect/3-canvas.width/30,canvas.width,hauteur_rect/3-canvas.width/30,canvas.width,hauteur_rect,0,hauteur_rect);
		//tracerond(canvas.width*2/3,hauteur_rect/3,canvas.width/8);
		
		ctx.fillStyle = '#832';
		tracequadrilataire_plein(0,hauteur_rect/3-canvas.width/60,canvas.width,hauteur_rect/3-canvas.width/60,canvas.width,hauteur_rect,0,hauteur_rect);
		
		ctx.fillStyle = '#ff9';
		tracerond(canvas.width*2/3,hauteur_rect/3,canvas.width/20);
		
		ctx.fillStyle = '#7ab';
		tracequadrilataire_plein(0,hauteur_rect/3,canvas.width,hauteur_rect/3,canvas.width,hauteur_rect,0,hauteur_rect);
		
		
		//bateau
		
		ctx.fillStyle = '#eee';
		ctx.beginPath();
		ctx.lineTo(proportion_t_etat*3/4*canvas.width, hauteur_rect/2.6);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4, hauteur_rect/2.9);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4+hauteur_rect/60, hauteur_rect/2.6);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4+hauteur_rect/160, hauteur_rect/2.6);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4+hauteur_rect/160, hauteur_rect/2.58);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4+hauteur_rect/50, hauteur_rect/2.58);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4+hauteur_rect/65, hauteur_rect/2.55);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4-hauteur_rect/65, hauteur_rect/2.55);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4-hauteur_rect/50, hauteur_rect/2.58);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4, hauteur_rect/2.58);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4, hauteur_rect/2.6);
		
		ctx.lineTo(proportion_t_etat*3*canvas.width/4-hauteur_rect/65, hauteur_rect/2.6);
		ctx.lineTo(proportion_t_etat*3*canvas.width/4, hauteur_rect/2.8);
		ctx.closePath();
		ctx.fill();
		
		ctx.lineTo(canvas.width, hauteur_rect);
		ctx.closePath();
		ctx.fill();
		ctx.fillStyle = '#fff';
		ctx.beginPath();
		ctx.lineTo(canvas.width, hauteur_rect);
		ctx.arc(canvas.width/2, -hauteur_rect, hauteur_rect*3/2, Math.acos((canvas.width/2)/(hauteur_rect*3/2)),Math.acos(-(canvas.width/2)/(hauteur_rect*3/2)), false);
		ctx.lineTo(0, hauteur_rect);
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = 'yellow';
		ctx.beginPath();
		ctx.lineTo(canvas.width, hauteur_rect);
		ctx.arc(canvas.width/2, -hauteur_rect+canvas.width/60, hauteur_rect*3/2, Math.acos((canvas.width/2)/(hauteur_rect*3/2)),Math.acos(-(canvas.width/2)/(hauteur_rect*3/2)), false);
		ctx.lineTo(0, hauteur_rect);
		ctx.closePath();
		ctx.fill();
		
		ctx.fillStyle = '#cd9';
		ctx.beginPath();
		ctx.lineTo(canvas.width, hauteur_rect);
		ctx.arc(canvas.width/2, -hauteur_rect+canvas.width/20, hauteur_rect*3/2, Math.acos((canvas.width/2)/(hauteur_rect*3/2)),Math.acos(-(canvas.width/2)/(hauteur_rect*3/2)), false);
		ctx.lineTo(0, hauteur_rect);
		ctx.closePath();
		ctx.fill();
		
	
		//soleil
		//mer
		//bateau
		//plage
		//herbe
	}
	else if(numero_de_paysage==3)
	{
		//((maintenant-state_start_time)+15)
		x_av=canvas.width/4;
		y_av=hauteur_rect*6.3/9-1/(temps+2)*1000;
		taille_av=hauteur_rect/(temps+3)*0.5;
		//ciel
		//ctx.strokeStyle = 'yellow';
		ctx.fillStyle = '#bde';
		tracequadrilataire_plein(0,0,canvas.width,0,canvas.width,hauteur_rect,0,hauteur_rect);
		
		//avion
		ctx.fillStyle = '#444';
		ctx.beginPath();
		ctx.lineTo(x_av, y_av);
		ctx.lineTo(x_av-taille_av/2, y_av-taille_av/20);
		ctx.lineTo(x_av, y_av+taille_av/15);
		ctx.lineTo(x_av+taille_av/2, y_av-taille_av/20);
		ctx.lineTo(x_av, y_av);
		ctx.closePath();
		ctx.fill();
		
		tracerond(x_av,y_av-taille_av/20,taille_av/12);
		
		tracerond(x_av-taille_av/5,y_av+taille_av/20,taille_av/20);
		tracerond(x_av+taille_av/5,y_av+taille_av/20,taille_av/20);
		
		ctx.beginPath();
		ctx.lineTo(x_av-taille_av/20, y_av);
		ctx.lineTo(x_av, y_av-taille_av/4);
		ctx.lineTo(x_av+taille_av/20, y_av);
		ctx.closePath();
		ctx.fill();
		
		//logo carrefour
		taille_logo=hauteur_rect/12;
		taille_montagne=hauteur_rect/8;
		x_logo=canvas.width/8;
		y_logo=hauteur_rect*1.3/3;
		
		ctx.fillStyle = '#ddd';
		ctx.beginPath();
		ctx.lineTo(x_logo, y_logo);
		ctx.lineTo(x_logo+2*taille_logo, y_logo);
		ctx.lineTo(x_logo+2*taille_logo, y_logo+taille_logo*3/2);
		ctx.lineTo(x_logo, y_logo+taille_logo*3/2);
		ctx.closePath();
		ctx.fill();
		ctx.stroke();
		
		
		
		ctx.fillStyle = 'red';
		ctx.beginPath();
		ctx.lineTo(x_logo-taille_logo/20, y_logo);
		ctx.arc(x_logo+taille_logo*3/4-taille_logo/20,y_logo,taille_logo/2, Math.PI*3/4,-Math.PI*3/4, false);
		ctx.closePath();
		ctx.fill();
		ctx.fillStyle = 'blue';
		ctx.beginPath();
		ctx.lineTo(x_logo+taille_logo, y_logo);
		//ctx.lineTo(x_logo+taille_logo*2/3, y_logo-taille_logo*1/3);
		ctx.arc(x_logo+taille_logo*1.7/3,y_logo-taille_logo*1/4.5,taille_logo/6,-Math.PI*1/5, Math.PI/6, false);
		ctx.arc(x_logo+taille_logo*1.9/3,y_logo-taille_logo*1/5,taille_logo/11,Math.PI*1/4, -Math.PI*5/8, false);
		ctx.arc(x_logo+taille_logo*2.1/4,y_logo-taille_logo*1/5,taille_logo/8,-Math.PI/4, Math.PI, true);
		ctx.arc(x_logo+taille_logo*20.5/20,y_logo,taille_logo*2/3,-Math.PI*7/8, Math.PI*7/8, true);
		ctx.arc(x_logo+taille_logo*2.1/4,y_logo+taille_logo*1/5,taille_logo/8, Math.PI,+Math.PI/4,true);
		ctx.arc(x_logo+taille_logo*1.9/3,y_logo+taille_logo*1/5,taille_logo/11, +Math.PI*5/8,-Math.PI*1/4, false);
		ctx.arc(x_logo+taille_logo*1.7/3,y_logo+taille_logo*1/4.5,taille_logo/6,-Math.PI/6, Math.PI*1/5, false);
		//ctx.lineTo(x_logo+taille_logo*2/3, y_logo+taille_logo*1/3);
		//ctx.arc(x_logo+taille_logo*3/4,y_logo,taille_logo/2, Math.PI*3/4,-Math.PI*3/4, false);
		ctx.closePath();
		ctx.fill();
		
		
		//logo domac
		
		ctx.fillStyle = '#ee5';
		ctx.beginPath();
		ctx.arc(x_logo+2*taille_logo,y_logo,taille_logo,-Math.PI,-Math.PI*5/6, false);
		ctx.arc(x_logo+0.3*taille_logo,y_logo,taille_logo,-Math.PI*1/6,0, false);
		ctx.arc(x_logo+0.23*taille_logo,y_logo+0.05*taille_logo,taille_logo,-0.05,-Math.PI*1/7, true);
		ctx.arc(x_logo+2.07*taille_logo,y_logo+0.05*taille_logo,taille_logo,-Math.PI*6/7,-Math.PI+0.05, true);
		ctx.closePath();
		ctx.fill();
		
		ctx.beginPath();
		ctx.arc(taille_logo/4+x_logo+2*taille_logo,y_logo,taille_logo,-Math.PI,-Math.PI*5/6, false);
		ctx.arc(taille_logo/4+x_logo+0.3*taille_logo,y_logo,taille_logo,-Math.PI*1/6,0, false);
		ctx.arc(taille_logo/4+x_logo+0.23*taille_logo,y_logo+0.05*taille_logo,taille_logo,-0.05,-Math.PI*1/7, true);
		ctx.arc(taille_logo/4+x_logo+2.07*taille_logo,y_logo+0.05*taille_logo,taille_logo,-Math.PI*6/7,-Math.PI+0.05, true);
		ctx.closePath();
		ctx.fill();
		
		//moulin
		x_logo=canvas.width*9/10;
		y_logo=hauteur_rect*1.6/6;
		ctx.fillStyle = 'black';
		ctx.translate(x_logo,y_logo);
		ctx.rotate((maintenant-state_start_time)*Math.PI/2);
		ctx.beginPath();
		ctx.lineTo(taille_logo/8, 0);
		ctx.lineTo(taille_logo/8, taille_logo/2);
		ctx.lineTo(-taille_logo/8, taille_logo/2);
		ctx.lineTo(-taille_logo/8, 0);
		ctx.closePath();
		ctx.fill();
		ctx.beginPath();
		ctx.lineTo(0,taille_logo/8);
		ctx.lineTo(taille_logo/2,taille_logo/8);
		ctx.lineTo(taille_logo/2,-taille_logo/8);
		ctx.lineTo(0,-taille_logo/8) ;
		ctx.closePath();
		ctx.fill();
		ctx.beginPath();
		ctx.lineTo(-taille_logo/8, 0);
		ctx.lineTo(-taille_logo/8, -taille_logo/2);
		ctx.lineTo(taille_logo/8, -taille_logo/2);
		ctx.lineTo(taille_logo/8, 0);
		ctx.closePath();
		ctx.fill();
		ctx.beginPath();
		ctx.lineTo(0,-taille_logo/8);
		ctx.lineTo(-taille_logo/2,-taille_logo/8);
		ctx.lineTo(-taille_logo/2,taille_logo/8);
		ctx.lineTo(0,taille_logo/8) ;
		ctx.closePath();
		ctx.fill();
		ctx.rotate(-(maintenant-state_start_time)*Math.PI/2);
		ctx.translate(-x_logo,-y_logo);
		
		ctx.fillStyle = 'grey';
		ctx.beginPath();
		ctx.lineTo(x_logo-taille_logo/4, y_logo+taille_logo/5);
		ctx.lineTo(x_logo, y_logo+taille_logo/5-taille_logo/2,);
		ctx.lineTo(x_logo+taille_logo/4, y_logo+taille_logo/5);
		ctx.lineTo(x_logo+taille_logo/4, y_logo+taille_logo);
		ctx.lineTo(x_logo-taille_logo/4, y_logo+taille_logo);
		ctx.closePath();
		ctx.fill();
		
		//colline
		ctx.fillStyle = 'green';
		ctx.beginPath();
		ctx.lineTo(0, hauteur_rect);
		ctx.lineTo(0, hauteur_rect*1.8/3);
		ctx.arc(2*canvas.width/3,hauteur_rect/2,taille_montagne*2,-Math.PI*3/4,-Math.PI/4, false);
		ctx.lineTo(canvas.width, hauteur_rect*1.2/3);
		ctx.lineTo(canvas.width, hauteur_rect);
		ctx.closePath();
		ctx.fill();
		
	}
	else if(numero_de_paysage==4)
	{
		temps_2=(maintenant-state_start_time)%8;
		type_train_1=Math.floor(((maintenant-state_start_time)%16)/8);
		if(temps_2>5)
		{
			temps_2=temps_2-5;
		}
		else if(temps_2>3)
		{
			temps_2=0;
		}
		else
		{
			temps_2=temps_2-3;
		}
		delta_train_1=(temps_2**2)*canvas.width/3;
		if(temps_2>0)
		{
			delta_train_1=-delta_train_1;
		}
		temps_3=(maintenant-state_start_time)%7;
		type_train_2=Math.floor(((maintenant-state_start_time+7)%14)/7);
		if(temps_3>4.5)
		{
			temps_3=temps_3-4.5;
		}
		else if(temps_3>2.5)
		{
			temps_3=0;
		}
		else
		{
			temps_3=temps_3-2.5;
		}
		delta_train_2=(temps_3**2)*canvas.width/3;
		if(temps_3<0)
		{
			delta_train_2=-delta_train_2;
		}
		temps_4=(maintenant-state_start_time)%3;
		if(temps_4>2)
		{
			temps_4=0;
		}
		else if(temps_4>1)
		{
			temps_4=temps_4-2;
		}
		else
		{
			temps_4=-1;
		}
		delta_coeur=(temps_4**2)*canvas.width/3;
		
		hauteur_lycee=hauteur_rect/8;
		offcet_h_lycee=hauteur_rect/3;
		longueur_lycee=hauteur_lycee*4;
		
		
		
		ctx.fillStyle = '#bde';
		tracequadrilataire_plein(0,0,canvas.width,0,canvas.width,hauteur_rect,0,hauteur_rect);
		

        //coline
		ctx.fillStyle = 'green';
		ctx.beginPath();
		/*ctx.lineTo(0, hauteur_rect);
		ctx.lineTo(0, hauteur_rect*1.8/3);*/
		ctx.arc(canvas.width/2,hauteur_rect/2,hauteur_lycee*2.5,-Math.PI*4/4,-Math.PI*0/4, false);
		/*ctx.lineTo(canvas.width, hauteur_rect*1.2/3);
		ctx.lineTo(canvas.width, hauteur_rect);*/
		ctx.closePath();
		ctx.fill();
		
		
        //sol
		ctx.fillStyle = '#baa';
		tracequadrilataire_plein(0,offcet_h_lycee+hauteur_lycee/4,canvas.width,offcet_h_lycee+hauteur_lycee/4,canvas.width,hauteur_rect,0,hauteur_rect);
		
		
		
		//route
		ctx.fillStyle = '#567';
		ctx.beginPath();
		ctx.lineTo(hauteur_lycee/2.5,hauteur_rect);
		ctx.lineTo(0,hauteur_rect);
		ctx.lineTo(0,offcet_h_lycee+hauteur_lycee*2.6);
		ctx.lineTo(canvas.width-longueur_lycee+hauteur_lycee/4,offcet_h_lycee);
		ctx.closePath();
		ctx.fill();

        ctx.fillStyle = '#ffd';
		tracequadrilataire_plein(canvas.width-longueur_lycee,offcet_h_lycee,canvas.width,offcet_h_lycee,canvas.width,offcet_h_lycee+hauteur_lycee,canvas.width-longueur_lycee,offcet_h_lycee+hauteur_lycee);
		ctx.fillStyle = '#bbb';
		tracequadrilataire_plein(canvas.width-longueur_lycee*1.02,offcet_h_lycee,canvas.width,offcet_h_lycee,canvas.width,offcet_h_lycee-hauteur_lycee*0.1,canvas.width-longueur_lycee*1.02,offcet_h_lycee-hauteur_lycee*0.1);
		ctx.fillStyle = '#ddd';
		tracequadrilataire_plein(canvas.width-longueur_lycee*0.98,offcet_h_lycee+hauteur_lycee*0.04,canvas.width,offcet_h_lycee+hauteur_lycee*0.04,canvas.width,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee/7,canvas.width-longueur_lycee*0.98,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee/7);
		tracequadrilataire_plein(canvas.width-longueur_lycee*0.98,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*2/7,canvas.width,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*2/7,canvas.width,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee/7+hauteur_lycee*2/7,canvas.width-longueur_lycee*0.98,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*2/7+hauteur_lycee/7);
		tracequadrilataire_plein(canvas.width-longueur_lycee*0.98,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*4/7,canvas.width,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*4/7,canvas.width,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee/7+hauteur_lycee*4/7,canvas.width-longueur_lycee*0.98,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*4/7+hauteur_lycee/7);
		msb1=3;
		sb1=2;
		lsb1=5;
		msb2=4;
		sb2=7;
		lsb2=9;
		msb3=4;
		sb3=6;
		lsb3=8;
       for (i=0; i<33; i++) {
       	    msb1=(msb1+0.6)%8;
               //sb1=(sb1+2)%10;
               //lsb1=(lsb1+3)%10;
               msb=msb1+4;
               sb=sb1+4;
               lsb=lsb1+4;
			   couleur_montant='#'+(msb/15*0xF<<0).toString(16)+(sb/15*0xF<<0).toString(16)+(lsb*0xF<<0).toString(16);
               ctx.fillStyle = couleur_montant;
		       tracequadrilataire_plein(canvas.width-longueur_lycee*0.98+longueur_lycee*0.03*i,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*0/7,canvas.width-longueur_lycee*0.98+longueur_lycee*0.01+longueur_lycee*0.03*i,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*0/7,canvas.width-longueur_lycee*0.98+longueur_lycee*0.01+longueur_lycee*0.03*i,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee/7+hauteur_lycee*0/7,canvas.width-longueur_lycee*0.98+longueur_lycee*0.03*i,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*0/7+hauteur_lycee/7);
	           //msb2=(msb2+2)%10;
               //sb2=(sb2+3)%10;
               lsb2=(lsb2+1)%8;
               msb=msb2+4;
               sb=sb2+4;
               lsb=lsb2+4;
			   couleur_montant='#'+(msb/15*0xF<<0).toString(16)+(sb/15*0xF<<0).toString(16)+(lsb*0xF<<0).toString(16);
               ctx.fillStyle = couleur_montant;
		       tracequadrilataire_plein(canvas.width-longueur_lycee*0.98+longueur_lycee*0.03*i,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*2/7,canvas.width-longueur_lycee*0.98+longueur_lycee*0.01+longueur_lycee*0.03*i,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*2/7,canvas.width-longueur_lycee*0.98+longueur_lycee*0.01+longueur_lycee*0.03*i,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee/7+hauteur_lycee*2/7,canvas.width-longueur_lycee*0.98+longueur_lycee*0.03*i,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*2/7+hauteur_lycee/7);
		     //  msb3=(msb3+3)%10;
               sb3=(sb3+0.7)%8;
            //   lsb3=(lsb3+0.7)%10;
               msb=msb3+4;
               sb=sb3+4;
               lsb=lsb3+4;
			   couleur_montant='#'+(msb/15*0xF<<0).toString(16)+(sb/15*0xF<<0).toString(16)+(lsb*0xF<<0).toString(16);
               ctx.fillStyle = couleur_montant;
		       tracequadrilataire_plein(canvas.width-longueur_lycee*0.98+longueur_lycee*0.03*i,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*4/7,canvas.width-longueur_lycee*0.98+longueur_lycee*0.01+longueur_lycee*0.03*i,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*4/7,canvas.width-longueur_lycee*0.98+longueur_lycee*0.01+longueur_lycee*0.03*i,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee/7+hauteur_lycee*4/7,canvas.width-longueur_lycee*0.98+longueur_lycee*0.03*i,offcet_h_lycee+hauteur_lycee*0.04+hauteur_lycee*4/7+hauteur_lycee/7);
		}
		ctx.fillStyle = '#ffd';
		tracequadrilataire_plein(canvas.width-longueur_lycee*0.65,offcet_h_lycee,canvas.width-longueur_lycee*0.5,offcet_h_lycee,canvas.width-longueur_lycee*0.5,offcet_h_lycee+hauteur_lycee,canvas.width-longueur_lycee*0.65,offcet_h_lycee+hauteur_lycee);
		
		ctx.fillStyle = '#987';
		tracequadrilataire_plein(canvas.width-longueur_lycee*0.58,offcet_h_lycee+hauteur_lycee*0.6,canvas.width-longueur_lycee*0.60,offcet_h_lycee+hauteur_lycee*0.6,canvas.width-longueur_lycee*0.61,offcet_h_lycee+hauteur_lycee*1.04+hauteur_lycee/7,canvas.width-longueur_lycee*0.57,offcet_h_lycee+hauteur_lycee*1.04+hauteur_lycee/7);
		
		ctx.fillStyle = 'green';
		ctx.beginPath();
		ctx.arc(canvas.width-longueur_lycee*0.59,offcet_h_lycee+hauteur_lycee*0.6,hauteur_lycee*0.25,-Math.PI,Math.PI*0/4, true);
		ctx.arc(canvas.width-longueur_lycee*0.59,offcet_h_lycee+hauteur_lycee*0.2,hauteur_lycee*0.20,0,Math.PI,true);
		ctx.closePath();
		ctx.fill();
		
		//coeur
       ctx.fillStyle = 'red';
		ctx.beginPath();
		ctx.arc(canvas.width*5/6-hauteur_lycee/12,offcet_h_lycee+hauteur_lycee*6/5+delta_coeur,hauteur_lycee/12,-Math.PI*5/4,Math.PI*0/4, false);
		ctx.arc(canvas.width*5/6+hauteur_lycee/12,offcet_h_lycee+hauteur_lycee*6/5+delta_coeur,hauteur_lycee/12,-Math.PI,Math.PI*1/4, false);
        ctx.lineTo(canvas.width*5/6,offcet_h_lycee+hauteur_lycee*6/5+hauteur_lycee*2.5/12+delta_coeur);
		ctx.closePath();
		ctx.fill();
		ctx.fillStyle = '#000';
		tracequadrilataire(-2,offcet_h_lycee+hauteur_lycee*1.6,canvas.width+2,offcet_h_lycee+hauteur_lycee*1.6,canvas.width+2,offcet_h_lycee+hauteur_lycee*1.6,-2,offcet_h_lycee+hauteur_lycee*1.6);
		
		ctx.fillStyle = '#ffd';
		tracequadrilataire_plein(0,offcet_h_lycee+hauteur_lycee*2.8,canvas.width,offcet_h_lycee+hauteur_lycee*2.8,canvas.width,offcet_h_lycee+hauteur_lycee*2.5,0,offcet_h_lycee+hauteur_lycee*2.5);
		
		//railles
		ctx.fillStyle = '#300';
		tracequadrilataire_plein(0,offcet_h_lycee+hauteur_lycee*2.55,canvas.width,offcet_h_lycee+hauteur_lycee*2.55,canvas.width,offcet_h_lycee+hauteur_lycee*2.5,0,offcet_h_lycee+hauteur_lycee*2.5);
		
		//pont
		ctx.fillStyle = '#ffd';
		tracequadrilataire_plein(canvas.width/7,offcet_h_lycee+hauteur_lycee*2.55,canvas.width,offcet_h_lycee+hauteur_lycee*2.55,canvas.width,offcet_h_lycee+hauteur_lycee*4,canvas.width/7,offcet_h_lycee+hauteur_lycee*4);
		//terre
		ctx.fillStyle = '#855';
		tracequadrilataire_plein(canvas.width*4/6,offcet_h_lycee+hauteur_lycee*2.55,canvas.width,offcet_h_lycee+hauteur_lycee*2.55,canvas.width,offcet_h_lycee+hauteur_lycee*4,canvas.width*5/6,offcet_h_lycee+hauteur_lycee*4);
		
		
       trace_train(type_train_2,delta_train_2,offcet_h_lycee+hauteur_lycee*2.5,hauteur_lycee);
       trace_train(type_train_1,delta_train_1,offcet_h_lycee+hauteur_lycee*2.5,hauteur_lycee);
       
       
}
	
}
		
function  trace_train(type_train,delta_train,offset_h,hauteur_de_base)
{
	if(type_train==0)
		{
			
			ctx.fillStyle = '#000'
			ctx.strokeStyle = '#000'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.1,delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.15,delta_train+canvas.width/4+hauteur_de_base*1.23,offset_h-hauteur_de_base*0.15,delta_train+canvas.width/4+hauteur_de_base*1.23,offset_h-hauteur_de_base*0.1);
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.08);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.17);
			ctx.closePath();
			ctx.stroke();
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.5, offset_h-hauteur_de_base*0.5);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.35, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.5, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.83);
			ctx.stroke();
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.5);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.33, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.46, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.46, offset_h-hauteur_de_base*0.82);
			ctx.stroke();
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.58, offset_h-hauteur_de_base*0.5);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.35, offset_h-hauteur_de_base*0.71);
			ctx.stroke();
			
			ctx.fillStyle = '#333';
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
		    ctx.fillStyle = '#aaa';
		   tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.45,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.45,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.05);
		   ctx.fillStyle = '#999';
            ctx.beginPath();
			//ctx.arc(delta_train+canvas.width/4+hauteur_de_base*0.1,offset_h-hauteur_de_base*0.45,hauteur_de_base*0.1,-Math.PI,-Math.PI/2, false);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0,offset_h-hauteur_de_base*0.45);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0,offset_h-hauteur_de_base*0.55);
			//ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0,offset_h-hauteur_de_base*0.55);
			//ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0,offset_h-hauteur_de_base*0.45);
            ctx.arc(delta_train+canvas.width/4+hauteur_de_base*1.1,offset_h-hauteur_de_base*0.45,hauteur_de_base*0.1,-Math.PI/2,0,false);
			ctx.closePath();
			ctx.fill();
			ctx.fillStyle = '#777';
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.06,delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*0.04,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*0.04,offset_h-hauteur_de_base*0.06);
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.06,delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*1.16,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*1.16,offset_h-hauteur_de_base*0.06);
			
			ctx.fillStyle = '#567'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.19,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.19,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.13,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.13,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.05,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.05,offset_h-hauteur_de_base*0.2);
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.01,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*1.01,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.07,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.07,offset_h-hauteur_de_base*0.2);
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.15,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.15,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.15,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.15,offset_h-hauteur_de_base*0.2);
            tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.22,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.22,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.46,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.46,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.48,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.48,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.72,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.72,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.74,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.74,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.98,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.98,offset_h-hauteur_de_base*0.2);
			
			delta_train=delta_train-hauteur_de_base*1.22;
			ctx.fillStyle = '#000'
			ctx.strokeStyle = '#000'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.1,delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.15,delta_train+canvas.width/4+hauteur_de_base*1.23,offset_h-hauteur_de_base*0.15,delta_train+canvas.width/4+hauteur_de_base*1.23,offset_h-hauteur_de_base*0.1);
			/*ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.08);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.17);
			ctx.closePath();
			ctx.stroke();*/
			
			ctx.fillStyle = '#333';
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
		    ctx.fillStyle = '#aaa';
		   tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.45,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.45,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.05);
		   ctx.fillStyle = '#999';
            ctx.beginPath();
			//ctx.arc(delta_train+canvas.width/4+hauteur_de_base*0.1,offset_h-hauteur_de_base*0.45,hauteur_de_base*0.1,-Math.PI,-Math.PI/2, false);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0,offset_h-hauteur_de_base*0.45);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0,offset_h-hauteur_de_base*0.55);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.55);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.45);
			//ctx.arc(delta_train+canvas.width/4+hauteur_de_base*1.1,offset_h-hauteur_de_base*0.45,hauteur_de_base*0.1,-Math.PI/2,0,false);
			ctx.closePath();
			ctx.fill();
			ctx.fillStyle = '#777';
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.06,delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*0.04,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*0.04,offset_h-hauteur_de_base*0.06);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.06,delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*1.16,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*1.16,offset_h-hauteur_de_base*0.06);
			
			ctx.fillStyle = '#567'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.19,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.19,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.13,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.13,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.05,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.05,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.01,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*1.01,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.07,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.07,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.15,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.15,offset_h-hauteur_de_base*0.2);
            tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.22,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.22,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.46,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.46,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.48,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.48,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.72,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.72,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.74,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.74,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.98,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.98,offset_h-hauteur_de_base*0.2);
			
			delta_train=delta_train-hauteur_de_base*1.22;
			ctx.fillStyle = '#000'
			ctx.strokeStyle = '#000'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.1,delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.15,delta_train+canvas.width/4+hauteur_de_base*1.23,offset_h-hauteur_de_base*0.15,delta_train+canvas.width/4+hauteur_de_base*1.23,offset_h-hauteur_de_base*0.1);
			/*ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.08);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.17);
			ctx.closePath();
			ctx.stroke();*/
			
			ctx.fillStyle = '#333';
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
		    ctx.fillStyle = '#aaa';
		   tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.45,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.45,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.05);
		   ctx.fillStyle = '#999';
            ctx.beginPath();
			//ctx.arc(delta_train+canvas.width/4+hauteur_de_base*0.1,offset_h-hauteur_de_base*0.45,hauteur_de_base*0.1,-Math.PI,-Math.PI/2, false);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0,offset_h-hauteur_de_base*0.45);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0,offset_h-hauteur_de_base*0.55);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.55);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.45);
			//ctx.arc(delta_train+canvas.width/4+hauteur_de_base*1.1,offset_h-hauteur_de_base*0.45,hauteur_de_base*0.1,-Math.PI/2,0,false);
			ctx.closePath();
			ctx.fill();
			ctx.fillStyle = '#777';
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.06,delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*0.04,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*0.04,offset_h-hauteur_de_base*0.06);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.06,delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*1.16,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*1.16,offset_h-hauteur_de_base*0.06);
			
			ctx.fillStyle = '#567'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.19,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.19,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.13,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.13,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.05,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.05,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.01,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*1.01,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.07,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.07,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.15,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.15,offset_h-hauteur_de_base*0.2);
            tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.22,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.22,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.46,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.46,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.48,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.48,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.72,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.72,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.74,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.74,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.98,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.98,offset_h-hauteur_de_base*0.2);
			
			delta_train=delta_train-hauteur_de_base*1.22;
			ctx.fillStyle = '#000'
			ctx.strokeStyle = '#000'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.1,delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.15,delta_train+canvas.width/4+hauteur_de_base*1.23,offset_h-hauteur_de_base*0.15,delta_train+canvas.width/4+hauteur_de_base*1.23,offset_h-hauteur_de_base*0.1);
			tracequadrilataire_plein(delta_train+canvas.width/4,offset_h-hauteur_de_base*0.1,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.15,delta_train+canvas.width/4-hauteur_de_base*0.03,offset_h-hauteur_de_base*0.15,delta_train+canvas.width/4-hauteur_de_base*0.03,offset_h-hauteur_de_base*0.1);
            ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4-hauteur_de_base*0.03, offset_h-hauteur_de_base*0.08);
			ctx.lineTo(delta_train+canvas.width/4-hauteur_de_base*0.03, offset_h-hauteur_de_base*0.17);
			ctx.closePath();
			ctx.stroke();
			
			ctx.fillStyle = '#333';
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
		    ctx.fillStyle = '#aaa';
		   tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.45,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.45,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.05);
		   ctx.fillStyle = '#999';
            ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*0.1,offset_h-hauteur_de_base*0.45,hauteur_de_base*0.1,-Math.PI,-Math.PI/2, false);
			//ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0,offset_h-hauteur_de_base*0.45);
			//ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0,offset_h-hauteur_de_base*0.55);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.55);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.45);
			//ctx.arc(delta_train+canvas.width/4+hauteur_de_base*1.1,offset_h-hauteur_de_base*0.45,hauteur_de_base*0.1,-Math.PI/2,0,false);
			ctx.closePath();
			ctx.fill();
			ctx.fillStyle = '#777';
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.06,delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*0.04,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*0.04,offset_h-hauteur_de_base*0.06);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.06,delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*1.16,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*1.16,offset_h-hauteur_de_base*0.06);
			
			ctx.fillStyle = '#567'
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.19,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.19,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.13,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.13,offset_h-hauteur_de_base*0.2);
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.05,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.05,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.05,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*0.05,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.01,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*1.01,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.07,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.07,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.15,offset_h-hauteur_de_base*0.40,delta_train+canvas.width/4+hauteur_de_base*1.15,offset_h-hauteur_de_base*0.2);
            tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.22,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.22,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.46,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.46,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.48,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.48,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.72,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.72,offset_h-hauteur_de_base*0.2);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.74,offset_h-hauteur_de_base*0.2,delta_train+canvas.width/4+hauteur_de_base*0.74,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.98,offset_h-hauteur_de_base*0.38,delta_train+canvas.width/4+hauteur_de_base*0.98,offset_h-hauteur_de_base*0.2);
			
			
		    }
		else
		{
			
			ctx.fillStyle = '#000'
			ctx.strokeStyle = '#000'
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.1,delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.6,delta_train+canvas.width/4+hauteur_de_base*1.43,offset_h-hauteur_de_base*0.6,delta_train+canvas.width/4+hauteur_de_base*1.43,offset_h-hauteur_de_base*0.1);
			/*ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.08);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.17);
			ctx.closePath();
			ctx.stroke();*/
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.5, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.20, offset_h-hauteur_de_base*0.8);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.5, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.83);
			ctx.stroke();
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.18, offset_h-hauteur_de_base*0.8);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.46, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.46, offset_h-hauteur_de_base*0.82);
			ctx.stroke();
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.58, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.20, offset_h-hauteur_de_base*0.81);
			ctx.stroke();
			
			//roues
			ctx.fillStyle = '#333';
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
			
			//wagon
		    ctx.fillStyle = '#eee';
		   tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.55,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.45,offset_h-hauteur_de_base*0.7,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.7,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.05);
		  

		   //bande bleue
		    ctx.fillStyle = '#006'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.29375,delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.45625,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.45625,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.29375);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.1,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*1.1,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*1.5,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*1.5,offset_h-hauteur_de_base*0.27);
			
			
			//portes
			
			ctx.fillStyle = '#800';
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.1,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*0.1,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*0.30,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*0.30,offset_h-hauteur_de_base*0.05);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.1,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.1,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*0.9,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*0.9,offset_h-hauteur_de_base*0.05);
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.3,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.3,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*1.1,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*1.10,offset_h-hauteur_de_base*0.05);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.55,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.45,offset_h-hauteur_de_base*0.7,delta_train+canvas.width/4+hauteur_de_base*1.52,offset_h-hauteur_de_base*0.65,delta_train+canvas.width/4+hauteur_de_base*1.60,offset_h-hauteur_de_base*0.1);
		  
			
			
			//fenêtres 
			ctx.fillStyle = '#567'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.195,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.195,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.29,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*0.29,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.205,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.205,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.91,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*0.91,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.995,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.995,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.005,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.005,offset_h-hauteur_de_base*0.27);
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.11,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*1.11,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.195,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.195,offset_h-hauteur_de_base*0.27);
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.29,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*1.29,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.205,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.205,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.45,offset_h-hauteur_de_base*0.30,delta_train+canvas.width/4+hauteur_de_base*1.45,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.35,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.35,offset_h-hauteur_de_base*0.30);
			
			
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.64);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.64);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.64);
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.64);
			
            tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.28);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.28);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.28);
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.28);
            
            delta_train=delta_train-hauteur_de_base*1.42;
            
            ctx.fillStyle = '#000'
			ctx.strokeStyle = '#000'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.1,delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.6,delta_train+canvas.width/4+hauteur_de_base*1.43,offset_h-hauteur_de_base*0.6,delta_train+canvas.width/4+hauteur_de_base*1.43,offset_h-hauteur_de_base*0.1);
			/*ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.08);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.17);
			ctx.closePath();
			ctx.stroke();*/
			
			/*ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.5, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.20, offset_h-hauteur_de_base*0.8);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.5, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.83);
			ctx.stroke();
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.18, offset_h-hauteur_de_base*0.8);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.46, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.46, offset_h-hauteur_de_base*0.82);
			ctx.stroke();
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.58, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.20, offset_h-hauteur_de_base*0.81);
			ctx.stroke();*/
			
			//roues
			ctx.fillStyle = '#333';
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
			
			//wagon
		    ctx.fillStyle = '#eee';
		   tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.7,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.7,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.05);
		  
		   //bande bleue
		    ctx.fillStyle = '#006'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.29375,delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.45625,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.45625,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.29375);
			
			//portes
			
			ctx.fillStyle = '#800';
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.1,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*0.1,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*0.30,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*0.30,offset_h-hauteur_de_base*0.05);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.3,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.3,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*1.1,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*1.10,offset_h-hauteur_de_base*0.05);
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.06,delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*1.16,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*1.16,offset_h-hauteur_de_base*0.06);
			
			
			
			//fenêtres 
			ctx.fillStyle = '#567'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.195,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.195,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.29,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*0.29,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.205,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.205,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.11,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*1.11,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.195,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.195,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.29,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*1.29,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.205,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.205,offset_h-hauteur_de_base*0.27);
			
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.64);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.64);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.64);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.64);
			
            tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.28);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.28);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.28);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.28);
            
            delta_train=delta_train-hauteur_de_base*1.42;
            
            ctx.fillStyle = '#000'
			ctx.strokeStyle = '#000'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.1,delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.6,delta_train+canvas.width/4+hauteur_de_base*1.43,offset_h-hauteur_de_base*0.6,delta_train+canvas.width/4+hauteur_de_base*1.43,offset_h-hauteur_de_base*0.1);
			/*ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.08);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.17);
			ctx.closePath();
			ctx.stroke();*/
			
			/*ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.5, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.20, offset_h-hauteur_de_base*0.8);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.5, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.83);
			ctx.stroke();
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.18, offset_h-hauteur_de_base*0.8);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.46, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.46, offset_h-hauteur_de_base*0.82);
			ctx.stroke();
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.58, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.20, offset_h-hauteur_de_base*0.81);
			ctx.stroke();*/
			
			//roues
			ctx.fillStyle = '#333';
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
			
			//wagon
		    ctx.fillStyle = '#eee';
		   tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.7,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.7,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.05);
		  
		   //bande bleue
		    ctx.fillStyle = '#006'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.29375,delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.45625,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.45625,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.29375);
			
			//portes
			
			ctx.fillStyle = '#800';
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.1,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*0.1,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*0.30,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*0.30,offset_h-hauteur_de_base*0.05);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.3,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.3,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*1.1,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*1.10,offset_h-hauteur_de_base*0.05);
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.06,delta_train+canvas.width/4+hauteur_de_base*1,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*1.16,offset_h-hauteur_de_base*0.42,delta_train+canvas.width/4+hauteur_de_base*1.16,offset_h-hauteur_de_base*0.06);
			
			
			
			//fenêtres 
			ctx.fillStyle = '#567'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.195,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.195,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.29,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*0.29,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.205,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.205,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.11,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*1.11,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.195,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.195,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.29,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*1.29,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.205,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.205,offset_h-hauteur_de_base*0.27);
			
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.64);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.64);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.64);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.64);
			
            tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.28);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.28);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.28);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.28);
            
            delta_train=delta_train-hauteur_de_base*1.42;
            
            ctx.fillStyle = '#000'
			ctx.strokeStyle = '#000'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.1,delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.6,delta_train+canvas.width/4+hauteur_de_base*1.43,offset_h-hauteur_de_base*0.6,delta_train+canvas.width/4+hauteur_de_base*1.43,offset_h-hauteur_de_base*0.1);
			/*ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.08);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*1.23, offset_h-hauteur_de_base*0.17);
			ctx.closePath();
			ctx.stroke();*/
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.5, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.20, offset_h-hauteur_de_base*0.8);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.5, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.83);
			ctx.stroke();
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.18, offset_h-hauteur_de_base*0.8);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.48, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.46, offset_h-hauteur_de_base*0.9);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.46, offset_h-hauteur_de_base*0.82);
			ctx.stroke();
			
			ctx.beginPath();
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.58, offset_h-hauteur_de_base*0.7);
			ctx.lineTo(delta_train+canvas.width/4+hauteur_de_base*0.20, offset_h-hauteur_de_base*0.81);
			ctx.stroke();
			
			//roues
			ctx.fillStyle = '#333';
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*0.2,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
			ctx.beginPath();
			ctx.arc(delta_train+canvas.width/4+hauteur_de_base*1.2,offset_h-hauteur_de_base*0.1,hauteur_de_base*0.1,-Math.PI,0, true);
			ctx.closePath();
			ctx.fill();
			
			//wagon
		    ctx.fillStyle = '#eee';
		tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.7,delta_train+canvas.width/4-hauteur_de_base*0.05,offset_h-hauteur_de_base*0.7,delta_train+canvas.width/4-hauteur_de_base*0.15,offset_h-hauteur_de_base*0.05);
		  
		   //bande bleue
		    ctx.fillStyle = '#006'
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.29375,delta_train+canvas.width/4+hauteur_de_base*1.4,offset_h-hauteur_de_base*0.45625,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.45625,delta_train+canvas.width/4,offset_h-hauteur_de_base*0.29375);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.3,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*0.3,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4-hauteur_de_base*0.1,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4-hauteur_de_base*0.1,offset_h-hauteur_de_base*0.27);
			
			//portes
			ctx.fillStyle = '#800';
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.1,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*0.1,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*0.30,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*0.30,offset_h-hauteur_de_base*0.05);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.3,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*0.3,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*0.50,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*0.50,offset_h-hauteur_de_base*0.05);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.3,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4+hauteur_de_base*1.3,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*1.1,offset_h-hauteur_de_base*0.52,delta_train+canvas.width/4+hauteur_de_base*1.10,offset_h-hauteur_de_base*0.05);
			tracequadrilataire_plein(delta_train+canvas.width/4-hauteur_de_base*0.15,offset_h-hauteur_de_base*0.05,delta_train+canvas.width/4-hauteur_de_base*0.05,offset_h-hauteur_de_base*0.7,delta_train+canvas.width/4-hauteur_de_base*0.12,offset_h-hauteur_de_base*0.65,delta_train+canvas.width/4-hauteur_de_base*0.2,offset_h-hauteur_de_base*0.1);
		  
			
			//fenêtres 
			ctx.fillStyle = '#567'
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*0.11,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.195,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.195,offset_h-hauteur_de_base*0.27);
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.29,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*0.29,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.205,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.205,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.395,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.395,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.49,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*0.49,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.405,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.405,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.11,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*1.11,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.195,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.195,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*1.29,offset_h-hauteur_de_base*0.27,delta_train+canvas.width/4+hauteur_de_base*1.29,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.205,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.205,offset_h-hauteur_de_base*0.27);
			tracequadrilataire_plein(delta_train+canvas.width/4-hauteur_de_base*0.05,offset_h-hauteur_de_base*0.30,delta_train+canvas.width/4-hauteur_de_base*0.05,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.05,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.05,offset_h-hauteur_de_base*0.30);
			
			//tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.64);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.64);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.64);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.64,delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.47,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.64);
			
            //tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.31,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.495,offset_h-hauteur_de_base*0.28);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.505,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.695,offset_h-hauteur_de_base*0.28);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.705,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*0.895,offset_h-hauteur_de_base*0.28);
			tracequadrilataire_plein(delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.28,delta_train+canvas.width/4+hauteur_de_base*0.905,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.11,delta_train+canvas.width/4+hauteur_de_base*1.09,offset_h-hauteur_de_base*0.28);
            
            delta_train=delta_train-hauteur_de_base*1.42;
		}
}

function trace_spalc(pos_mX,pos_mY,Anguele)
{
	var taille_mis=0.2;
	var X_cent_cercle=20*taille_mis;
	var Y_cent_cercle=5*taille_mis;
	var diam_cercle=40*taille_mis;
	var long_p_cent=145*taille_mis;
	var long_par=50*taille_mis;
	var larg_mis_sur_2=Math.cos(Math.asin(Y_cent_cercle/diam_cercle))*diam_cercle-X_cent_cercle;
	var larg_wg=17*taille_mis;
	var long_wg=65*taille_mis;
	var ang_wg=10*Math.PI/180;
	
	ctx.translate(pos_mX,pos_mY);
	ctx.rotate(Anguele);
	ctx.beginPath();
	ctx.arc(X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI+Math.asin(Y_cent_cercle/diam_cercle), Math.PI+Math.acos(X_cent_cercle/diam_cercle), false);
	ctx.arc(-X_cent_cercle, Y_cent_cercle, diam_cercle, Math.PI*2-Math.acos(X_cent_cercle/diam_cercle), Math.PI*2-Math.asin(Y_cent_cercle/diam_cercle), false);
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5);
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	
	ctx.lineTo(larg_mis_sur_2, long_p_cent+4*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+25*taille_mis);
	ctx.lineTo(larg_mis_sur_2+14*taille_mis, long_p_cent+40*taille_mis);
	ctx.lineTo(larg_mis_sur_2+3*taille_mis, long_p_cent+46*taille_mis);
	ctx.lineTo(larg_mis_sur_2/2+4*taille_mis, long_p_cent+long_par-12*taille_mis);
	
	ctx.lineTo(larg_mis_sur_2/2, long_p_cent+long_par);
	ctx.lineTo(-larg_mis_sur_2/2, long_p_cent+long_par);
	
	ctx.lineTo(-(larg_mis_sur_2/2+4*taille_mis), long_p_cent+long_par-12*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+3*taille_mis), long_p_cent+46*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+40*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2+14*taille_mis), long_p_cent+25*taille_mis);
	ctx.lineTo(-(larg_mis_sur_2), long_p_cent+4*taille_mis);
	

	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)-larg_wg*Math.sin(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg)+larg_wg*Math.cos(ang_wg));
	ctx.lineTo(-(larg_mis_sur_2+long_wg*Math.cos(ang_wg)), long_p_cent*2/5+long_wg*Math.sin(ang_wg));
	ctx.lineTo(-larg_mis_sur_2, long_p_cent*2/5);
	
	ctx.closePath();
	ctx.strokeStyle = 'black';
	ctx.fillStyle = 'grey';
	ctx.fill();
	ctx.stroke();
	ctx.rotate(-Anguele);
	ctx.translate(-pos_mX,-pos_mY);
	
	
}

function generation_cheatcode()
{
	var texte='azerty';
	//arme max, niv de chaq carac de chaque arme
	texte= score_tot+'%'+max_level+'%'+niv_max_arme;
	texte=texte+'%'+niv_boulet_freq;
	texte=texte+'%'+niv_boulet_vit;
	texte=texte+'%'+niv_miss_periode;
	texte=texte+'%'+niv_vit_miss_TC;
	texte=texte+'%'+niv_AD_miss;
	texte=texte+'%'+niv_manoeuv_miss;
	texte=texte+'%'+niv_periode_laser;
	texte=texte+'%'+niv_duree_laser;
	texte=texte+'%'+niv_largeur_laser;
	texte=texte+'%'+niv_periode_murs;
	texte=texte+'%'+niv_coef_long_mur;
	texte=texte+'%'+niv_type_de_mur;
	texte=texte+'%'+niv_autodef;
	texte= encrypte(texte);
	return texte;
}

function recuperation_cheatcode(chaine_carac)
{
	var tab=[];
	var index=0;
	chaine_carac= decrypte(chaine_carac);
	tab=chaine_carac.split('%');
	if(tab.length==16)
	{
		/*for (index=0;index<tab.length;index++)
		{
			alert(tab[index]);
		}*/
		
		score_tot=Number(tab[0]);
		//alert(score_tot+1);
		max_level=Number(tab[1]);
		niv_max_arme=Number(tab[2]);
		
		niv_boulet_freq=Number(tab[3]);
		temps_entre_2_boulets=periode_boulet_tab[niv_boulet_freq];
		
		niv_boulet_vit=Number(tab[4]);
		vit_boulets=vit_boulet_tab[niv_boulet_vit];
		
		niv_miss_periode=Number(tab[5]);
		temps_entre_2_miss_TC=periode_miss_tab[niv_miss_periode];
		
		niv_vit_miss_TC=Number(tab[6]);
		vit_miss_TC=vit_miss_tab[niv_vit_miss_TC];
		accel_miss_TC=vit_miss_tab[niv_vit_miss_TC];
		
		niv_AD_miss=Number(tab[7]);
		portee_AD=AD_portee_tab[niv_AD_miss];
		angle_vue_AD=AD_angle_tab[niv_AD_miss];
		
		niv_manoeuv_miss=Number(tab[8]);
		vit_rot_max_TC=manoeuv_miss_tab[niv_manoeuv_miss]; //°/s
				
		
		niv_periode_laser=Number(tab[9]);
		temps_entre_2_laser=periode_laser_tab[niv_periode_laser];
		
		niv_duree_laser=Number(tab[10]);
		duree_laser=duree_laser_tab[niv_duree_laser];
		
		niv_largeur_laser=Number(tab[11]);
		coef_largeur_laser=largeur_laser_tab[niv_largeur_laser];
		laser_couleur=laser_couleur_tab[niv_largeur_laser];
		
		 niv_periode_murs=Number(tab[12]);
		 periode_murs=periode_murs_tab[niv_periode_murs];
		
		niv_coef_long_mur=Number(tab[13]);
		coef_long_mur=coef_long_mur_tab[niv_coef_long_mur];
		
		niv_type_de_mur=Number(tab[14]);
		type_de_mur=type_de_mur_tab[niv_type_de_mur];
		
		niv_autodef=Number(tab[15]);
		autodef=autodef_tab[niv_autodef];
	}
	else
	{
		alert('erreur : mauvais code');
	}
}

function encrypte(a_cryptexte)
{
	var clee='+, il è fré, + ai Hot ?';
	var tab_clee=clee.split('');
    var tab_carac=[];
	var index_carac=0;
	var index_clee=0;
	var cryptexte=' ';
	var tab_crypt_carac=[];
	var tab_carac=a_cryptexte.split('');
	var code_ascii=0;
	var cade_ascii_prec=85;
	
	for (index_carac=0;index_carac<tab_carac.length;index_carac++)
	{
		index_clee=index_carac%tab_clee.length;
		//alert(tab_clee[index_clee]);
		code_ascii=(tab_carac[index_carac].charCodeAt()^tab_clee[index_clee].charCodeAt())^cade_ascii_prec;
		code_ascii_prec=code_ascii;
		tab_crypt_carac[index_carac]=String.fromCharCode(code_ascii);
		//alert(tab_carac[index_carac]);
	}	
	cryptexte=tab_crypt_carac[0];
	for (index_carac=1;index_carac<tab_carac.length;index_carac++)
	{
		cryptexte=cryptexte+tab_crypt_carac[index_carac];
	}
	return cryptexte;
}

function decrypte(a_decryptexte)
{
	var clee='+, il è fré, + ai Hot ?';
	var tab_clee=clee.split('');
    var tab_carac=[];
	var index_carac=0;
	var index_clee=0;
	var decryptexte=' ';
	var tab_decrypt_carac=[];
	var tab_carac=a_decryptexte.split('');
	var code_ascii=0;
	var cade_ascii_prec=85;
	
	for (index_carac=0;index_carac<tab_carac.length;index_carac++)
	{
		index_clee=index_carac%tab_clee.length;
		code_ascii=(tab_carac[index_carac].charCodeAt()^cade_ascii_prec)^tab_clee[index_clee].charCodeAt();
		code_ascii_prec=tab_carac[index_carac];
		tab_decrypt_carac[index_carac]=String.fromCharCode(code_ascii);
	}	
	decryptexte=tab_decrypt_carac[0];
	for (index_carac=1;index_carac<tab_carac.length;index_carac++)
	{
		decryptexte=decryptexte+tab_decrypt_carac[index_carac];
	}
	return decryptexte;
}

</script>
</html>